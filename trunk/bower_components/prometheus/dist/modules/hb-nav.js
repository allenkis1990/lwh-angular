/**
 * prometheus - 普罗米修斯
 * @author 
 * @version v1.0.8
 * @link 
 * @license MIT
 */
define(["angular","angularUiRouter","uiRouterExtras","oclazyload"],function(e){function t(){return function(e){var t=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i);return t&&parseFloat(t[1])}(navigator.userAgent)}return e.module("hb.nav",["ui.router","oc.lazyLoad","ct.ui.router.extras"]).provider("sideMenu",[function(){this.setLoadMenuUrl=function(e){this.menuUrl=e},this.sync=!0,this.menuUrl="datas/hb.menu.json",this.setOptions=function(e){var e=e||{};this.menuUrl=e.menuUrl||"datas/hb.menu.json",this.menuTemplateUrl=e.menuTemplateUrl||"templates/tpls/tpl-hb-side-menu.html",this.sync=e.sync};var e=this;this.$get=["$http",function(t){return{sync:e.sync,loadMenu:function(){return t.get(e.menuUrl)},getSrollOptions:function(){return e.scrollOptions}}}]}]).provider("hbTab",function(){var t=function(){};t.prototype={appendNewTab:e.noop},this.$get=[function(){return new t}]}).factory("TabService",["$rootScope","$state",function(e,t){var n={HB_TAB:{tabs:[]}};return n.findView=function(e){for(var t,n=0;n<this.HB_TAB.tabs.length;n++)if(e[this.HB_TAB.tabs[n].viewName]){t=this.HB_TAB.tabs[n];break}return t},n.goAnyWay=function(t){var n={};if(t.unListed){var a={state:t.name,name:t.title};this.newState(n,a,t)}else for(var i=0;i<e.menuList.length;i++){var s=e.menuList[i];if(s.subs)for(var r=0;r<s.subs.length;r++){var o=s.subs[r];this.newState(n,o,t)}else this.newState(n,s,t)}n.state&&this.appendNewTab(n.state.name,n.state.activeView.stateName,n.state.activeView.params,n.state.viewName,!0)},n.compare2State=function(e,t){return new RegExp("^"+e+".").test(t)||e===t},n.newState=function(e,t,n){if(this.compare2State(t.state,n.name)){var a={params:n.$stateParams,stateName:n.name};e.state={name:t.name,viewName:t.state,position:"index",closeAble:!0,subs:[],activeView:a}}},n.changeCurrent=function(e,n){return t.go(e,n)},n.appendNewTab=function(t,a,i,s,r){var o={};o[s||a]=!0;var u=this.findView(o);n.from="0",u?(u.params=i,u.activeView={stateName:a,params:i}):(u={name:t,viewName:s||a,params:i,activeView:{stateName:a,params:i},closeAble:r},this.HB_TAB.tabs.push(u)),this.HB_TAB.tabs.length>1&&(this.changeCurrent(a,i),e.$broadcast("events:addTab",u))},n.init=function(){var t=e.menuList[0];n.appendNewTab(t.name,t.state,void 0,void 0,!1)},n}]).directive("hbSideMenu",["sideMenu","$rootScope","$timeout","TabService","$state",function(n,a,i,s,r){return{templateUrl:function(e,t){return t.templateUrl||"templates/tpls/tpl-hb-side-menu.html"},replace:!0,compile:function(n){return function(n,i,s){n.model=n.model||{},n.model.currentMenuName="states.home",n.isIe8=8===t(),n.showMenu=!1,n.events={toggleSideNav:function(){n.showMenu=!n.showMenu,n.model.nowMarginLeft=0,n.showMenu?(n.model.sideStyle={marginLeft:"-250px"},a.contentStyle={marginLeft:0},n.model.nowMarginLeft=-250):(n.model.sideStyle={marginLeft:0},a.contentStyle={marginLeft:"250px"},n.model.nowMarginLeft=0),a.$broadcast("events:changeSideWidth",n.model.nowMarginLeft)},toggleSub:function(t,i,s,o){var u=$(t.target),c=u.closest("li"),l=$('<span class="ink"></span>'),m=Math.max(c.outerWidth(),c.outerHeight());if(c.find(".ink").remove(),c.css({position:"relative",overflow:"hidden"}),l.css({width:m,height:m,top:t.pageY-c.offset().top-m/2+"px",left:t.pageX-c.offset().left-m/2+"px"}),c.find(">a").append(l),l.addClass("animate-ink"),i.showSub=!i.showSub,i.subs&&i.subs.length>0){e.forEach(a.menuList,function(e){e.name!==i.name&&(e.showSub=!1)});var f=c.find("ul");f.is(":visible")?f.slideUp():f.slideDown().parent().siblings().find("ul").slideUp()}return i.subs?(i.subs.length<=0,!1):(n.model.currentMenu=s,n.model.currentMenuName=o,void r.go(i.state,i.name))}}}}}}]).run(["$rootScope","sideMenu","$stateParams","TabService","$state",function(t,n,a,i,s){t.menuList=[],t.model=t.model||{},n.loadMenu().then(function(n){t.menuList=n.data,t.menuList&&t.menuList.length>0&&i.init(),t.$on("$stateChangeSuccess",function(t,n){n.$stateParams=e.copy(a);var s,r=n.$$state().includes;"0"===i.from?(i.goAnyWay(n),s=i.findView(r),s.activeView.stateName=n.name,s.activeView.params=e.copy(a),i.from="1"):r&&r[n.name]&&(s=i.findView(r),s?(s.activeView.stateName=n.name,s.activeView.params=e.copy(a)):i.goAnyWay(n))})})}]).directive("hbTab",["$rootScope","$state","hbTab","$stateParams","$timeout","TabService",function(t,n,a,i,s,r){return{restrict:"A",replace:!0,templateUrl:function(e,t){return t.templateUrl||"templates/tpls/tpl-hb-tab.html"},link:function(a,i,o,u){a.$state=n,r.from="0",a.style={},a.HB_TAB=r.HB_TAB,a.$on("events:clickMenuItem",function(e){a.HB_TAB.currentTab=e.parentView||e.view}),a.style.left=0,a.closeTab=function(e,t,i){e.stopPropagation(),r.from="0";var o;a.HB_TAB.tabs.splice(t,1),n.includes(i)&&(o=a.HB_TAB.tabs[t-1],s(function(){r.changeCurrent(o.activeView.stateName,o.activeView.params)})),a.style.left<0&&(a.style.left+=126,a.style.left>0&&(a.style.left=0))},a.navToolClick=function(e){var t=$(e.target),i=t.data(),s={refresh:function(){n.reload(n.current)},closeAll:function(){r.init(),a.HB_TAB.tabs=a.HB_TAB.tabs.slice(0,1)}};s[i.action]&&s[i.action]()},a.mouseEnter=function(e){var t=$(e.target).closest("a").find(".title-content");t.stop().fadeOut(function(){t.next().fadeIn()})},a.mouseLeave=function(e){},a.clickTab=function(n,i,s,o){r.from="1",a.HB_TAB.currentTab=e.copy(o),r.changeCurrent(i,s),t.$broadcast("events:clickMenuItem",!0),n.preventDefault()}}}}])});