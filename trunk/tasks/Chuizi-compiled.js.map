{"version":3,"sources":["Chuizi.js"],"names":[],"mappings":"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","file":"Chuizi-compiled.js","sourcesContent":["/**\r\n * Created by 46607 on 2017/7/14.\r\n ${customer.Address}\r\n */\r\n\r\nlet through2 = require('through2'),\r\n    File = require('vinyl'),\r\n    gulp = require('gulp'),\r\n    fs = require('fs'),\r\n    path = require('path');\r\n\r\nfunction getSubDirectories(path) {\r\n    let directories = [];\r\n    fs.readdirSync(path).forEach(function (item, index) {\r\n        let subPath = path + '/' + item;\r\n        fs.lstatSync(subPath).isDirectory() && directories.push(item);\r\n    });\r\n    return directories;\r\n}\r\n\r\nlet directories = getSubDirectories('./app');\r\nlet directoryMapper = {},\r\n    modulesDirectoryMapper = {};\r\n\r\ndirectories.forEach((item) => {\r\n    let sub;\r\n    if (/admin|center/.test(item)) {\r\n        sub = getSubDirectories(`./app/${item}/modules`);\r\n    }\r\n    directoryMapper[item] = directoryMapper[item] || {};\r\n    modulesDirectoryMapper[item] = modulesDirectoryMapper[item] || {};\r\n    if (sub) {\r\n        sub.forEach((subItem) => {\r\n            directoryMapper[item][subItem] = {};\r\n            modulesDirectoryMapper[item][subItem] = {};\r\n        })\r\n    } else {\r\n        directoryMapper[item] = {}\r\n    }\r\n});\r\n\r\nmodule.exports = (options) => {\r\n    return through2.obj(function (file, sex, next) {\r\n        let matcher = file.path.match(/.*?\\\\?app\\\\(admin|center)\\\\modules\\\\((admin|center).*?)\\\\(.*?)+/);\r\n        if (!matcher) {\r\n            Object.keys(directoryMapper).forEach((directory) => {\r\n                if (new RegExp(`app\\\\\\\\*?${directory}\\\\\\\\`, 'g').test(file.path)) {\r\n                    if (/center|admin/.test(directory)) {\r\n                        Object.keys(directoryMapper[directory]).forEach((sbDir) => {\r\n                            let $newFile = new File();\r\n                            $newFile.contents = file.contents;\r\n                            $newFile.path = file.path;\r\n                            directoryMapper[directory][sbDir][file.path] = $newFile\r\n                        })\r\n                    } else {\r\n                        let $newFile = new File();\r\n                        $newFile.contents = file.contents;\r\n                        $newFile.path = file.path;\r\n                        directoryMapper[directory][file.path] = $newFile\r\n                    }\r\n                }\r\n            })\r\n        } else {\r\n            Object.keys(modulesDirectoryMapper).forEach((directory) => {\r\n                if (new RegExp(`app\\\\\\\\*?${directory}\\\\\\\\`, 'g').test(file.path)) {\r\n                    Object.keys(modulesDirectoryMapper[directory]).forEach((sbDir) => {\r\n                        let $newFile = new File();\r\n                        $newFile.contents = file.contents;\r\n                        $newFile.path = file.path;\r\n                        if (matcher[2] === sbDir) {\r\n                            modulesDirectoryMapper[directory][sbDir] = modulesDirectoryMapper[directory][sbDir] || {};\r\n                            modulesDirectoryMapper[directory][sbDir][file.path.replace(/.*?\\\\?app\\\\(admin|center)\\\\modules\\\\((admin|center).*?)\\\\(.*?)/g, '$4')] = $newFile;\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n        next()\r\n    }, function (next) {\r\n\r\n        Object.keys(modulesDirectoryMapper).forEach((item) => {\r\n            Object.keys(modulesDirectoryMapper[item]).forEach((sbItem) => {\r\n                Object.keys(modulesDirectoryMapper[item][sbItem]).forEach((grandSbItem) => {\r\n                    let _path = path.resolve('./app', `${item}/${grandSbItem}`);\r\n                    let $newFile = new File();\r\n                    $newFile.path = _path;\r\n                    $newFile.contents = modulesDirectoryMapper[item][sbItem][grandSbItem].contents;\r\n                    if (!directoryMapper[item][sbItem][_path]) {\r\n                        directoryMapper[item][sbItem][_path] = $newFile\r\n                    }\r\n                })\r\n            })\r\n        });\r\n\r\n        Object.keys(directoryMapper).forEach((directory) => {\r\n            if (/center|admin/.test(directory) && directory !== 'center2') {\r\n                Object.keys(directoryMapper[directory]).forEach((sbDir) => {\r\n                    Object.keys(directoryMapper[directory][sbDir]).forEach((filePath) => {\r\n                        let $newFile = new File();\r\n                        let $file = directoryMapper[directory][sbDir][filePath];\r\n                        let match = $file.path.replace(/.*?\\\\?app\\\\(admin|center)\\\\(.*?)/g, '$2');\r\n                        if (modulesDirectoryMapper[directory][sbDir][match]) {\r\n                            $newFile.contents = modulesDirectoryMapper[directory][sbDir][match].contents;\r\n                        } else {\r\n                            $newFile.contents = $file.contents;\r\n                        }\r\n                        $newFile.path = $file.path.replace(new RegExp('(.*?\\\\\\\\*?app\\\\\\\\' + directory + ')', 'g'), `./${sbDir}`);\r\n                        this.push($newFile)\r\n                    })\r\n                })\r\n            } else {\r\n                if (directory !== 'center2') {\r\n                    Object.keys(directoryMapper[directory]).forEach((filePath) => {\r\n                        let $file = directoryMapper[directory][filePath];\r\n                        $file.path = $file.path.replace(/\\\\app\\\\/, '\\\\')\r\n                        this.push($file)\r\n                    })\r\n                }\r\n            }\r\n        });\r\n        next()\r\n    })\r\n};\r\n\r\n\r\n/**\r\n * 分析states下面的文件，\r\n */\r\ngulp.task('analyzeStateMapper', function () {\r\n\r\n    ['admin'].forEach(function (directory) {\r\n        // 获取母版的states集合\r\n        var directories = getSubDirectories(`./app/${directory}/modules`);\r\n\r\n        const motherStates = fs.readdirSync(`./app/${directory}/js/states/`),\r\n            stateMapper = {\r\n                modules: [],\r\n                futureStates: []\r\n            };\r\n\r\n        directories.forEach((item, index) => {\r\n            var myStates = [];\r\n\r\n            var subStates = fs.readdirSync(`${env.buildPath}/${item}/js/states/`);\r\n            /*\r\n             * 1. 如果当前模板存在和此母块的配置信息的话，将母块当中的信息覆盖成自己模板的信息  √\r\n             * 2. 如果母快中有子中没有的配置信息，将母的保留，√\r\n             * 3. 如果子中有母中没有的信息， 将子的信息保存进去，√\r\n             * 。。。完成配置\r\n             */\r\n\r\n            // 将子的全部丢进集合\r\n            myStates = subStates;\r\n\r\n            // 循环母版集合， 如果不存在子中，将元素丢进以存在的mStates中..\r\n            motherStates.forEach((mItem, mIndex) => {\r\n                if (subStates.indexOf(mItem) === -1) {\r\n                    myStates.push(mItem);\r\n                }\r\n            });\r\n\r\n\r\n            /**\r\n             * modules[n] = {\r\n         *       \"reconfig\": true,\r\n         *       \"name\": \"app.admin.states.home\",\r\n         *       \"files\": [\"states/home-state\"]\r\n         *   }\r\n             * futureStates[n] = {\r\n         *      \"module\": \"app.admin.states.home\",\r\n         *      \"stateName\": \"states.home\",\r\n         *      \"url\": \"/home\",\r\n         *      \"type\": \"ocLazyLoad\"\r\n         *   }\r\n             */\r\n            myStates.forEach((rItem, rindex) => {\r\n                var name = rItem.replace(/-state.js$/g, ''),\r\n                    fileNameWithoutExt = rItem.replace(/.js$/, ''),\r\n                    moduleName = 'app.' + name + '.states.' + name;\r\n\r\n                stateMapper.modules.push({\r\n                    reconfig: true,\r\n                    name: moduleName,\r\n                    files: ['states/' + fileNameWithoutExt]\r\n                });\r\n                stateMapper.futureStates.push({\r\n                    module: moduleName,\r\n                    stateName: 'states.' + name,\r\n                    url: '/' + name,\r\n                    type: 'ocLazyLoad'\r\n                });\r\n            });\r\n\r\n            var content = 'define(function() {\"use strict\"; return ' + JSON.stringify(stateMapper) + '})';\r\n            fs.writeFileSync(`${env.buildPath}/${item}/js/common/stateMapper.js`, content, {encoding: 'UTF-8'});\r\n        });\r\n    })\r\n});\r\n"]}