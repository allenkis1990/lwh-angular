define("common/browser",["require"],function(t){var i={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(t){for(var i=0;i<t.length;i++){var e=t[i].string,s=t[i].prop;if(this.versionSearchString=t[i].versionSearch||t[i].identity,e){if(e.indexOf(t[i].subString)!=-1)return t[i].identity}else if(s)return t[i].identity}},searchVersion:function(t){var i=t.indexOf(this.versionSearchString);if(i!=-1)return parseFloat(t.substring(i+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return i.init(),i}),define("common/util",["./browser"],function(t){function i(){}var e=Object.prototype;return i.prototype={extend:function(t,i){function e(){this.constructor=i}for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);e.prototype=t.prototype,i.prototype=new e},isObject:function(t){return"[object Object]"===e.toString.call(t)},isFunction:function(t){return"[object Function]"===e.toString.call(t)},isUndefined:function(t){return void 0===t||"[object Undefined]"===e.toString.call(t)},isArray:function(t){return"[object Array]"===e.toString.call(t)},ajax:function(t,i,e,s){this.isUndefined($)&&this.error("jQuery is undefined!");var a=JSON.stringify(i);if("undefined"!=typeof XDomainRequest){var n=new XDomainRequest;n.onload=function(){if(n.responseText)try{e($.parseJSON(n.responseText))}catch(t){window.console&&console.log(t)}},n.onerror=function(){s&&s()},n.onprogress=function(){},n.open("post",t),n.send(a)}else $.ajax({type:"post",url:t,contentType:"text/plain",data:a,success:e,error:function(t){s&&s()}})},browser:t,isIe8:function(){return"Internet Explorer"===t.browser&&(t.version<=8||document.documentMode<=8)}},i}),define("widgets/button",["require"],function(t){function i(){}return i}),define("widgets/widget",["require"],function(t){function i(){}return i.prototype={name:"widget"},i}),define("widgets/tip",["./widget"],function(t){function i(t){this.options=t||{},this.init()}return i.prototype={constructor:i,init:function(){this.options.appendTo||(this.options.appendTo=$("body")),this.$tipContainer=$('<div class="di-tip-container"></div>'),this.options.appendTo.append(this.$tipContainer)},tips:[],timer:[],show:function(t,i,e){t=t||"normal";var s=this,a={$el:$('<div class="di-tip '+t+'">'+(i||"gei ge ")+"</div>"),type:t,msg:i,timer:function(){a.$el.stop().fadeOut(function(){a.$el.remove()}),s.tips.splice(this.index,1)}};this.tips.push(a),a.index=this.tips.length-1,window.setTimeout(a.timer,this.options.delay||2e3),this.$tipContainer.append(a.$el)}},i}),define("widgets/dialog",["./button","./widget","../common/util","./tip","jquery"],function(t,i,e,s){function a(t){return this.options=t,this}function n(){return'<div style="display: none;" class="upphoto_box clear" id="camera_error_load"><div class="text_c"><i class="ico nocamera-ico"></i> </div><h2 class="fs16 text_c"><b>暂未检测到摄像头！</b><br><a href="#"  data-action="reload" style="margin: 10px;"  class="btn btnred btnsizeform lh38 w95">重新加载</a></h2></div>'}function o(){if(!this.isTakeOver()){this.$els.dialog={},h.call(this),p.call(this),c.call(this);var t=this.$els.dialog.$container.append(this.$els.dialog.$title).append(this.$els.dialog.$body);$("body").append(t).append(r.call(this)),this.options.closeAble||t.find(".cameras-dialog-close").remove(),this.$els.$tip=new s({appendTo:this.$els.dialog.$body}),this.center(),l.call(this)}}function r(){return this.$els.dialog.$mask=$('<div class="mask"></div>')}function h(){return this.$els.dialog.$container=$('<div class="cameras-dialog"></div>')}function c(){return this.$els.dialog.$title=$('<div class="cameras-dialog-header posrel"><div class="cameras-dialog-tit">人员图像采集<span></span></div><div class="cameras-dialog-close ico" data-action="close"></div></div>')}function l(){var t=this;this.$els.dialog.$container.bind("click",function(i){i.preventDefault();var e=$(i.target).data();e&&e.action&&"all"!==e.action&&t.events[e.action]&&t.events[e.action].call(t,i)})}function p(){return this.$els.dialog.$body=$('<div class="cameras-dialog-body"><div class="bgblue p10 fs12 mb20">温馨提醒：<br/>1.本平台学习会抓拍照片进行人脸比对，比对匹配方能进行学习！<br/>2.在学习过程中会不定期进行照片抓拍，识别不匹配则不能学习！<br/>3.为提高比对成功率，建议在光线佳的环境下拍照，并调整好拍照角度拍摄；照片预览效果不满意请当前页重拍 </div><div class="upphoto_box clear" id="camera_container_main"><div class="left"><div class="loading" id="'+w+'">加载中...</div><div class="blk" id="'+f+'"></div><div class="blk"  style="display: none;" ><img  id="'+m+'"/></div></div><div class="right"><h2>照片预览</h2><div class="photo-preview" style="display: none;" id="'+g+'"><img  width="120" height="167"></div><div class="photo-preview"  id="'+v+'" id=""><i class="ico-nophoto mt30"></i><br>暂无照片 </div><div class="txt-red"><a href="#" data-action="capture" class="btn btnred btnsizeform w95 lh38">拍照</a><a href="#" style="display: none;" data-action="upload" class="btn btnred btnsizeform lh38 ml10 w95">上传</a></div></div></div>'+n()+"</div>")}var d=new e,u=+new Date,f="web_camera_wengpengfei"+u,m="web_camera_wengpengfei_cropper"+u,g="cropper_preview"+u,v="has_no_photo"+u,w="loading"+u;return d.extend(i,a),a.prototype.$els={},a.prototype.init=function(){return!this.options.takeOver&&o.call(this),this.uiInfo={containerId:f,cropperContainerId:m,cropperPreview:g,hasNoPhotoId:v},this},a.prototype.erroLoad=function(){$(' <div><div class="text_c"><i class="ico nocamera-ico"></i></div><h2 class="fs16 text_c mb50"><b>暂未检测到摄像头！</b></h2></div>')},a.prototype.center=function(){this.isTakeOver()||(this.$els.dialog.$container.css({marginLeft:-309,marginTop:-233,zIndex:1e5}),this.$els.dialog.$mask.css({zIndex:99999}))},a.prototype.isTakeOver=function(){return this.options.takeOver},a.prototype.preview=function(){return this.$els.dialog.$body.find("#"+m)},a.prototype.events={reload:function(t){this.options.events.reload&&this.options.events.reload.call(this,t,this)},close:function(t){this.$els.dialog.$container.remove(),this.options.Webcam&&this.options.Webcam.reset(),this.$els.dialog.$mask.remove()},upload:function(t){var i=this,e=$(t.target);i.imageData&&this.options.events.upload&&(e.html("上传中.."),this.options.events.upload.call(this,t,this.imageData).then(function(t){e.html("上传")},function(){e.html("上传")}))},recapture:function(t){this.captureSuccess(!1);var i;i=t&&t.target?$(t.target):this.$els.dialog.$body.find('a[data-action="capture"]'),i.html("拍照").data("action","capture").addClass("btnred").removeClass("btngray").next().hide(),this.$els.dialog.$body.find(".photo-preview > img").attr("src","")},capture:function(t){if(this.options.canCapture()){$(t.target).html("拍照中...");var i=this;i.toggleLoading(!0),i.captureSuccess(!0),this.options.events.capture.call(this,t,this).then(function(){i.toggleLoading(!1),$(t.target).html("重拍").data("action","recapture").addClass("btngray").removeClass("btnred").next().show()},function(){i.toggleLoading(!1)})}}},a.prototype.close=function(){this.$els.dialog.$container.remove(),this.options.Webcam&&this.options.Webcam.reset(),this.$els.dialog.$mask.remove()},a.prototype.captureSuccess=function(t){this.$els.dialog.$container.find("#"+m).parent()[t?"show":"hide"](),this.$els.dialog.$container.find("#"+f)[t?"hide":"show"](),this.togglePreview(t)},a.prototype.notification=function(t,i){this.isTakeOver()||this.$els.$tip.show(t,i)},a.prototype.initIndex=19900825,a.prototype.tip=function(t,i){var e="success"===t?'<i class="ico ico-smile"></i>恭喜您，人脸识别比对结果为<span class="fs16 txt-red fsbold ">匹配</span>！':'<i class="ico ico-cry"></i>人脸识别比对结果为<span class="fs16 txt-red fsbold ">不匹配</span>！请重新拍照提交！',s=$('<div class="cameras-dialog width400 posrel"><div class="cameras-dialog-body align-center" style="padding-top:35px;box-shadow: 0 0 50px;"><span data-action="close" style="position: absolute;right: 0;top: 0;padding: 0px 3px;font-weight: bold;cursor: pointer;">ｘ</span>'+e+'<span data-action="timing" class="txt-red">5</span>秒 </div></div> ');$("body").append(s),s.css({zIndex:this.initIndex++,marginLeft:-s.outerWidth()/2,marginTop:-s.outerHeight()/2});var a=3;s.timer=window.setInterval(function(){a--,a<=0?s.remove():s.find('span[data-action="timing"]').html(a)},1e3),s.bind("click",function(t){var i=$(t.target),e=i.data(),a={close:function(){s.remove(),window.clearInterval(s.timer)}};e&&e.action&&a[e.action]&&a[e.action]()})},a.prototype.togglePreview=function(t){this.$els.dialog.$body.find("#"+g)[t?"show":"hide"](),this.$els.dialog.$body.find("#"+v)[t?"hide":"show"]()},a.prototype.showTip=function(t){var i='<div class="cameras-dialog-inermask"><div class="di-mask"></div><div>'+t+"</div></div>";this.$els.dialog.$body.append($(i))},a.prototype.camerasOccur=function(t){this.$els.dialog.$container.find("#camera_container_main")[t?"show":"hide"](),this.$els.dialog.$container.find("#camera_error_load")[t?"hide":"show"](),this.$els.dialog.$container.find("#"+w)[t?"hide":"show"](),this.center()},a.prototype.toggleLoading=function(t){this.$els.dialog.$container.find("#"+w)[t?"show":"hide"]()},a}),function(t){"function"==typeof define&&define.amd?define("plugins/flashcanvaspro/flashcanvas",t):"object"==typeof exports?t(require("jquery")):t()}(function(){var q=undefined,C;return window.ActiveXObject&&!window.CanvasRenderingContext2D&&function(){function O(t){this.code=t,this.message=ga[t]}function w(t,i,e){if(!e)for(var e=[],s=0,a=t*i*4;s<a;++s)e[s]=0;this.width=t,this.height=i,this.data=e}function ha(t){this.width=t}function x(t){this.id=t.F++}function o(t){this.J=t,this.id=t.F++}function A(t,i){this.canvas=t,this.z=i,this.e=i.id.slice(8),this.G(),this.F=0,this.j=this.D="",this.d=0}function B(){}function Q(){var t=event.srcElement,i=t.parentNode;t.blur(),i.focus()}function D(){2&event.button&&event.srcElement.parentNode.setCapture()}function E(){2&event.button&&event.srcElement.parentNode.releaseCapture()}function R(){var t=event.propertyName;if("width"===t||"height"===t){var i=event.srcElement,e=i[t],s=parseInt(e,10);(isNaN(s)||s<0)&&(s="width"===t?300:150),e===s?(i.style[t]=s+"px",i.getContext("2d").K(i.width,i.height)):i[t]=s}}function S(){window.detachEvent(T,S);for(var t in m){var i,e=m[t],s=e.firstChild;for(i in s)"function"==typeof s[i]&&(s[i]=g);for(i in e)"function"==typeof e[i]&&(e[i]=g);s.detachEvent(U,Q),s.detachEvent(F,D),e.detachEvent(G,E),e.detachEvent(V,R)}window[W]=g,window[X]=g,window[Y]=g,window[H]=g,window[Z]=g}function ia(t){return t.toLowerCase()}function i(t){throw new O(t)}function $(t){var i=parseInt(t.width,10),e=parseInt(t.height,10);(isNaN(i)||i<0)&&(i=300),(isNaN(e)||e<0)&&(e=150),t.width=i,t.height=e}function I(t,i){for(var e in m){var s=m[e].getContext("2d");s.g.push(s.a.length+2),s.a.push(y,t,i)}}var g=null,r="canvas",W="CanvasRenderingContext2D",X="CanvasGradient",Y="CanvasPattern",H="FlashCanvas",Z="G_vmlCanvasManager",U="onfocus",F="onmousedown",G="onmouseup",V="onpropertychange",P="onreadystatechange",T="onunload",n;try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/[\d,]+/)[0].replace(/,/g,".")}catch(ka){n=0}var j=window[H+"Options"]||{},J=function(){var t=document.getElementsByTagName("script"),t=t[t.length-1];return document.documentMode>=8?t.src:t.getAttribute("src",4)}().replace(/[^\/]+$/,""),t=j.swfPath||J;t+=parseInt(n)>9?"flash10canvas.swf":"flash9canvas.swf";var y="4",s={},u={},aa={},K={},p={},ba={},v={},m={},z={},J="autoinit"in j?j.autoinit:1,L="turbo"in j?j.turbo:1,M=j.delay||0,ca=j.disableContextMenu||0,da=j.imageCacheSize||100,N=j.usePolicyFile||0,ea=j.proxy||"proxy.php",fa=j.save||"save.php";"10.1.53.64"===n&&(L=0,M=30),A.prototype={save:function(){this.h(15),this.I.push([this.m,this.n,this.w,this.window,this.q,this.o,this.p,this.r,this.u,this.v,this.s,this.t,this.j,this.A,this.B]),this.a.push("B")},restore:function(){var t=this.I;t.length&&(t=t.pop(),this.globalAlpha=t[0],this.globalCompositeOperation=t[1],this.strokeStyle=t[2],this.fillStyle=t[3],this.lineWidth=t[4],this.lineCap=t[5],this.lineJoin=t[6],this.miterLimit=t[7],this.shadowOffsetX=t[8],this.shadowOffsetY=t[9],this.shadowBlur=t[10],this.shadowColor=t[11],this.font=t[12],this.textAlign=t[13],this.textBaseline=t[14]),this.a.push("C")},scale:function(t,i){this.a.push("D",t,i)},rotate:function(t){this.a.push("E",t)},translate:function(t,i){this.a.push("F",t,i)},transform:function(t,i,e,s,a,n){this.a.push("G",t,i,e,s,a,n)},setTransform:function(t,i,e,s,a,n){this.a.push("H",t,i,e,s,a,n)},createLinearGradient:function(t,e,s,a){return(!isFinite(t)||!isFinite(e)||!isFinite(s)||!isFinite(a))&&i(9),this.a.push("M",t,e,s,a),new o(this)},createRadialGradient:function(t,e,s,a,n,r){return(!isFinite(t)||!isFinite(e)||!isFinite(s)||!isFinite(a)||!isFinite(n)||!isFinite(r))&&i(9),(s<0||r<0)&&i(1),this.a.push("N",t,e,s,a,n,r),new o(this)},createPattern:function(t,e){t||i(17);var a,n,o,h=t.tagName,c=this.e;if(h)if("img"===(h=h.toLowerCase()))a=t.getAttribute("src",2);else if(h===r)n=this.C(t),o=t!==this.canvas;else{if("video"===h)return;i(17)}else t.src?a=t.src:i(17);return"repeat"===e||"no-repeat"===e||"repeat-x"===e||"repeat-y"===e||""===e||e===g||i(12),n||(n=u[c][a],(o=n===q)&&(n=this.document(a))),this.a.push("O",n,e),o&&s[c]&&(this.f(),++p[c]),new x(this)},clearRect:function(t,i,e,s){this.a.push("X",t,i,e,s),this.b||this.c(),this.d=0},fillRect:function(t,i,e,s){this.h(1),this.a.push("Y",t,i,e,s),this.b||this.c(),this.d=0},strokeRect:function(t,i,e,s){this.h(6),this.a.push("Z",t,i,e,s),this.b||this.c(),this.d=0},beginPath:function(){this.a.push("a")},closePath:function(){this.a.push("b")},moveTo:function(t,i){this.a.push("c",t,i)},lineTo:function(t,i){this.a.push("d",t,i)},quadraticCurveTo:function(t,i,e,s){this.a.push("e",t,i,e,s)},bezierCurveTo:function(t,i,e,s,a,n){this.a.push("f",t,i,e,s,a,n)},arcTo:function(t,e,s,a,n){n<0&&isFinite(n)&&i(1),this.a.push("g",t,e,s,a,n)},rect:function(t,i,e,s){this.a.push("h",t,i,e,s)},arc:function(t,e,s,a,n,o){s<0&&isFinite(s)&&i(1),this.a.push("i",t,e,s,a,n,o?1:0)},fill:function(){this.h(1),this.a.push("j"),this.b||this.c(),this.d=0},stroke:function(){this.h(6),this.a.push("document"),this.b||this.c(),this.d=0},clip:function(){this.a.push("window")},isPointInPath:function(t,i){return this.a.push("m",t,i),"true"===this.f()},fillText:function(t,i,e,s){this.h(9),this.g.push(this.a.length+1),this.a.push("r",t,i,e,s===q?Infinity:s),this.b||this.c(),this.d=0},strokeText:function(t,i,e,s){this.h(10),this.g.push(this.a.length+1),this.a.push("s",t,i,e,s===q?Infinity:s),this.b||this.c(),this.d=0},measureText:function(t){var i=z[this.e];try{i.style.font=this.font}catch(e){}return i.innerText=(""+t).replace(/[ \n\f\r]/g,"\t"),new ha(i.offsetWidth)},drawImage:function(t,e,a,n,o,h,c,l,d){t||i(17);var f,m,g,v=t.tagName,w=arguments.length,b=this.e;if(v)if("img"===(v=v.toLowerCase()))f=t.getAttribute("src",2);else if(v===r)m=this.C(t),g=t!==this.canvas;else{if("video"===v)return;i(17)}else t.src?f=t.src:i(17);if(m||(m=u[b][f],(g=m===q)&&(m=this.document(f))),this.h(0),3===w)this.a.push("u",w,m,e,a);else if(5===w)this.a.push("u",w,m,e,a,n,o);else{if(9!==w)return;(0===n||0===o)&&i(1),this.a.push("u",w,m,e,a,n,o,h,c,l,d)}g&&s[b]?(this.f(),++p[b]):this.b||this.c(),this.d=0},createImageData:function(t,e){var s=Math.ceil;return 2===arguments.length?((!isFinite(t)||!isFinite(e))&&i(9),(0===t||0===e)&&i(1)):(t instanceof w||i(9),e=t.height,t=t.width),t=s(t<0?-t:t),e=s(e<0?-e:e),new w(t,e)},getImageData:function(a,b,c,d){return(!isFinite(a)||!isFinite(b)||!isFinite(c)||!isFinite(d))&&i(9),(0===c||0===d)&&i(1),this.a.push("w",a,b,c,d),a=this.f(),c="object"==typeof JSON?JSON.parse(a):document.documentMode?eval(a):a.slice(1,-1).split(","),a=c.shift(),b=c.shift(),new w(a,b,c)},putImageData:function(t,e,s,a,n,o,r){t instanceof w||i(17),(!isFinite(e)||!isFinite(s))&&i(9);var h=arguments.length,c=t.width,l=t.height,p=t.data;3===h?this.a.push("x",h,c,l,p.toString(),e,s):7===h&&((!isFinite(a)||!isFinite(n)||!isFinite(o)||!isFinite(r))&&i(9),this.a.push("x",h,c,l,p.toString(),e,s,a,n,o,r)),this.b||this.c(),this.d=0},loadFont:function(t,i,e){var a=this.e;(i||e)&&(v[a][t]=[t,i,e]),this.g.push(this.a.length+1),this.a.push("6",t),s[a]?(this.f(),++p[a]):this.b||this.c()},loadImage:function(t,i,e){var a,n=t.tagName,o=this.e;n?"img"===n.toLowerCase()&&(a=t.getAttribute("src",2)):t.src&&(a=t.src),a&&u[o][a]===q&&(n=this.document(a),(i||e)&&(v[o][n]=[t,i,e]),this.a.push("u",1,n),s[o]&&(this.f(),++p[o]))},G:function(){this.globalAlpha=this.m=1,this.globalCompositeOperation=this.n="source-over",this.fillStyle=this.window=this.strokeStyle=this.w="#000000",this.lineWidth=this.q=1,this.lineCap=this.o="butt",this.lineJoin=this.p="miter",this.miterLimit=this.r=10,this.shadowBlur=this.s=this.shadowOffsetY=this.v=this.shadowOffsetX=this.u=0,this.shadowColor=this.t="rgba(0, 0, 0, 0.0)",this.font=this.j="10px sans-serif",this.textAlign=this.A="start",this.textBaseline=this.B="alphabetic",this.a=[],this.I=[],this.i=[],this.g=[],this.b=g,this.H=1},h:function(t){var i,e=this.a;this.m!==this.globalAlpha&&e.push("I",this.m=this.globalAlpha),this.n!==this.globalCompositeOperation&&e.push("J",this.n=this.globalCompositeOperation),this.u!==this.shadowOffsetX&&e.push("T",this.u=this.shadowOffsetX),this.v!==this.shadowOffsetY&&e.push("U",this.v=this.shadowOffsetY),this.s!==this.shadowBlur&&e.push("V",this.s=this.shadowBlur),this.t!==this.shadowColor&&(i=this.t=this.shadowColor,(""+i).indexOf("%")>0&&this.i.push(e.length+1),e.push("W",i)),1&t&&this.window!==this.fillStyle&&(i=this.window=this.fillStyle,"string"==typeof i?(i.indexOf("%")>0&&this.i.push(e.length+1),e.push("L",i)):(i instanceof o||i instanceof x)&&e.push("L",i.id)),2&t&&this.w!==this.strokeStyle&&(i=this.w=this.strokeStyle,"string"==typeof i?(i.indexOf("%")>0&&this.i.push(e.length+1),e.push("K",i)):(i instanceof o||i instanceof x)&&e.push("K",i.id)),4&t&&(this.q!==this.lineWidth&&e.push("P",this.q=this.lineWidth),this.o!==this.lineCap&&e.push("Q",this.o=this.lineCap),this.p!==this.lineJoin&&e.push("R",this.p=this.lineJoin),this.r!==this.miterLimit&&e.push("S",this.r=this.miterLimit)),8&t&&(this.j!==this.font&&(t=z[this.e].offsetHeight,this.g.push(e.length+2),e.push("o",t,this.j=this.font)),this.A!==this.textAlign&&e.push("p",this.A=this.textAlign),this.B!==this.textBaseline&&e.push("q",this.B=this.textBaseline),this.D!==this.canvas.currentStyle.direction&&e.push("1",this.D=this.canvas.currentStyle.direction))},c:function(){var t=this;t.b=setTimeout(function(){p[t.e]?t.c():(t.b=g,t.f(L))},M)},L:function(){clearTimeout(this.b),this.b=g},f:function(t){var i,e,s,a=this.i,n=this.g,o=this.a,r=this.z;if(o.length){if(this.b&&this.L(),t){for(i=0,e=a.length;i<e;++i)s=a[i],o[s]=encodeURI(o[s]);for(i=0,e=n.length;i<e;++i)s=n[i],o[s]=encodeURIComponent(o[s])}else for(i=0,e=n.length;i<e;++i)s=n[i],o[s]=(""+o[s]).replace(/&/g,"&amp;").replace(/</g,"&lt;");if(i=o.join(""),this.a=[],this.i=[],this.g=[],console.log(r),!t)return r.CallFunction('<invoke name="executeCommand" returntype="javascript"><arguments><string>'+i+"</string></arguments></invoke>");r.flashvars="c="+i,r.width=r.clientWidth+this.H,this.H^=-2}},K:function(t,i){this.f(),this.G(),t>0&&(this.z.width=t),i>0&&(this.z.height=i),this.a.push("2",t,i),this.b||this.c(),this.d=0},C:function(t){var e=t.getContext("2d").e,s=r+":"+e;return(0===t.width||0===t.height)&&i(11),e===this.e||(t=m[e].getContext("2d"),t.d)||(e=++ba[e],s+=":"+e,t.a.push("3",e),t.b||t.c(),t.d=1),s},document:function(t){var i=this.e,e=u[i],s=aa[i],a=e[t]=K[i]++;return a>=da-1&&(K[i]=0),a in s&&delete e[s[a]],this.g.push(this.a.length+2),this.a.push("5",a,t),s[a]=t,a}},o.prototype={addColorStop:function(t,e){(isNaN(t)||t<0||t>1)&&i(1);var s=this.J,a=this.id;(""+e).indexOf("%")>0&&s.i.push(s.a.length+3),s.a.push("y",a,t,e)}},O.prototype=Error();var ga={1:"INDEX_SIZE_ERR",9:"NOT_SUPPORTED_ERR",11:"INVALID_STATE_ERR",12:"SYNTAX_ERR",17:"TYPE_MISMATCH_ERR",18:"SECURITY_ERR"};C={initElement:function(i){if(i.getContext)return i;var e=Math.random().toString(36).slice(2)||"0",a="external"+e;s[e]=0,u[e]={},aa[e]=[],K[e]=0,p[e]=1,ba[e]=0,v[e]=[],$(i),i.innerHTML='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+location.protocol+'//fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="100%" height="100%" id="'+a+'"><param name="allowScriptAccess" value="always"><param name="flashvars" value="id='+a+'"><param name="wmode" value="transparent"></object><span style="margin:0;padding:0;border:0;display:inline-block;position:static;height:1em;overflow:visible;white-space:nowrap"></span>',m[e]=i;var n=i.firstChild;z[e]=i.lastChild;var o=document.body.contains;if(o(i))n.movie=t;else var r=setInterval(function(){o(i)&&(clearInterval(r),n.movie=t)},0);"BackCompat"!==document.compatMode&&window.XMLHttpRequest||(z[e].style.overflow="hidden");var h=new A(i,n);return i.getContext=function(t){return"2d"===t?h:g},i.toDataURL=function(t,e){return 0===i.width||0===i.height?"data:,":("image/jpeg"===(""+t).replace(/[A-Z]+/g,ia)?h.a.push("A",t,"number"==typeof e?e:""):h.a.push("A",t),h.f().slice(1,-1))},n.attachEvent(U,Q),ca&&(n.attachEvent(F,D),i.attachEvent(G,E)),N&&h.a.push(y,"usePolicyFile",N),e=h.a.length,h.g.push(e+2,e+5),h.a.push(y,"proxy",ea,y,"save",fa),i},saveImage:function(t,i){t.firstChild.saveImage(i)},setOptions:function(t){for(var i in t){var e=t[i];switch(i){case"turbo":L=e;break;case"delay":M=e;break;case"disableContextMenu":ca=e;var s=void 0;for(s in m){var a=m[s],n=e?"attachEvent":"detachEvent";a.firstChild[n](F,D),a[n](G,E)}break;case"imageCacheSize":da=e;break;case"usePolicyFile":I(i,N=e?1:0);break;case"proxy":I(i,ea=e);break;case"save":I(i,fa=e)}}},trigger:function(t,i){m[t].fireEvent("on"+i)},unlock:function(t,i,e){var a,n,o;p[t]&&--p[t],i===q?(a=m[t],i=a.firstChild,$(a),n=a.width,e=a.height,a.style.width=n+"px",a.style.height=e+"px",n>0&&(i.width=n),e>0&&(i.height=e),i.resize(n,e),a.attachEvent(V,R),s[t]=1,"function"==typeof a.onload&&setTimeout(function(){a.onload()},0)):(o=v[t][i])&&(n=o[0],e=o[1+e],delete v[t][i],"function"==typeof e&&e.call(n))}},document.createElement(r),document.createStyleSheet().cssText=r+"{display:inline-block;overflow:hidden;width:300px;height:150px}",J&&("complete"===document.readyState||document.attachEvent("onreadystatechange",B)),window.attachEvent(T,S),0===t.indexOf(location.protocol+"//"+location.host+"/")&&(n=new ActiveXObject("Microsoft.XMLHTTP"),n.open("GET",t,!1),n.send(g)),window[W]=A,window[X]=o,window[Y]=x,window[H]=C,window[Z]={init:function(){},init_:function(){},initElement:C.initElement}}(),C||(C={initElement:function(){}}),C}),define("plugins/webcam/webcam",["../flashcanvaspro/flashcanvas"],function(t){function i(){var t=Error.apply(this,arguments);t.name=this.name="FlashError",this.stack=t.stack,this.message=t.message}function e(){var t=Error.apply(this,arguments);t.name=this.name="WebcamError",this.stack=t.stack,this.message=t.message}var s,a=document.createElement("canvas");t.initElement(a);var n=function(){};n.prototype=Error.prototype,i.prototype=new n,e.prototype=new n;var o={version:"1.0.22",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,iOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:!0,iosPlaceholderText:"Click here to open camera.",user_callback:null,user_canvas:null},errors:{FlashError:i,WebcamError:e},hooks:{},init:function(){var t=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(t){return new Promise(function(i,e){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,t,i,e)})}}:null,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,this.userMedia=this.userMedia&&!!this.mediaDevices&&!!window.URL,navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(this.userMedia=null),this.userMedia&&window.addEventListener("beforeunload",function(i){t.reset()})},setFlashCanvasPath:function(i){t&&(window.FlashCanvasOptions={swfPath:i})},exifOrientation:function(t){var i=new DataView(t);if(255!=i.getUint8(0)||216!=i.getUint8(1))return console.log("Not a valid JPEG file"),0;for(var e=2;e<t.byteLength;){if(255!=i.getUint8(e))return console.log("Not a valid marker at offset "+e+", found: "+i.getUint8(e)),0;if(225==i.getUint8(e+1)){e+=4;var s,a="";for(s=0;s<4;s++)a+=String.fromCharCode(i.getUint8(e+s));if("Exif"!=a)return console.log("Not valid EXIF data found"),0;e+=6;var n=null;if(18761==i.getUint16(e))n=!1;else{if(19789!=i.getUint16(e))return console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),0;n=!0}if(42!=i.getUint16(e+2,!n))return console.log("Not valid TIFF data! (no 0x002A)"),0;var o=i.getUint32(e+4,!n);if(o<8)return console.log("Not valid TIFF data! (First offset less than 8)",i.getUint32(e+4,!n)),0;for(var r=e+o,h=i.getUint16(r,!n),c=0;c<h;c++){var l=r+12*c+2;if(274==i.getUint16(l,!n)){var p=i.getUint16(l+2,!n),d=i.getUint32(l+4,!n);if(3!=p&&1!=d)return console.log("Invalid EXIF orientation value type ("+p+") or count ("+d+")"),0;var u=i.getUint16(l+8,!n);return u<1||u>8?(console.log("Invalid EXIF orientation value ("+u+")"),0):u}}}else e+=2+i.getUint16(e+2)}return 0},fixOrientation:function(t,i,e){var s=new Image;s.addEventListener("load",function(t){var n=a.getContext("2d");switch(i<5?(a.width=s.width,a.height=s.height):(a.width=s.height,a.height=s.width),i){case 2:n.transform(-1,0,0,1,s.width,0);break;case 3:n.transform(-1,0,0,-1,s.width,s.height);break;case 4:n.transform(1,0,0,-1,0,s.height);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,s.height,0);break;case 7:n.transform(0,-1,-1,0,s.height,s.width);break;case 8:n.transform(0,-1,1,0,0,s.width)}n.drawImage(s,0,0),e.src=a.toDataURL()},!1),s.src=t},attach:function(t){if("string"==typeof t&&(t=document.getElementById(t)||document.querySelector(t)),!t)return this.dispatch("error",new e("Could not locate DOM element to attach to."));this.container=t,t.innerHTML="";var i=document.createElement("div");if(t.appendChild(i),this.peg=i,this.params.width||(this.params.width=t.offsetWidth),this.params.height||(this.params.height=t.offsetHeight),!this.params.width||!this.params.height)return this.dispatch("error",new e("No width and/or height for webcam.  Please call set() first, or attach to a visible element."));this.params.dest_width||(this.params.dest_width=this.params.width),this.params.dest_height||(this.params.dest_height=this.params.height),this.userMedia=s===undefined?this.userMedia:s,this.params.force_flash&&(s=this.userMedia,this.userMedia=null),"number"!=typeof this.params.fps&&(this.params.fps=30);var a=this.params.width/this.params.dest_width,n=this.params.height/this.params.dest_height;if(this.userMedia){var r=document.createElement("video");r.setAttribute("autoplay","autoplay"),r.style.width=this.params.dest_width+"px",r.style.height=this.params.dest_height+"px",1==a&&1==n||(t.style.overflow="hidden",r.style.webkitTransformOrigin="0px 0px",r.style.mozTransformOrigin="0px 0px",r.style.msTransformOrigin="0px 0px",r.style.oTransformOrigin="0px 0px",r.style.transformOrigin="0px 0px",r.style.webkitTransform="scaleX("+a+") scaleY("+n+")",r.style.mozTransform="scaleX("+a+") scaleY("+n+")",r.style.msTransform="scaleX("+a+") scaleY("+n+")",r.style.oTransform="scaleX("+a+") scaleY("+n+")",r.style.transform="scaleX("+a+") scaleY("+n+")"),t.appendChild(r),this.video=r;var h=this;this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(t){r.onloadedmetadata=function(i){h.stream=t,h.loaded=!0,h.live=!0,h.dispatch("load"),h.dispatch("live"),h.flip()},r.src=window.URL.createObjectURL(t)||t})["catch"](function(i){h.params.enable_flash&&h.detectFlash()?setTimeout(function(){h.params.force_flash=1,h.attach(t)},1):h.dispatch("error",i)})}else if(this.iOS){var c=document.createElement("div");c.id=this.container.id+"-ios_div",c.className="webcamjs-ios-placeholder",c.style.width=this.params.width+"px",c.style.height=this.params.height+"px",c.style.textAlign="center",c.style.display="table-cell",c.style.verticalAlign="middle",c.style.backgroundRepeat="no-repeat",c.style.backgroundSize="contain",c.style.backgroundPosition="center";var l=document.createElement("span");l.className="webcamjs-ios-text",l.innerHTML=this.params.iosPlaceholderText,c.appendChild(l);var p=document.createElement("img");p.id=this.container.id+"-ios_img",p.style.width=this.params.dest_width+"px",p.style.height=this.params.dest_height+"px",p.style.display="none",c.appendChild(p);var d=document.createElement("input");d.id=this.container.id+"-ios_input",d.setAttribute("type","file"),d.setAttribute("accept","image/*"),d.setAttribute("capture","camera");var h=this,u=this.params;d.addEventListener("change",function(t){if(t.target.files.length>0&&0==t.target.files[0].type.indexOf("image/")){var i=URL.createObjectURL(t.target.files[0]),e=new Image;e.addEventListener("load",function(t){var i=document.createElement("canvas");i.width=u.dest_width,i.height=u.dest_height;var s=i.getContext("2d"),a=Math.min(e.width/u.dest_width,e.height/u.dest_height),n=u.dest_width*a,o=u.dest_height*a,r=(e.width-n)/2,h=(e.height-o)/2;s.drawImage(e,r,h,n,o,0,0,u.dest_width,u.dest_height);var l=i.toDataURL();p.src=l,c.style.backgroundImage="url('"+l+"')"},!1);var s=new FileReader;s.addEventListener("load",function(t){var s=h.exifOrientation(t.target.result);s>1?h.fixOrientation(i,s,e):e.src=i},!1);var a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="blob",a.onload=function(t){200!=this.status&&0!==this.status||s.readAsArrayBuffer(this.response)},a.send()}},!1),d.style.display="none",t.appendChild(d),c.addEventListener("click",function(t){u.user_callback?h.snap(u.user_callback,u.user_canvas):(d.style.display="block",d.focus(),d.click(),d.style.display="none")},!1),t.appendChild(c),this.loaded=!0,this.live=!0}else if(this.params.enable_flash&&this.detectFlash()){window.Webcam=o;var c=document.createElement("div");c.innerHTML=this.getSWFHTML(),t.appendChild(c)}else this.dispatch("error",new e(this.params.noInterfaceFoundText));if(this.params.crop_width&&this.params.crop_height){var f=Math.floor(this.params.crop_width*a),m=Math.floor(this.params.crop_height*n);t.style.width=f+"px",
t.style.height=m+"px",t.style.overflow="hidden",t.scrollLeft=Math.floor(this.params.width/2-f/2),t.scrollTop=Math.floor(this.params.height/2-m/2)}else t.style.width=this.params.width+"px",t.style.height=this.params.height+"px"},reset:function(){if(this.preview_active&&this.unfreeze(),this.unflip(),this.userMedia){if(this.stream)if(this.stream.getVideoTracks){var t=this.stream.getVideoTracks();t&&t[0]&&t[0].stop&&t[0].stop()}else this.stream.stop&&this.stream.stop();delete this.stream,delete this.video}if(this.userMedia!==!0&&this.loaded&&!this.iOS){var i=this.getMovie();i&&i._releaseCamera&&i._releaseCamera()}this.container&&(this.container.innerHTML="",delete this.container),this.loaded=!1,this.live=!1},set:function(){if(1==arguments.length)for(var t in arguments[0])this.params[t]=arguments[0][t];else this.params[arguments[0]]=arguments[1]},on:function(t,i){t=t.replace(/^on/i,"").toLowerCase(),this.hooks[t]||(this.hooks[t]=[]),this.hooks[t].push(i)},off:function(t,i){if(t=t.replace(/^on/i,"").toLowerCase(),this.hooks[t])if(i){var e=this.hooks[t].indexOf(i);e>-1&&this.hooks[t].splice(e,1)}else this.hooks[t]=[]},dispatch:function(){var t,s=arguments[0].replace(/^on/i,"").toLowerCase(),a=Array.prototype.slice.call(arguments,1);if(this.hooks[s]&&this.hooks[s].length){for(var n=0,o=this.hooks[s].length;n<o;n++){var r=this.hooks[s][n];"function"==typeof r?r.apply(this,a):"object"==typeof r&&2==r.length?r[0][r[1]].apply(r[0],a):window[r]&&window[r].apply(window,a)}return!0}return"error"==s&&(t=a[0]instanceof i||a[0]instanceof e?a[0].message:"Could not access webcam: "+a[0].name+": "+a[0].message+" "+a[0].toString(),alert("Webcam.js Error: "+t)),!1},setSWFLocation:function(t){this.set("swfURL",t)},detectFlash:function(){var t=window,i=navigator,e=!1;if("undefined"!=typeof i.plugins&&"object"==typeof i.plugins["Shockwave Flash"]){i.plugins["Shockwave Flash"].description&&"undefined"!=typeof i.mimeTypes&&i.mimeTypes["application/x-shockwave-flash"]&&i.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(e=!0)}else if("undefined"!=typeof t.ActiveXObject)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(s){var a=s.GetVariable("$version");a&&(e=!0)}}catch(n){}return e},getSWFHTML:function(){var t="",e=this.params.swfURL;if(location.protocol.match(/file/))return this.dispatch("error",new i("Flash does not work from local disk.  Please run from a web server.")),'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';if(!this.detectFlash())return this.dispatch("error",new i("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.")),'<h3 style="color:red">'+this.params.flashNotDetectedText+"</h3>";if(!e){for(var s="",a=document.getElementsByTagName("script"),n=0,o=a.length;n<o;n++){var r=a[n].getAttribute("src");r&&r.match(/\/webcam(\.min)?\.js/)&&(s=r.replace(/\/webcam(\.min)?\.js.*$/,""),n=o)}e=s?s+"/webcam.swf":"webcam.swf"}window.localStorage&&!localStorage.getItem("visited")&&(this.params.new_user=1,localStorage.setItem("visited",1));var h="";for(var c in this.params)h&&(h+="&"),h+=c+"="+escape(this.params[c]);return t+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+e+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+h+'"/><embed id="webcam_movie_embed" src="'+e+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+h+'"></embed></object>'},getMovie:function(){if(!this.loaded)return this.dispatch("error",new i("Flash Movie is not loaded yet"));var t=document.getElementById("webcam_movie_obj");return t&&t._snap||(t=document.getElementById("webcam_movie_embed")),t||this.dispatch("error",new i("Cannot locate Flash movie in DOM")),t},freeze:function(){var t=this,i=this.params;this.preview_active&&this.unfreeze();var e=this.params.width/this.params.dest_width,s=this.params.height/this.params.dest_height;this.unflip();var a=i.crop_width||i.dest_width,n=i.crop_height||i.dest_height,o=document.createElement("canvas");o.width=a,o.height=n;var r=o.getContext("2d");this.preview_canvas=o,this.preview_context=r,1==e&&1==s||(o.style.webkitTransformOrigin="0px 0px",o.style.mozTransformOrigin="0px 0px",o.style.msTransformOrigin="0px 0px",o.style.oTransformOrigin="0px 0px",o.style.transformOrigin="0px 0px",o.style.webkitTransform="scaleX("+e+") scaleY("+s+")",o.style.mozTransform="scaleX("+e+") scaleY("+s+")",o.style.msTransform="scaleX("+e+") scaleY("+s+")",o.style.oTransform="scaleX("+e+") scaleY("+s+")",o.style.transform="scaleX("+e+") scaleY("+s+")"),this.snap(function(){o.style.position="relative",o.style.left=t.container.scrollLeft+"px",o.style.top=t.container.scrollTop+"px",t.container.insertBefore(o,t.peg),t.container.style.overflow="hidden",t.preview_active=!0},o)},unfreeze:function(){this.preview_active&&(this.container.removeChild(this.preview_canvas),delete this.preview_context,delete this.preview_canvas,this.preview_active=!1,this.flip())},flip:function(){if(this.params.flip_horiz){var t=this.container.style;t.webkitTransform="scaleX(-1)",t.mozTransform="scaleX(-1)",t.msTransform="scaleX(-1)",t.oTransform="scaleX(-1)",t.transform="scaleX(-1)",t.filter="FlipH",t.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var t=this.container.style;t.webkitTransform="scaleX(1)",t.mozTransform="scaleX(1)",t.msTransform="scaleX(1)",t.oTransform="scaleX(1)",t.transform="scaleX(1)",t.filter="",t.msFilter=""}},savePreview:function(t,i){var e=this.params,s=this.preview_canvas,a=this.preview_context;if(i){i.getContext("2d").drawImage(s,0,0)}t(i?null:s.toDataURL("image/"+e.image_format,e.jpeg_quality/100),s,a),this.params.unfreeze_snap&&this.unfreeze()},snap:function(t,i){t||(t=this.params.user_callback),i||(i=this.params.user_canvas);var s=this.params;if(!this.loaded)return this.dispatch("error",new e("Webcam is not loaded yet"));if(!t)return this.dispatch("error",new e("Please provide a callback function or canvas to snap()"));if(this.preview_active)return this.savePreview(t,i),null;a.width=this.params.dest_width,a.height=this.params.dest_height;var n=a.getContext("2d");this.params.flip_horiz&&(n.translate(s.dest_width,0),n.scale(-1,1));var o=this,r=function(){if(o.src&&o.width&&o.height&&n.drawImage(o,0,0,s.dest_width,s.dest_height),s.crop_width&&s.crop_height){var e=document.createElement("canvas");e.width=s.crop_width,e.height=s.crop_height;var r=e.getContext("2d");r.drawImage(a,Math.floor(s.dest_width/2-s.crop_width/2),Math.floor(s.dest_height/2-s.crop_height/2),s.crop_width,s.crop_height,0,0,s.crop_width,s.crop_height),n=r,a=e}if(i){i.getContext("2d").drawImage(a,0,0)}t(i?null:a.toDataURL("image/"+s.image_format,s.jpeg_quality/100),a,n)};if(this.userMedia)n.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height),r();else if(this.iOS){var h=document.getElementById(this.container.id+"-ios_div"),c=document.getElementById(this.container.id+"-ios_img"),l=document.getElementById(this.container.id+"-ios_input"),p=function(t){r.call(c),c.removeEventListener("load",p),h.style.backgroundImage="none",c.removeAttribute("src"),l.value=null};l.value?p():(c.addEventListener("load",p),l.style.display="block",l.focus(),l.click(),l.style.display="none")}else{var d=this.getMovie()._snap();t("data:image/"+this.params.image_format+";base64,"+d,a,n)}return null},configure:function(t){t||(t="camera"),this.getMovie()._configure(t)},flashNotify:function(t,e){switch(t){case"flashLoadComplete":this.loaded=!0,this.dispatch("load");break;case"cameraLive":this.live=!0,this.dispatch("live");break;case"error":this.dispatch("error",new i(e))}},b64ToUint6:function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0},base64DecToArr:function(t,i){for(var e,s,a=t.replace(/[^A-Za-z0-9\+\/]/g,""),n=a.length,o=i?Math.ceil((3*n+1>>2)/i)*i:3*n+1>>2,r=new Uint8Array(o),h=0,c=0,l=0;l<n;l++)if(s=3&l,h|=this.b64ToUint6(a.charCodeAt(l))<<18-6*s,3===s||n-l==1){for(e=0;e<3&&c<o;e++,c++)r[c]=h>>>(16>>>e&24)&255;h=0}return r},upload:function(t,i,e){var s=this.params.upload_name||"webcam",a="";if(!t.match(/^data\:image\/(\w+)/))throw"Cannot locate image format in Data URI";a=RegExp.$1;var n=t.replace(/^data\:image\/\w+\;base64\,/,""),r=new XMLHttpRequest;r.open("POST",i,!0),r.upload&&r.upload.addEventListener&&r.upload.addEventListener("progress",function(t){if(t.lengthComputable){var i=t.loaded/t.total;o.dispatch("uploadProgress",i,t)}},!1);var h=this;r.onload=function(){e&&e.apply(h,[r.status,r.responseText,r.statusText]),o.dispatch("uploadComplete",r.status,r.responseText,r.statusText)};var c=new Blob([this.base64DecToArr(n)],{type:"image/"+a}),l=new FormData;l.append(s,c,s+"."+a.replace(/e/,"")),r.send(l)}};return o.init(),o}),function(t){"function"==typeof define&&define.amd?define("cropper",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return void 0===t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function a(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function n(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==m.protocol||i[2]!==m.hostname||i[3]!==m.port)}function o(t){var i="timestamp="+(new Date).getTime();return t+(t.indexOf("?")===-1?"?":"&")+i}function r(t){return t?' crossOrigin="'+t+'"':""}function h(t,i){var e;if(t.naturalWidth)return i(t.naturalWidth,t.naturalHeight);e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},e.src=t.src}function c(t){var e=[],s=t.rotate,a=t.scaleX,n=t.scaleY;return i(s)&&e.push("rotate("+s+"deg)"),i(a)&&i(n)&&e.push("scale("+a+","+n+")"),e.length?e.join(" "):"none"}function l(t,i){var e,s,a=$(t.degree)%180,n=(a>90?180-a:a)*Math.PI/180,o=_(n),r=T(n),h=t.width,c=t.height,l=t.aspectRatio;return i?(e=h/(r+o/l),s=e/l):(e=h*r+c*o,s=h*o+c*r),{width:e,height:s}}function p(e,s){var a,n,o,r=t("<canvas>")[0],h=r.getContext("2d"),c=0,p=0,d=s.naturalWidth,u=s.naturalHeight,f=s.rotate,m=s.scaleX,g=s.scaleY,v=i(m)&&i(g)&&(1!==m||1!==g),w=i(f)&&0!==f,b=w||v,x=d,y=u;return v&&(a=d/2,n=u/2),w&&(o=l({width:d,height:u,degree:f}),x=o.width,y=o.height,a=o.width/2,n=o.height/2),r.width=x,r.height=y,b&&(c=-d/2,p=-u/2,h.save(),h.translate(a,n)),w&&h.rotate(f*Math.PI/180),v&&h.scale(m,g),h.drawImage(e,c,p,d,u),b&&h.restore(),r}function d(i,e){this.$element=t(i),this.options=t.extend({},d.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.isImg=!1,this.originalUrl="",this.crossOrigin="",this.canvas=null,this.cropBox=null,this.init()}var u=t(window),f=t(document),m=window.location,g="cropper-hidden",v="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",w=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,b=t.isFunction(t("<canvas>")[0].getContext),x=Number,y=Math.min,C=Math.max,$=Math.abs,_=Math.sin,T=Math.cos,k=Math.sqrt,D=Math.round,L={version:"2.0.0"};t.extend(L,{init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&b&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,a=this.options,h=this.$element,c="";i&&(this.url=i,h.one("build.cropper",a.build),this.trigger("build.cropper").isDefaultPrevented()||(a.checkCrossOrigin&&n(i)&&((c=h.prop("crossOrigin"))||(c="anonymous",e=o(i))),this.crossOrigin=c,this.$clone=s=t("<img"+r(c)+' src="'+(e||i)+'">'),this.isImg?h[0].complete?this.start():h.one("load.cropper",t.proxy(this.start,this)):s.one("load.cropper",t.proxy(this.start,this)).one("error.cropper",t.proxy(this.stop,this)).addClass("cropper-hide").insertAfter(h)))},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off("error.cropper",this.stop),i=e),h(i[0],t.proxy(function(t,i){this.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i},this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null}}),t.extend(L,{build:function(){var i,e,s,a=this.options,n=this.$element,o=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=n.parent(),this.$cropper=i=t(d.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(o),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),n.addClass(g).after(i),this.isImg||o.removeClass("cropper-hide"),this.initPreview(),this.bind(),a.aspectRatio=C(0,a.aspectRatio)||NaN,a.viewMode=C(0,y(3,D(a.viewMode)))||0,a.autoCrop?(this.isCropped=!0,a.modal&&this.$dragBox.addClass("cropper-modal")):e.addClass(g),a.guides||e.find(".cropper-dashed").addClass(g),a.center||e.find(".cropper-center").addClass(g),a.cropBoxMovable&&s.addClass("cropper-move").data("action","all"),a.highlight||s.addClass("cropper-invisible"),a.background&&i.addClass("cropper-bg"),a.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(g),this.setDragMode(a.dragMode),this.render(),this.isBuilt=!0,this.setData(a.data),n.one("built.cropper",a.built),setTimeout(t.proxy(function(){this.trigger("built.cropper"),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(L,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(g),i.removeClass(g),s.css(this.container={width:C(e.width(),x(t.minContainerWidth)||200),height:C(e.height(),x(t.minContainerHeight)||100)}),i.addClass(g),s.removeClass(g)},initCanvas:function(){var i=this.options.viewMode,e=this.container,s=e.width,a=e.height,n=this.image,o=n.aspectRatio,r={naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight,aspectRatio:o,width:s,height:a};a*o>s?3===i?r.width=a*o:r.height=s/o:3===i?r.height=s/o:r.width=a*o,r.oldLeft=r.left=(s-r.width)/2,r.oldTop=r.top=(a-r.height)/2,this.canvas=r,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=t.extend({},n),this.initialCanvas=t.extend({},r)},limitCanvas:function(t,i){var e,s,a,n,o=this.options,r=o.viewMode,h=this.container,c=h.width,l=h.height,p=this.canvas,d=p.aspectRatio,u=this.cropBox,f=this.isCropped&&u;t&&(e=x(o.minCanvasWidth)||0,s=x(o.minCanvasHeight)||0,r&&(r>1?(e=C(e,c),s=C(s,l),3===r&&(s*d>e?e=s*d:s=e/d)):e?e=C(e,f?u.width:0):s?s=C(s,f?u.height:0):f&&(e=u.width,s=u.height,s*d>e?e=s*d:s=e/d)),e&&s?s*d>e?s=e/d:e=s*d:e?s=e/d:s&&(e=s*d),p.minWidth=e,p.minHeight=s,p.maxWidth=Infinity,p.maxHeight=Infinity),i&&(r?(a=c-p.width,n=l-p.height,p.minLeft=y(0,a),p.minTop=y(0,n),p.maxLeft=C(0,a),p.maxTop=C(0,n),f&&this.isLimited&&(p.minLeft=y(u.left,u.left+u.width-p.width),p.minTop=y(u.top,u.top+u.height-p.height),p.maxLeft=u.left,p.maxTop=u.top,2===r&&(p.width>=c&&(p.minLeft=y(0,a),p.maxLeft=C(0,a)),p.height>=l&&(p.minTop=y(0,n),p.maxTop=C(0,n))))):(p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=c,p.maxTop=l))},renderCanvas:function(t){var i,e,s=this.canvas,a=this.image,n=a.rotate,o=a.naturalWidth,r=a.naturalHeight;this.isRotated&&(this.isRotated=!1,e=l({width:a.width,height:a.height,degree:n}),(i=e.width/e.height)!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=o,s.naturalHeight=r,n%180&&(e=l({width:o,height:r,degree:n}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=y(C(s.width,s.minWidth),s.maxWidth),s.height=y(C(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=y(C(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=y(C(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,a=this.image;a.rotate&&(e=l({width:s.width,height:s.height,degree:a.rotate,aspectRatio:a.aspectRatio},!0)),t.extend(a,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:a.width,height:a.height,marginLeft:a.left,marginTop:a.top,transform:c(a)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,a=x(i.autoCropArea)||.8,n={width:e.width,height:e.height};s&&(e.height*s>e.width?n.height=n.width/s:n.width=n.height*s),this.cropBox=n,this.limitCropBox(!0,!0),n.width=y(C(n.width,n.minWidth),n.maxWidth),n.height=y(C(n.height,n.minHeight),n.maxHeight),n.width=C(n.minWidth,n.width*a),n.height=C(n.minHeight,n.height*a),n.oldLeft=n.left=e.left+(e.width-n.width)/2,n.oldTop=n.top=e.top+(e.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,i){var e,s,a,n,o=this.options,r=o.aspectRatio,h=this.container,c=h.width,l=h.height,p=this.canvas,d=this.cropBox,u=this.isLimited;t&&(e=x(o.minCropBoxWidth)||0,s=x(o.minCropBoxHeight)||0,e=y(e,c),s=y(s,l),a=y(c,u?p.width:c),n=y(l,u?p.height:l),r&&(e&&s?s*r>e?s=e/r:e=s*r:e?s=e/r:s&&(e=s*r),n*r>a?n=a/r:a=n*r),d.minWidth=y(e,a),d.minHeight=y(s,n),d.maxWidth=a,d.maxHeight=n),i&&(u?(d.minLeft=C(0,p.left),d.minTop=C(0,p.top),d.maxLeft=y(c,p.left+p.width)-d.width,d.maxTop=y(l,p.top+p.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=c-d.width,d.maxTop=l-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,a=this.cropBox;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=y(C(a.width,a.minWidth),a.maxWidth),a.height=y(C(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.oldLeft=a.left=y(C(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=y(C(a.top,a.minTop),a.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("action",a.width===e&&a.height===s?"move":"all"),this.$cropBox.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted?this.trigger("crop.cropper",this.getData()):this.isBuilt||this.$element.one("built.cropper",t.proxy(function(){this.trigger("crop.cropper",this.getData())},this))}}),t.extend(L,{initPreview:function(){var i=r(this.crossOrigin),e=this.url;this.$preview=t(this.options.preview),this.$viewBox.html("<img"+i+' src="'+e+'">'),this.$preview.each(function(){var s=t(this);s.data("preview",{width:s.width(),height:s.height(),html:s.html()}),s.html("<img"+i+' src="'+e+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data("preview");i.css({width:e.width,height:e.height}).html(e.html).removeData("preview")})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,a=s.width,n=s.height,o=i.width,r=i.height,h=s.left-e.left-i.left,l=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$viewBox.find("img").css({width:o,height:r,marginLeft:-h,marginTop:-l,transform:c(i)}),this.$preview.each(function(){var e=t(this),s=e.data("preview"),p=s.width,d=s.height,u=p,f=d,m=1;a&&(m=p/a,f=n*m),n&&f>d&&(m=d/n,u=a*m,f=d),e.css({width:u,height:f}).find("img").css({width:o*m,height:r*m,marginLeft:-h*m,marginTop:-l*m,transform:c(i)})}))}}),t.extend(L,{bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on("cropstart.cropper",i.cropstart),t.isFunction(i.cropmove)&&e.on("cropmove.cropper",i.cropmove),t.isFunction(i.cropend)&&e.on("cropend.cropper",i.cropend),t.isFunction(i.crop)&&e.on("crop.cropper",i.crop),t.isFunction(i.zoom)&&e.on("zoom.cropper",i.zoom),s.on("mousedown touchstart pointerdown MSPointerDown",t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on("wheel mousewheel DOMMouseScroll",t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on("dblclick",t.proxy(this.dblclick,this)),f.on("mousemove touchmove pointermove MSPointerMove",this._cropMove=a(this.cropMove,this)).on(v,this._cropEnd=a(this.cropEnd,this)),i.responsive&&u.on("resize.cropper",this._resize=a(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off("cropstart.cropper",i.cropstart),t.isFunction(i.cropmove)&&e.off("cropmove.cropper",i.cropmove),t.isFunction(i.cropend)&&e.off("cropend.cropper",i.cropend),t.isFunction(i.crop)&&e.off("crop.cropper",i.crop),t.isFunction(i.zoom)&&e.off("zoom.cropper",i.zoom),s.off("mousedown touchstart pointerdown MSPointerDown",this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off("wheel mousewheel DOMMouseScroll",this.wheel),i.toggleDragModeOnDblclick&&s.off("dblclick",this.dblclick),f.off("mousemove touchmove pointermove MSPointerMove",this._cropMove).off(v,this._cropEnd),i.responsive&&u.off("resize.cropper",this._resize)}}),t.extend(L,{resize:function(){var i,e,s,a=this.$container,n=this.container;!this.isDisabled&&n&&(1===(s=a.width()/n.width)&&a.height()===n.height||(i=this.getCanvasData(),e=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s}))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass("cropper-crop")?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(t){var i=t.originalEvent,e=i||t,s=x(this.options.wheelZoomRatio)||.1,a=1;this.isDisabled||(t.preventDefault(),e.deltaY?a=e.deltaY>0?1:-1:e.wheelDelta?a=-e.wheelDelta/120:e.detail&&(a=e.detail>0?1:-1),this.zoom(-a*s,i))},cropStart:function(i){var e,s,a=this.options,n=i.originalEvent,o=n&&n.touches,r=i;if(!this.isDisabled){if(o){if((e=o.length)>1){if(!a.zoomable||!a.zoomOnTouch||2!==e)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,s="zoom"}r=o[0]}if(s=s||t(r.target).data("action"),w.test(s)){if(this.trigger("cropstart.cropper",{originalEvent:n,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=r.pageX||n&&n.pageX,this.startY=r.pageY||n&&n.pageY,"crop"===s&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal"))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,a=s&&s.touches,n=t,o=this.action;if(!this.isDisabled){if(a){if((i=a.length)>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;n=a[1],this.endX2=n.pageX,this.endY2=n.pageY}n=a[0]}if(o){if(this.trigger("cropmove.cropper",{originalEvent:s,action:o}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||s&&s.pageX,this.endY=n.pageY||s&&s.pageY,this.change(n.shiftKey,"zoom"===o?s:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.isCropped&&this.options.modal)),this.action="",this.trigger("cropend.cropper",{originalEvent:i,action:e}))}}),t.extend(L,{change:function(t,i){var e,s,a=this.options,n=a.aspectRatio,o=this.action,r=this.container,h=this.canvas,c=this.cropBox,l=c.width,p=c.height,d=c.left,u=c.top,f=d+l,m=u+p,v=0,w=0,b=r.width,x=r.height,C=!0;switch(!n&&t&&(n=l&&p?l/p:1),this.limited&&(v=c.minLeft,w=c.minTop,b=v+y(r.width,h.width),x=w+y(r.height,h.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},n&&(s.X=s.y*n,s.Y=s.x/n),o){case"all":d+=s.x,u+=s.y;break;case"e":if(s.x>=0&&(f>=b||n&&(u<=w||m>=x))){C=!1;break}l+=s.x,n&&(p=l/n,u-=s.Y/2),l<0&&(o="w",l=0);break;case"n":if(s.y<=0&&(u<=w||n&&(d<=v||f>=b))){C=!1;break}p-=s.y,u+=s.y,n&&(l=p*n,d+=s.X/2),p<0&&(o="s",p=0);break;case"w":if(s.x<=0&&(d<=v||n&&(u<=w||m>=x))){C=!1;break}l-=s.x,d+=s.x,n&&(p=l/n,u+=s.Y/2),l<0&&(o="e",l=0);break;case"s":if(s.y>=0&&(m>=x||n&&(d<=v||f>=b))){C=!1;break}p+=s.y,n&&(l=p*n,d-=s.X/2),p<0&&(o="n",p=0);break;case"ne":if(n){if(s.y<=0&&(u<=w||f>=b)){C=!1;break}p-=s.y,u+=s.y,l=p*n}else s.x>=0?f<b?l+=s.x:s.y<=0&&u<=w&&(C=!1):l+=s.x,s.y<=0?u>w&&(p-=s.y,u+=s.y):(p-=s.y,u+=s.y);l<0&&p<0?(o="sw",p=0,l=0):l<0?(o="nw",l=0):p<0&&(o="se",p=0);break;case"nw":if(n){if(s.y<=0&&(u<=w||d<=v)){C=!1;break}p-=s.y,u+=s.y,l=p*n,d+=s.X}else s.x<=0?d>v?(l-=s.x,d+=s.x):s.y<=0&&u<=w&&(C=!1):(l-=s.x,d+=s.x),s.y<=0?u>w&&(p-=s.y,u+=s.y):(p-=s.y,u+=s.y);l<0&&p<0?(o="se",p=0,l=0):l<0?(o="ne",l=0):p<0&&(o="sw",p=0);break;case"sw":if(n){if(s.x<=0&&(d<=v||m>=x)){C=!1;break}l-=s.x,d+=s.x,p=l/n}else s.x<=0?d>v?(l-=s.x,d+=s.x):s.y>=0&&m>=x&&(C=!1):(l-=s.x,d+=s.x),s.y>=0?m<x&&(p+=s.y):p+=s.y;l<0&&p<0?(o="ne",p=0,l=0):l<0?(o="se",l=0):p<0&&(o="nw",p=0);break;case"se":if(n){if(s.x>=0&&(f>=b||m>=x)){C=!1;break}l+=s.x,p=l/n}else s.x>=0?f<b?l+=s.x:s.y>=0&&m>=x&&(C=!1):l+=s.x,s.y>=0?m<x&&(p+=s.y):p+=s.y;l<0&&p<0?(o="nw",p=0,l=0):l<0?(o="sw",l=0):p<0&&(o="ne",p=0);break;case"move":this.move(s.x,s.y),C=!1;break;case"zoom":this.zoom(function(t,i,e,s){var a=k(t*t+i*i);return(k(e*e+s*s)-a)/a}($(this.startX-this.startX2),$(this.startY-this.startY2),$(this.endX-this.endX2),$(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,C=!1;break;case"crop":(s.x||s.y)&&(e=this.$cropper.offset(),d=this.startX-e.left,u=this.startY-e.top,l=c.minWidth,p=c.minHeight,s.x>0?o=s.y>0?"se":s.y<0?"ne":"e":s.x<0?(d-=l,o=s.y>0?"sw":s.y<0?"nw":"w"):o=s.y>0?"s":"n",s.y<0&&(u-=p),this.isCropped||(this.$cropBox.removeClass(g),this.isCropped=!0,this.limited&&this.limitCropBox(!0,!0)))}C&&(c.width=l,c.height=p,c.left=d,c.top=u,this.action=o,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(L,{crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass(g)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass(g))},replace:function(t){!this.isDisabled&&t&&(this.isImg&&(this.isReplaced=!0,this.$element.attr("src",t)),this.options.data=null,this.load(t))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(g)):this.isImg?t.off("load.cropper",this.start):this.$clone&&this.$clone.remove(),t.removeData("cropper")},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+x(t),e(i)?i:s.top+x(i))},moveTo:function(t,s){var a=this.canvas,n=!1;e(s)&&(s=t),t=x(t),s=x(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(a.left=t,n=!0),i(s)&&(a.top=s,n=!0),n&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=x(t),t=t<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,a=this.options,n=this.canvas,o=n.width,r=n.height,h=n.naturalWidth,c=n.naturalHeight;if((t=x(t))>=0&&this.isBuilt&&!this.isDisabled&&a.zoomable){if(e=h*t,s=c*t,this.trigger("zoom.cropper",{originalEvent:i,oldRatio:o/h,ratio:e/h}).isDefaultPrevented())return;n.left-=(e-o)/2,n.top-=(s-r)/2,n.width=e,n.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+x(t))},rotateTo:function(t){t=x(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var a=this.image,n=!1;e(s)&&(s=t),t=x(t),s=x(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(a.scaleX=t,n=!0),i(s)&&(a.scaleY=s,n=!0),n&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,a=this.options,n=this.image,o=this.canvas,r=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height},e=n.width/n.naturalWidth,t.each(s,function(t,a){a/=e,s[t]=i?D(a):a})):s={x:0,y:0,width:0,height:0},a.rotatable&&(s.rotate=n.rotate||0),a.scalable&&(s.scaleX=n.scaleX||1,s.scaleY=n.scaleY||1),s},setData:function(e){var s,a,n,o=this.options,r=this.image,h=this.canvas,c={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(o.rotatable&&i(e.rotate)&&e.rotate!==r.rotate&&(r.rotate=e.rotate,this.isRotated=s=!0),o.scalable&&(i(e.scaleX)&&e.scaleX!==r.scaleX&&(r.scaleX=e.scaleX,a=!0),i(e.scaleY)&&e.scaleY!==r.scaleY&&(r.scaleY=e.scaleY,a=!0)),s?this.renderCanvas():a&&this.renderImage(),n=r.width/r.naturalWidth,i(e.x)&&(c.left=e.x*n+h.left),i(e.y)&&(c.top=e.y*n+h.top),i(e.width)&&(c.width=e.width*n),i(e.height)&&(c.height=e.height*n),this.setCropBoxData(c))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,a=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/a):i(e.height)&&(s.height=e.height,s.width=e.height*a),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,a,n=this.cropBox,o=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(n.left=e.left),i(e.top)&&(n.top=e.top),i(e.width)&&e.width!==n.width&&(s=!0,n.width=e.width),i(e.height)&&e.height!==n.height&&(a=!0,n.height=e.height),o&&(s?n.height=n.width/o:a&&(n.width=n.height*o)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,a,n,o,r,h,c,l,d,u;if(this.isBuilt&&this.isCropped&&b)return t.isPlainObject(i)||(i={}),u=this.getData(),e=u.width,s=u.height,c=e/s,
t.isPlainObject(i)&&(o=i.width,r=i.height,o?(r=o/c,h=o/e):r&&(o=r*c,h=r/s)),a=D(o||e),n=D(r||s),l=t("<canvas>")[0],l.width=a,l.height=n,d=l.getContext("2d"),i.fillColor&&(d.fillStyle=i.fillColor,d.fillRect(0,0,a,n)),d.drawImage.apply(d,function(){var t,i,a,n,o,r,c=p(this.$clone[0],this.image),l=c.width,d=c.height,f=[c],m=u.x,g=u.y;return m<=-e||m>l?m=t=a=o=0:m<=0?(a=-m,m=0,t=o=y(l,e+m)):m<=l&&(a=0,t=o=y(e,l-m)),t<=0||g<=-s||g>d?g=i=n=r=0:g<=0?(n=-g,g=0,i=r=y(d,s+g)):g<=d&&(n=0,i=r=y(s,d-g)),f.push(m,g,t,i),h&&(a*=h,n*=h,o*=h,r*=h),o>0&&r>0&&f.push(a,n,o,r),f}.call(this)),l},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=C(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i="crop"===t,e=s.movable&&"move"===t,t=i||e?t:"none",this.$dragBox.data("action",t).toggleClass("cropper-crop",i).toggleClass("cropper-move",e),s.cropBoxMovable||this.$face.data("action",t).toggleClass("cropper-crop",i).toggleClass("cropper-move",e))}}),t.extend(d.prototype,L),d.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,checkCrossOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},d.setDefaults=function(i){t.extend(d.DEFAULTS,i)},d.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',d.other=t.fn.cropper,t.fn.cropper=function(i){var a,n=s(arguments,1);return this.each(function(){var e,s=t(this),o=s.data("cropper");if(!o){if(/destroy/.test(i))return;s.data("cropper",o=new d(this,i))}"string"==typeof i&&t.isFunction(e=o[i])&&(a=e.apply(o,n))}),e(a)?this:a},t.fn.cropper.Constructor=d,t.fn.cropper.setDefaults=d.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=d.other,this}}),define("cameras",["./common/util","./widgets/dialog","./widgets/button","./plugins/webcam/webcam","cropper"],function(t,i,e,s){function a(t,i){return!h.isUndefined(t)&&h.isObject(t)&&h.isFunction(t.callback)&&t.callback.apply(this,i)}function n(t){this.options=$.extend({cropperAble:!0,dealWay:"truncate",aspectRatio:5/7,uploadUrl:"./",cameraSet:{enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,swfURL:"",flashNotDetectedText:"",unfreeze_snap:!0,upload_name:"webCam",image_format:"jpeg",jpeg_quality:100}},t,!0),o.call(this,null),this.eventsQueue=[],this.camerasLoad,this.camerasContainer=r.call(this,this.camerasLoad),this.uiInfo=this.options.takeOver||this.camerasContainer.uiInfo,this.init(this.camerasContainer),s.setFlashCanvasPath((this.options.libPath||"/bower_components")+"/cameras/src/js/plugins/flashcanvaspro/"),this.load()}function o(){h.isUndefined(s)||s.set(this.options.cameraSet)}function r(t){var e=this;return e.$dialog=new i({camerasCode:e.camerasLoad,takeOver:!!this.options.takeOver,closeAble:this.options.closeAble,Webcam:s,events:{upload:function(t,i){var s=this.preview().cropper("getData");return this.cropperData=s,e.upload(e.imageData)},reload:function(){this.camerasOccur(!0),e.load()},capture:function(t){return t.preventDefault(),e.capture()}},canCapture:function(){return 200===e.camerasLoad}}),this.$dialog.init()}var h=new t,c={live:"live",error:"error",compare:"compare",upload:"upload"};return n.prototype={init:function(t){var i=this;s.on("live",function(){i.camerasLoad=200,a(i.getEvent(c.live))}),s.on("error",function(e){t.isTakeOver()||t.camerasOccur(!1),"FlashError"===e.name&&(i.camerasLoad=500,a(i.getEvent(c.error)))}),s.on("load",function(){i.camerasLoad=100,t.isTakeOver()||t.camerasOccur(!0)})},reset:function(){this.camerasContainer.events.recapture.call(this.camerasContainer)},destroy:function(){s&&s.reset()},getEvent:function(t){for(var i=this.eventsQueue.length,e=0;e<i;e++){var s=this.eventsQueue[e];if(s.eventName===t)return s}},on:function(t,i){var e={eventName:t,callback:i},s=this.getEvent(t),a=this;if(s){var n=s.callback;s.callback=function(){n.apply(a,arguments),i.apply(a,arguments)}}else this.eventsQueue.push(e);return this},capture:function(){function t(t){a(n.getEvent("capture"),[n,n.imageData]),i.prop("src",t),i&&i.length>0&&n.options.cropperAble&&i.cropper({dragmode:"move",aspectRatio:n.options.aspectRatio,preview:"#"+n.uiInfo.cropperPreview}).cropper("replace",t),n.imageUrl=t}var i,e=$.Deferred(),n=this,o=n.camerasContainer;return i=o.isTakeOver()?$("#"+n.uiInfo.cropperContainerId):o.preview(),200!==n.camerasLoad?(e.reject(),e):(i.unbind("load"),i.load(function(){e.resolve(n.imageUrl),n.deleteUrl&&h.ajax(n.deleteUrl)}),i.prop("src",""),200===n.camerasLoad?s.snap(function(i){if(n.imageData=i,n.deleteUrl=undefined,o.imageData=n.imageData,h.isIe8()){n.mustDelete=!0;var e=n.options.captureUrl?n.options.captureUrl:n.options.uploadUrl.substring(0,n.options.uploadUrl.lastIndexOf("/"))+"/uploadTempBase64Image",s=n.options.previewUrl?n.options.previewUrl:n.options.uploadUrl.substring(0,n.options.uploadUrl.lastIndexOf("/"))+"/previewTempBase64Image",a=n.options.deleteUrl?n.options.deleteUrl:n.options.uploadUrl.substring(0,n.options.uploadUrl.lastIndexOf("/"))+"/deleteTempBase64Image";h.ajax(e,{base64Data:i.split(",")[1],context:n.options.context},function(i){i=i.replace(/\"/g,""),n.deleteUrl=a+"?id="+i,s+="?id="+i,t(s)})}else t(i)}):e.reject({code:n.camerasLoad,message:"请检查摄像头"}),e)},upload:function(){var t=this;if(this.imageData){var i=$.Deferred(),e=$("#"+this.uiInfo.cropperContainerId);return this.cropperData={},e.length>0&&(this.cropperData=e.cropper("getData")),this.cropperData.type=this.options.dealWay,h.ajax(this.options.uploadUrl,{base64Data:this.imageData.split(",")[1],context:this.options.context,needOperate:[this.cropperData]},function(e){if(a(t.getEvent(c.upload),[e,t.camerasContainer]),t.options.compareUrl){var s;s=e.convertResult&&h.isArray(e.convertResult)?e.convertResult[0].url:e.url,h.ajax(t.options.compareUrl,{context:JSON.stringify(t.options.context),imageUrl:s,compareData:t.options.compareData},function(e){e.info?(e.info.isSimilar?t.camerasContainer.tip("success"):t.camerasContainer.tip("failure"),i.resolve()):(t.camerasContainer.notification("failure","比对失败!"),i.reject()),a(t.getEvent(c.compare),[e.info,t.camerasContainer])},function(){t.camerasContainer.notification("failure","比对发生系统故障!"),i.reject()})}else t.camerasContainer.notification("success","上传成功!"),i.resolve()},function(){i.reject(),t.camerasContainer.notification("failure","上传发生系统故障!")}),i}},load:function(){s.attach(this.uiInfo.containerId)},get_$dialog:function(){return this.camerasContainer}},n});