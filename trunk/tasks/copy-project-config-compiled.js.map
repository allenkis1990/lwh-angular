{"version":3,"sources":["copy-project-config.js"],"names":[],"mappings":"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","file":"copy-project-config-compiled.js","sourcesContent":["\r\nvar gulp = require('gulp'),\r\n    through2 = require('through2'),\r\n    File = require('vinyl'),\r\n    path = require('path'),\r\n    fs = require('fs'),\r\n    config = require('../things/config/config');\r\n\r\n/**\r\n * 该任务将门户下面的project.main.json的内容复制到各应用当中，完成域名解析\r\n */\r\ngulp.task('copyProjectConfig', function () {\r\n    var projectMainConfigJson = require('../app/portal/project.main.json');\r\n\r\n    return gulp.src(['./app/admin/index.html'])\r\n\r\n        .pipe(function () {\r\n            return through2.obj(function (file, sex, next) {\r\n                var fileContent = file.contents.toString();\r\n                var sourceFilePath = path.relative('./app', file.path),\r\n                    dir = path.dirname(sourceFilePath);\r\n                fileContent = fileContent.replace(/(<script\\s*id=\"project_main_config\">)(.|\\n|\\t|\\s)*?(<\\/script>)/gi, '$1var projectMainConfig = ' + JSON.stringify(projectMainConfigJson) + ';$3')\r\n\r\n                    .replace(/(<script\\s*id=\"app_name_use_in_gulpfile\">)(.|\\n|\\t|\\s)*?(<\\/script>)/gi, '$1var appName = \"' + dir + '\";$3');\r\n\r\n                var newFile = new File();\r\n                newFile.path = sourceFilePath;\r\n                newFile.contents = new Buffer(fileContent);\r\n                this.push(newFile);\r\n                next();\r\n            })\r\n        }())\r\n\r\n        .pipe(gulp.dest('./app'))\r\n\r\n});\r\n\r\ngulp.task('asignIndexAppName', function () {\r\n\r\n    var appSub = config.findSubDirectory('./app'),\r\n        mapper = {};\r\n\r\n    appSub.forEach(function (item, index) {\r\n        if (fs.existsSync('./app/' + item + '/modules')) {\r\n            mapper[item] = config.findSubDirectory('./app/' + item + '/modules');\r\n        }\r\n    });\r\n    var filter = [];\r\n\r\n    Object.keys(mapper).forEach(function (item, index) {\r\n\r\n        mapper[item].forEach(function (subItem, index) {\r\n            filter.push('./app/' + item + '/modules/' + subItem + '/index.html');\r\n        })\r\n    });\r\n\r\n    return gulp.src(filter)\r\n\r\n        .pipe(function () {\r\n            return through2.obj(function (file, sex, next) {\r\n                var fileContent = file.contents.toString(),\r\n                    sourceFilePath = path.relative('./app', file.path),\r\n                    dir = sourceFilePath.split('\\\\')[2];\r\n\r\n                if (fileContent.indexOf('app_name_use_in_gulpfile') == -1) {\r\n\r\n                }\r\n\r\n                fileContent = fileContent.replace(/(<script\\s*id=\"app_name_use_in_gulpfile\">)(.|\\n|\\t|\\s)*?(<\\/script>)/gi, '$1var appName = \"' + dir + '\";$3');\r\n\r\n                var newFile = new File();\r\n                newFile.path = sourceFilePath;\r\n                newFile.contents = new Buffer(fileContent);\r\n                this.push(newFile);\r\n                next();\r\n            })\r\n        }())\r\n\r\n        .pipe(gulp.dest('./app'))\r\n\r\n\r\n});"]}