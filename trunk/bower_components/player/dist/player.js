/**
 * player - 课程播放相关
 * @author 
 * @version v1.3.8
 * @link 
 * @license MIT
 */
function p2psr_embed(e,t,n,i,o,r,s,a,c,l,d,u,p){function m(e){function t(){if(null==n.p2ps_call)setTimeout(t,200);else{try{if("not_ready"!=n.getState())return void p(e)}catch(i){return void setTimeout(t,200)}p(e)}}if(!e.success)return void(p&&p(e));var n=e.ref;n.doplay=function(e){return this.p2ps_call("play",[e])},n.pause=function(){return this.p2ps_call("pause",[])},n.resume=function(){return this.p2ps_call("play",[])},n.close=function(){return this.p2ps_call("close",[])},n.seek=function(e){return this.p2ps_call("seek",[e])},n.getVolume=function(){return this.p2ps_get("volume")},n.setVolume=function(e){return this.p2ps_set("volume",e)},n.getMute=function(){return this.p2ps_get("mute")},n.setMute=function(e){return this.p2ps_set("mute",e)},n.getVersion=function(){return this.p2ps_get("version")},n.getTime=function(){return this.p2ps_get("time")},n.getTimeCode=function(){return this.p2ps_get("timeCode")},n.getDuration=function(){return this.p2ps_get("duration")},n.getState=function(){return this.p2ps_get("state")},n.setOption=function(e,t){return this.p2ps_call("setOption",[e,t])},n.setEventListener=function(e){return this.p2ps_call("setJSEventListener",[e])},n.setStatListener=function(e){return this.p2ps_call("setJSStatListener",[e])},n.getDownloadUrl=function(){return this.p2ps_get("downloadUrl")},p&&t()}function f(e,t){var n="jsonp_"+parseInt(1e6*Math.random())+parseInt(1e6*Math.random());if(window[n]=function(e){try{window[n]=void 0,delete window[n]}catch(i){}e instanceof Error?t(e):t(null,e)},"Microsoft Internet Explorer"==navigator.appName){var i=navigator.appVersion,o=i.match(/MSIE (\d+\.\d?)/);i=parseInt(o[1]),i<10&&setTimeout(function(){window[n]&&window[n](new Error("Network I/O error"))},5e3)}e=e.replace("callback=?","callback="+n);var r=document.createElement("script");r.setAttribute("src",e),r.setAttribute("onerror",n+"(new Error('Network I/O error'));"),document.body?document.body.appendChild(r):setTimeout(function(){document.body.appendChild(r)},100)}function h(){for(var e="",t=document.cookie.split("; "),n=0;n<t.length;n++){var i=t[n];if(""!=i&&null!=i){var o=i.split("=");if(!(null==o||o.length<2)&&"__cross_domain_user"==o[0])return e="__cross_domain_user="+o[1]}}return e}if("auto"==e){var y=(swfobject.getFlashPlayerVersion,swfobject.ua);return e=y.ios?"hls":y.android&&y.android[0]>=3?"hls":"p2p",p2psr_embed(e,t,n,i,o,r,s,a,c,l,d,u,p)}if("p2p"==e){var g=n+"/global/player.swf";"object"!=typeof l&&(l={});var v="^"+i+".json?type="+t,b=h();return""!=b&&(v+="&"+b),l.url=v,swfobject.embedSWF(g,o,r,s,a,c,l,d,u,m)}if("rtmp"==e){var g=n+"/global/player.swf";"object"!=typeof l&&(l={});var v="^"+i+".json?type="+t,b=h();return""!=b&&(v+="&"+b),l.url=v,l.provider="rtmp",swfobject.embedSWF(g,o,r,s,a,c,l,d,u,m)}if("hls"==e){var w=function(){var e=swfobject.getElementById(o);if(void 0==e||null==e)return void(p&&p({success:!1,id:o}));var a=document.createElement("video");a.setAttribute("id",o),a.setAttribute("controls",!0),a.setAttribute("autoplay",!0),r&&s&&(a.setAttribute("width",r),a.setAttribute("height",s));var c=n+i+".json?type="+t+"&callback=?",l=h();""!=l&&(c+="&"+l),f(c,function(e,n){if(e||"OK"!=n.code)return void alert("加载视频信息失败");var i;for(var o in n.substreams)if(1718646381==n.substreams[o].format){i=n.substreams[o];break}if(!i)return void alert("视频不支持hls输出");var r=i.http_url+"/"+("live"==t?"live.M3U8":"video.m3u8")+"?sc_tk="+encodeURIComponent(n.sc_tk);a.setAttribute("src",r),a.setAttribute("poster",i.http_url+"/thumbnail.jpg")}),e.parentNode.replaceChild(a,e),a.style.visibility="visible",a.style.background="black",p&&p({success:!0,ref:e})},I=swfobject.getElementById(o);return void 0==I||null==I?(swfobject.addDomLoadEvent(w),!0):(w(),I)}return!1}function p2ps_player_open_light(e){var t=document.body.scrollHeight;if(null==p2ps_light_layer){p2ps_light_layer=document.createElement("div"),p2ps_light_layer.innerHTML='<div id="p2ps_light_layer" style="visibility: hidden; display: block; position: absolute; left: 0; top: 0; width: 100%; height: '+t+'px; z-index: 999; background-color:#000000; opacity:0.9; filter: alpha(opacity=90); "></div>',p2ps_light_layer=p2ps_light_layer.firstChild;var n=document.getElementsByTagName("body")[0];n&&n.insertBefore(p2ps_light_layer,n.firstChild)}var i=p2ps_light_layer;i&&(i.style.height=t+"px",e?i.style.visibility="hidden":i.style.visibility="visible")}define("ie-extension",[],function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),window.console||(window.console={log:function(e){},error:function(e){}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e,t){for(var n=-1,i=t||0,o=this.length;i<o;i++)this[i]===e&&(n=i);return n}),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},n={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+n[this.getDay()+""]));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e}}),define("const",["./ie-extension"],function(){var e={Timing:{commit:"CommitTiming","break":"BreakTiming"},Document:{exchange:"ExchangeTiming"},File:{exam:"common/js/hb.exam.js"},RequestHead:{appVersion:"1.0.0",osPlatform:"web",requestTime:function(){return(new Date).Format("yyyy-MM-dd HH:mm:ss")}()},popQuestionLogType:{init:1,timing:2},popQuestionType:{random:1,normal:0},getService:function(e){return e=e||"",{init:"api/Learning"+e+"/Initing",single:"api/Learning"+e+"/Timing",three:"api/Learning"+e+"/Timing",scorm:"api/Learning"+e+"/ScormTiming",pdf:"api/Learning"+e+"/DocumentTiming",web:"api/Learning"+e+"/Timing"}}};return e}),define("helper",["./const"],function(e){function t(){this.playMode={listen:0,learn:1,preview:2},this.playType={single:"single",pdf:"pdf",web:"web",three:"three",scorm:"scorm"}}return t.prototype={Const:e,getApiUrl:function(e){},error:function(e){this.log(e,"error")},findIndex:function(e,t,n){var i,n=n||"id";e:for(var o=0;o<e.length;o++){var r=e[o];if(r[n]===t[n]){r.$index=o,i=r;break e}}return i},forEach:function(e,t){if(this.isArray(e)){var n=0,i=e.length;for(n;n<i;n++)this.isFunction(t)&&t(e[n],n)}},log:function(e,t){window.console&&console[t||"log"](e)},ajax:function(e,t,n,i){this.isUndefined($)&&this.error("jQuery is undefined!");var o=$.toJSON(t),r=this;if("undefined"!=typeof XDomainRequest){var s=new XDomainRequest;s.onload=function(){if(s.responseText)try{n($.parseJSON(s.responseText))}catch(e){window.console&&console.log(e)}},s.onerror=function(){i("xdr error 请求响应错误")},s.onprogress=function(){},s.open("post",e),s.send(o)}else $.ajax({type:"post",url:e,contentType:"text/plain",data:o,success:n,error:function(e){r.error(e)}})},toTime:function(e){var t=e/60,n=e%60,i=t/60;return t%=60,i=parseInt(i,10),t=parseInt(t,10),n=parseInt(n,10),(i>=10?i:"0"+i)+":"+(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n)},setInterval:function(e,t){return window.setInterval(e,t)},clearInterval:function(e){e&&window.clearInterval(e)},isIE8:function(){var e=!1;return navigator.userAgent.indexOf("MSIE 9.0")>0&&!window.innerWidth||navigator.userAgent.indexOf("MSIE 8.0")>0&&!window.innerWidth?e=!0:e},getPath:function(e){return e+(e.lastIndexOf("/")==e.length-1?"":"/")},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)&&"function"==typeof e},isString:function(e){return"string"==typeof e&&"[object String]"===Object.prototype.toString.call(e)},isEmptyString:function(e){return!(null!==e||!this.isUndefined(e))||""==(""+e).replace(/\s/g,"")},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isUndefined:function(e){return"undefined"==typeof e},isNumber:function(e){return"number"==typeof e&&"[object Number]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e&&"[object Boolean]"===Object.prototype.toString.call(e)},noop:function(){},promiseNoop:function(){return{then:this.noop}},getStyleByOptions:function(e,t,n){if(e)return n&&t?e[t][n]:e},checkApiType:function(e){return"Marker"===e}},new t}),define("../common/ie-extension",[],function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),window.console||(window.console={log:function(e){},error:function(e){}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e,t){for(var n=-1,i=t||0,o=this.length;i<o;i++)this[i]===e&&(n=i);return n}),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},n={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+n[this.getDay()+""]));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e}}),define("../common/const",["./ie-extension"],function(){var e={Timing:{commit:"CommitTiming","break":"BreakTiming"},Document:{exchange:"ExchangeTiming"},File:{exam:"common/js/hb.exam.js"},RequestHead:{appVersion:"1.0.0",osPlatform:"web",requestTime:function(){return(new Date).Format("yyyy-MM-dd HH:mm:ss")}()},popQuestionLogType:{init:1,timing:2},popQuestionType:{random:1,normal:0},getService:function(e){return e=e||"",{init:"api/Learning"+e+"/Initing",single:"api/Learning"+e+"/Timing",three:"api/Learning"+e+"/Timing",scorm:"api/Learning"+e+"/ScormTiming",pdf:"api/Learning"+e+"/DocumentTiming",web:"api/Learning"+e+"/Timing"}}};return e}),define("../common/helper",["./const"],function(e){function t(){this.playMode={listen:0,learn:1,preview:2},this.playType={single:"single",pdf:"pdf",web:"web",three:"three",scorm:"scorm"}}return t.prototype={Const:e,getApiUrl:function(e){},error:function(e){this.log(e,"error")},findIndex:function(e,t,n){var i,n=n||"id";e:for(var o=0;o<e.length;o++){var r=e[o];if(r[n]===t[n]){r.$index=o,i=r;break e}}return i},forEach:function(e,t){if(this.isArray(e)){var n=0,i=e.length;for(n;n<i;n++)this.isFunction(t)&&t(e[n],n)}},log:function(e,t){window.console&&console[t||"log"](e)},ajax:function(e,t,n,i){this.isUndefined($)&&this.error("jQuery is undefined!");var o=$.toJSON(t),r=this;if("undefined"!=typeof XDomainRequest){var s=new XDomainRequest;s.onload=function(){if(s.responseText)try{n($.parseJSON(s.responseText))}catch(e){window.console&&console.log(e)}},s.onerror=function(){i("xdr error 请求响应错误")},s.onprogress=function(){},s.open("post",e),s.send(o)}else $.ajax({type:"post",url:e,contentType:"text/plain",data:o,success:n,error:function(e){r.error(e)}})},toTime:function(e){var t=e/60,n=e%60,i=t/60;return t%=60,i=parseInt(i,10),t=parseInt(t,10),n=parseInt(n,10),(i>=10?i:"0"+i)+":"+(t>=10?t:"0"+t)+":"+(n>=10?n:"0"+n)},setInterval:function(e,t){return window.setInterval(e,t)},clearInterval:function(e){e&&window.clearInterval(e)},isIE8:function(){var e=!1;return navigator.userAgent.indexOf("MSIE 9.0")>0&&!window.innerWidth||navigator.userAgent.indexOf("MSIE 8.0")>0&&!window.innerWidth?e=!0:e},getPath:function(e){return e+(e.lastIndexOf("/")==e.length-1?"":"/")},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)&&"function"==typeof e},isString:function(e){return"string"==typeof e&&"[object String]"===Object.prototype.toString.call(e)},isEmptyString:function(e){return!(null!==e||!this.isUndefined(e))||""==(""+e).replace(/\s/g,"")},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isUndefined:function(e){return"undefined"==typeof e},isNumber:function(e){return"number"==typeof e&&"[object Number]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e&&"[object Boolean]"===Object.prototype.toString.call(e)},noop:function(){},promiseNoop:function(){return{then:this.noop}},getStyleByOptions:function(e,t,n){if(e)return n&&t?e[t][n]:e},checkApiType:function(e){return"Marker"===e}},new t}),define("../core/common/player-event",["../../common/helper"],function(e){function t(t){if("string"!=typeof t)return e.error("state must is String"),!1;var n=["play","seek","pause","end","init","state","start","commit","frame","resume"];return void 0!=t&&""!=t&&n.indexOf(t)!=-1||(e.error("state must be <<<<<<<<<<<<"+n.join(",")+">>>>>>>>>>>>>>"),!1)}function n(){this.__events={}}return n.prototype={add:function(e,n){if("string"==typeof e)t(e)&&"function"==typeof n&&(this.__events[e]=n);else for(;e.length>0;){var i=e.shift();this.__events[i]=n}return this},get:function(e){return this.__events[e]},getStateEvent:function(){return this.__events.state},getInitEvent:function(){return this.__events.init},destroy:function(){this.__events={}}},n}),define("../core/common/components/player-control/player-control",["../../../../common/helper"],function(e){function t(e){this.init(e),this.eventHandle("init")}function n(e){e&&window.clearInterval(e)}function i(e,t){return e.stop().animate(t)}return t.prototype={constructor:t,$el:{},uiAppendToEle:"",init:function(e){function t(e){o.delayHidePlayController_timer&&window.clearTimeout(o.delayHidePlayController_timer),i(this,{opacity:e})}function n(){var e='<div class="cont-container"><div class="current-time">00:00:00</div><div class="middle"><div class="progress-container"><div class="progress"></div></div></div><div class="total-time"></div> </div>',n=$(e);return(o.whoAttach||n).bind("mouseenter mouseleave",function(e){t.call(n,"mouseenter"===e.type?1:0)}),n}this.options=e,this.uiAppendToEle=e.container,this.totalTime=e.totalTime||0,this.timeSchedule=e.schedule||0,this.whoAttach=this.uiAppendToEle;var o=this;this.uiAppendToEle.after(this.$el.container=n()),this.delayHidePlayController_timer&&window.clearTimeout(this.delayHidePlayController_timer),this.delayHidePlayController_timer=window.setTimeout(function(){i(o.$el.container,{opacity:0})},1500),this.getElements(),this.play()},getDuration:function(){return this.totalTime},getElements:function(){this.$el.currentTime=this.$el.container.find(".current-time"),this.$el.totalTime=this.$el.container.find(".total-time"),this.$el.progress=this.$el.container.find(".progress"),this.renderValue()},renderValue:function(){this.$el.totalTime.html(e.toTime(this.totalTime))},play:function(){var t=this;this.stop(),n(this.timing_timer),t.eventHandle("playing"),this.timing_timer=window.setInterval(function(){return t.timeSchedule>=t.totalTime?(t.stop(),t.$el.progress.css({width:"100%"}),t.timingState&&100==t.schedule()&&(t.eventHandle("end"),t.options.core.LMSCommit("end"),t.timingState=!1),t.timeSchedule=t.totalTime,void t.$el.currentTime.html(e.toTime(t.totalTime))):(i(t.$el.progress,{width:t.schedule()+"%"}),t.timeSchedule++,t.timingState=!0,t.$el.currentTime.html(e.toTime(t.timeSchedule)),t.options.events.timeListen&&t.options.events.timeListen(),void 0)},1e3)},getTime:function(){return this.timeSchedule},eventHandle:function(e){this.playerState=e;var t=this.options.launchStudy;if(this.options.event)switch(e){case"end":this.options.event.endPlay&&this.options.event.endPlay("end",this);break;case"pause":this.options.event.statePlay&&this.options.event.statePlay("pause",this);break;case"playing":this.options.event.statePlay&&this.options.event.statePlay("playing",this);break;case"seek":this.options.event.statePlay&&this.options.event.statePlay("seek",this);break;case"init":this.options.event.initPlay&&this.options.event.initPlay(this,t.core),this.options.event.startPlay&&this.options.event.startPlay("start",this)}this.options[e]&&this.options[e]()},getState:function(){return this.playerState},schedule:function(){return 0===this.totalTime?100:Math.floor(parseInt(this.timeSchedule)/parseInt(this.totalTime)*100)},pause:function(){this.eventHandle("pause"),this.stop()},stop:function(){this.eventHandle("stop"),n(this.timing_timer),this.timing_timer=null},restart:function(){this.eventHandle("playing"),this.play()},destroy:function(){this.eventHandle("destroy")},initPlayer:function(){}},Function.prototype.bind||(Function.prototype.bind=function(){}),t}),define("../core/pdf/pdfobject",[],function(){var e=function(e){if(!e||!e.url)return!1;var t,n,i,o,r,s,a,c,l,d,u,p="1.2",m=e.id||!1,f=e.width||"100%",h=e.height||"100%",y=e.pdfOpenParams;if(i=function(e){var t;try{t=new ActiveXObject(e)}catch(n){t=null}return t},o=function(){var e=null;return!(!window.ActiveXObject||(e=i("AcroPDF.PDF"),e||(e=i("PDF.PdfCtrl")),null===e))},r=function(){var e,t=navigator.plugins,n=t.length,i=/Adobe Reader|Adobe PDF|Acrobat/gi;for(e=0;e<n;e++)if(i.test(t[e].name))return!0;return!1},s=function(){var e=navigator.mimeTypes["application/pdf"];return e&&e.enabledPlugin},a=function(){var e=null;return r()||o()?e="Adobe":s()&&(e="generic"),e},c=function(){var e,t,n=document.getElementsByTagName("html");return!!n&&(e=n[0].style,t=document.body.style,e.height="100%",e.overflow="hidden",t.margin="0",t.padding="0",t.height="100%",void(t.overflow="hidden"))},l=function(e){var t,n="";if(!e)return n;for(t in e)e.hasOwnProperty(t)&&(n+=t+"=",n+="search"===t?encodeURI(e[t]):e[t],n+="&");return n.slice(0,n.length-1)},d=function(e){var i=null;switch(e){case"url":i=t;break;case"id":i=m;break;case"width":i=f;break;case"height":i=h;break;case"pdfOpenParams":i=y;break;case"pluginTypeFound":i=n;break;case"pdfobjectversion":i=p}return i},u=function(e){if(!n)return!1;var i=null;if(e){if(i=e.nodeType&&1===e.nodeType?e:document.getElementById(e),!i)return!1}else i=document.body,c(),f="100%",h="100%";return i.src=t,i.width=f,i.height=h,i.getElementsByTagName("object")[0]},t=encodeURI(e.url)+"#"+l(y),n=a(),null==n){var g=document.getElementById(m);if(e.downLoadUrl)g.src=e.downLoadUrl;else{var v=document.getElementById(m).parentElement,b=document.createElement("div");b.className+=g.className;var w=document.createElement("h4"),I=document.createElement("h4");w.innerHTML="我们需要Adobe Acrobat Reader DC来播放PDF文档",I.innerHTML="请点击下载最新的Adobe Acrobat Reader",b.appendChild(w),b.appendChild(I);var S=document.createElement("p");S.innerHTML="官网下载";var C=document.createElement("a");C.href="https://get.adobe.com/cn/reader/",C.target="_blank",C.appendChild(S);var _=document.createElement("p");_.innerHTML="本地下载";var T=document.createElement("a");T.href=e.downLoadFileUrl,T.target="_blank",T.appendChild(_),b.appendChild(C),b.appendChild(T),v.insertBefore(b,v.firstChild),v.removeChild(g)}}return this.get=function(e){return d(e)},this.embed=function(e){return u(e)},this.pdfobjectversion=p,this.pluginTypeFound=n,this};return e}),define("../core/common/player-timer",["../../common/helper"],function(e){function t(t){return t instanceof n?(this.name="",this.delay=-1,this.__factory=t,this.currentId=void 0,this.trigger=function(){},this.start=function(){var t=this;void 0==t.currentId?(t.currentId=window.setInterval(t.trigger,t.delay),e.log("Timer:"+t.name+" is start")):e.log("Timer:"+t.name+" is started")},this.stop=function(){var t=this;t.currentId&&(window.clearInterval(t.currentId),t.currentId=void 0,e.log("Timer:"+t.name+" is shutdown"))},this.getFactory=function(){return this.__factory},void(this.isFactory=function(e){return this.__factory===e})):void e.error("factory must be TimerFactory's instance")}function n(){this.__currentTimers={},this.constructor=this,this.init=function(e){e.timerFactory=this},this.create=function(n,i,o){if(!e.isString(n))return void e.error("name is not String");if(this.__currentTimers[n])return void e.error("Timer:"+n+" is exist!");if(!e.isNumber(i))return void e.error("TimerFactory:delay is not Number");if(!e.isFunction(o))return void e.error("TimerFactory:fn is not Function");var r=new t(this);r.delay=i,r.trigger=o,r.name=n,this.__currentTimers[n]=r},this.reset=function(t,n,i){if(!e.isString(t))return void e.error("TimerFactory.reset:name is not String");if(!e.isNumber(n))return void e.error("TimerFactory.reset:delay is not Number");if(!e.isFunction(i))return void e.error("TimerFactory.reset:fn is not Function");if(this.__currentTimers[t]){var o=this.get(t);return o.stop(),o.delay=n,o.triggle=i,n>0&&o.start(),o}this.create(t,n,i),e.error("Timer:"+t+" isn't exist!Now Create!")},this.get=function(e){return this.__currentTimers[e]},this.destroy=function(){var e=this.__currentTimers;for(var n in e){var i=e[n];i instanceof t&&i.stop()}this.__currentTimers={}},this.allStart=function(){var e=this.__currentTimers;for(var n in e){var i=e[n];i instanceof t&&i.start()}},this.allStop=function(){var e=this.__currentTimers;for(var n in e){var i=e[n];i instanceof t&&i.stop()}}}return n}),define("../core/pdf/operationIE8",["./pdfobject","../common/player-timer","../../common/helper"],function(e,t,n){var i=(window,document),o={type:"pdfIE8",__timerFactory:void 0,player:"",initPlayer:function(o){var r=this;r.__timerFactory&&r.__timerFactory.destroy();var s=i.getElementById(o.options.containerId);null!=s&&void 0!=s||(s=i.createElement("div"),s.id="pdf_container_IE8",s.style.width=isNaN(o.options.containerId)?640:o.options.width,s.style.height=isNaN(o.options.height)?640:o.options.height,$("body",i).append(s));var a="";1==o.extend.studyMode?2==o.core.studyStatus&&1!=o.core.studyMode||(a="three"==o.extend.type?o.extend.lessonDocument[0].path:o.interaction.streamHost+o.interaction.streamPath,r.__timerFactory=new t,r.__timerFactory.create(n.Const.Timing.commit,1e3*o.objectives.policy.intervalTime,function(){r.LMSCommit("play"),n.log("pdfIE8 commit")})):a="three"==o.extend.type?o.extend.lessonDocument[0].path:o.interaction.streamHost+o.interaction.streamPath;var c=new e({id:s.id,iframeId:o.options.containerId,width:o.options.width,height:o.options.height,url:a,pdfOpenParams:{view:"Fit"},downLoadFileUrl:o.downFile.fileUrl,downLoadUrl:o.downFile.fileDownloadUrl});c.embed(s.id),r.player=c,r.player.pluginTypeFound&&(o.extend.studyMode===n.playMode.learn&&this.createPlayerController(o,$(s),this),r.initCompleted&&r.initCompleted(r))},getCurrentLaunchStudyCore:function(e){var t={},n=e.core;return t.primaryKey=n.primaryKey,t.courseRecordId=n.courseRecordId,t.coursewareRecordId=n.coursewareRecordId,t.lessonId=n.lessonId,t.lessonLocation=n.lessonLocation,t.studyMode=n.studyMode,t.studyLastScale=n.studyLastScale,t.studyCurrentScale=n.studyCurrentScale,t.studySchedule=this.playerController&&this.playerController.schedule()||0,t.timingMode="schedule",t.studyStatus=n.studyStatus,t.lessonStatus=1,{core:t,extend:e.context}},commitAfter:function(e){var t=e.core,i=e.objectives,o=this;i.modifyPolicy&&(o.__timerFactory.reset(n.Const.Timing.commit,1e3*i.policy.intervalTime,function(){o.LMSCommit()}).start(),this.player.play(t.studyLastScale)),n.isFunction(e.event.commitAfter)&&e.event.commitAfter(t,o.player)},destroy:function(){this.__timerFactory&&this.__timerFactory.destroy()},LMSInitialize:function(){},LMSCommit:function(){},LMSFinish:function(){},LMSSetValue:function(e,t){},LMSGetValue:function(e){},LMSGetLastError:function(){},LMSGetErrorString:function(e){},LMSGetDiagnostic:function(e){},playCurrent:function(){this.playerController&&this.playerController.play(),this.showPdfContainer()},pauseCurrent:function(){this.playerController&&this.playerController.stop(),this.hidePdfContainer()}},r={init:function(e){return $.extend({},o,e)},extend:function(){return $.extend({},o,this,!0)}};return r}),define("../core/pdf/operation",["../common/player-timer","../../common/helper"],function(e,t){function n(e,t){if("boolean"!=typeof t)throw"event must be a boolean.";void 0!=c[e]&&(c[e]=t)}function i(e,n){var i=this,o=n||encodeURIComponent(e.interaction.streamHost+e.interaction.streamPath);null!=e.options.startAt&&void 0!=e.options.startAt||(e.options.startAt=0);var r=(e.pdfHtmlAddress||"../core/pdf/viewer/")+"/viewer.html?file="+o+"&"+$.param(e.options),s=document.getElementById(e.options.containerId);if("undefined"==typeof s||null==s?window.document.body.innerHTML="<iframe id='"+e.options.containerId+"' src='"+r+"' height='"+e.options.height+"' width='"+e.options.width+"' frameborder='0'></iframe>":(s.src=r,void 0==e.options.width||""==e.options.width?s.style.width="100%":s.style.width=e.options.width,void 0==e.options.height||""==e.options.height?s.style.height="100%":s.style.height=e.options.height,s.frameBorder=0),e.type===t.playType.pdf&&e.extend.studyMode===t.playMode.learn)var a=$(s).load(function(){i.createPlayerController(e,a,i)})}var o=window,r=(o.document,[]),s={},a=["sidebar","find","pageUp","pageDown","zoomOut","zoomIn","fullScreen","open","print","downLoad","mark","secondarybar"],c={},l={sidebar:!0,find:!0,pageUp:!0,pageDown:!0,zoomOut:!0,zoomIn:!0,fullScreen:!1,open:!1,print:!1,downLoad:!1,mark:!1,secondarybar:!0};for(var d in a)r.push("onbefore"+a[d]),r.push("onafter"+a[d]),c[a[d]]=!1;for(var d in r)s[r[d]]=function(){};for(var u in l)n(u,l[u]);window.__goToPageInterval=void 0;var p={index:0,count:1,percent:function(){return o.__bond.playerCore.percent(this.index,this.count)}},m={type:"pdf",player:void 0,__timerFactory:void 0,initPlayer:function(n){var i=this;if(i.__timerFactory&&i.__timerFactory.destroy(),n.extend.studyMode==t.playMode.learn){if(2!=n.core.studyStatus||n.core.studyMode==t.playMode.learn){o.frames[0].window.addEventListener("pagechange",function(e){var t=o.frames[0].document.getElementById("pageNumber").value||0,i=o.frames[0].PDFViewerApplication.pagesCount||1,r=p.index;parseInt(r,10)<parseInt(t,10)&&(p.index=parseInt(t,10)),n.core.studyLastScale=parseInt(t),p.count=i},!0),i.__timerFactory=new e,i.__timerFactory.create(t.Const.Timing.commit,1e3*n.objectives.policy.intervalTime,function(){i.LMSCommit("play"),t.log("pdf commit")});var r=0==n.core.studyLastScale?1:n.core.studyLastScale;window.__goToPageInterval=window.setInterval(function(){if(o.frames[0].PDFViewerApplication){var e=o.frames[0].PDFViewerApplication.pdfViewer;e&&0!=e.pages.length&&(e.scrollPageIntoView(r),o.clearInterval(window.__goToPageInterval),i.initCompleted&&i.initCompleted(i))}},1e3)}}else n.extend.studyMode==t.playMode.preview&&(window.__goToPageInterval=window.setInterval(function(){if(o.frames[0].PDFViewerApplication){var e=o.frames[0].PDFViewerApplication.pdfViewer;e&&0!=e.pages.length&&n.options.limit>0&&(e.setPdfPage(n.options.limit),o.clearInterval(window.__goToPageInterval),i.initCompleted&&i.initCompleted(i))}},1e3))},initCompleted:function(){},createPDF:function(e,t){var n=this;i.call(this,e,t),o.setTimeout(function(){n.player=o.frames[0].PDFViewerApplication},100)},getCurrentLaunchStudyCore:function(e){var t={},n=e.core;return t.primaryKey=n.primaryKey,t.courseRecordId=n.courseRecordId,t.coursewareRecordId=n.coursewareRecordId,t.lessonId=n.lessonId,t.lessonLocation=n.lessonLocation,t.studyMode=n.studyMode,t.studyLastScale=n.studyLastScale,t.studyCurrentScale=n.studyCurrentScale,t.studySchedule=this.playerController&&this.playerController.schedule()||0,t.timingMode="schedule",t.studyStatus=n.studyStatus,t.lessonStatus=1,{core:t,extend:e.context}},percent:function(e,t){var n=parseFloat(e)/parseFloat(t);return Math.round(1e4*n)/100},destroy:function(){this.__timerFactory&&this.__timerFactory.destroy()},commitAfter:function(e){var n=e.core,i=e.objectives,o=this;i.modifyPolicy&&(o.__timerFactory.reset(t.Const.Timing.commit,1e3*i.policy.intervalTime,function(){o.LMSCommit()}).start(),this.player.play(n.studyLastScale)),t.isFunction(e.event.commitAfter)&&e.event.commitAfter(n,o.player)},LMSInitialize:function(){},LMSCommit:function(){},LMSFinish:function(){},LMSSetValue:function(e,t){},LMSGetValue:function(e){},LMSGetLastError:function(){},LMSGetErrorString:function(e){},LMSGetDiagnostic:function(e){},playCurrent:function(){this.playerController&&this.playerController.play(),this.showPdfContainer()},pauseCurrent:function(){this.playerController&&this.playerController.stop(),this.hidePdfContainer()}},f={init:function(e){return $.extend({},m,e)},extend:function(){return $.extend({},m,this)}};return f}),define("../core/pdf/player-pdf",["../common/components/player-control/player-control","./operationIE8","./operation","../../common/helper"],function(e,t,n,i){var o={init:function(e){$.extend(this,e.api);var o;return i.isIE8()?o=t.extend.call(this):(o=n.extend.call(this),o.createPDF(e._launchStudy)),o},hidePdfContainer:function(){this.playerController.uiAppendToEle&&this.playerController.uiAppendToEle.hide()},showPdfContainer:function(){this.playerController.uiAppendToEle&&this.playerController.uiAppendToEle.show()},createPlayerController:function(t,n,o){var r=this;t.type!==i.playType.three&&(r.playerController=new e({container:n,core:o,launchStudy:t,schedule:Math.floor(parseFloat(t.core.studySchedule/100)*t.options.docTime),totalTime:t.options.docTime,events:{timeListen:function(){t.interceptConfig.isEnable&&t.event.frameListen(r.playerController.getTime(),r)}},event:t.event}),this.player=r.playerController,r.streamCompleted&&r.streamCompleted(r.playerController))}};return o});var swfobject=function(){function e(){if(!V){try{var e=$.getElementsByTagName("body")[0].appendChild(y("span"));e.parentNode.removeChild(e)}catch(t){return}V=!0;for(var n=U.length,i=0;i<n;i++)U[i]()}}function t(e){V?e():U[U.length]=e}function n(e){if(typeof F.addEventListener!=E)F.addEventListener("load",e,!1);else if(typeof $.addEventListener!=E)$.addEventListener("load",e,!1);else if(typeof F.attachEvent!=E)g(F,"onload",e);else if("function"==typeof F.onload){var t=F.onload;F.onload=function(){t(),e()}}else F.onload=e}function i(){D?o():r()}function o(){var e=$.getElementsByTagName("body")[0],t=y(M);t.setAttribute("type",A);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=E){var o=n.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),q.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)])}else if(i<10)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,r()}()}else r()}function r(){var e=R.length;if(e>0)for(var t=0;t<e;t++){var n=R[t].id,i=R[t].callbackFn,o={success:!1,id:n};if(q.pv[0]>0){var r=h(n);if(r)if(!v(R[t].swfVersion)||q.wk&&q.wk<312)if(R[t].expressInstall&&a()){var d={};d.data=R[t].expressInstall,d.width=r.getAttribute("width")||"0",d.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(d.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(d.align=r.getAttribute("align"));for(var u={},p=r.getElementsByTagName("param"),m=p.length,f=0;f<m;f++)"movie"!=p[f].getAttribute("name").toLowerCase()&&(u[p[f].getAttribute("name")]=p[f].getAttribute("value"));c(d,u,n,i)}else l(r),i&&i(o);else w(n,!0),i&&(o.success=!0,o.ref=s(n),i(o))}else if(w(n,!0),i){var y=s(n);y&&typeof y.SetVariable!=E&&(o.success=!0,o.ref=y),i(o)}}}function s(e){var t=null,n=h(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=E)t=n;else{var i=n.getElementsByTagName(M)[0];i&&(t=i)}return t}function a(){return!Q&&v("6.0.65")&&(q.win||q.mac)&&!(q.wk&&q.wk<312)}function c(e,t,n,i){Q=!0,_=i||null,T={success:!1,id:n};var o=h(n);if(o){"OBJECT"==o.nodeName?(S=d(o),C=null):(S=o,C=n),e.id=O,(typeof e.width==E||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==E||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),$.title=$.title.slice(0,47)+" - Flash Player Installation";var r=q.ie&&q.win?"ActiveX":"PlugIn",s="MMredirectURL="+encodeURI(F.location).toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+$.title;
if(typeof t.flashvars!=E?t.flashvars+="&"+s:t.flashvars=s,q.ie&&q.win&&4!=o.readyState){var a=y("div");n+="SWFObjectNew",a.setAttribute("id",n),o.parentNode.insertBefore(a,o),o.style.display="none",function(){4==o.readyState?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}u(e,t,n)}}function l(e){if(q.ie&&q.win&&4!=e.readyState){var t=y("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=y("div");if(q.win&&q.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(M)[0];if(n){var i=n.childNodes;if(i)for(var o=i.length,r=0;r<o;r++)1==i[r].nodeType&&"PARAM"==i[r].nodeName||8==i[r].nodeType||t.appendChild(i[r].cloneNode(!0))}}return t}function u(e,t,n){var i,o=h(n);if(q.wk&&q.wk<312)return i;if(o)if(typeof e.id==E&&(e.id=n),q.ie&&q.win){var r="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?t.movie=e[s]:"styleclass"==s.toLowerCase()?r+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(r+=" "+s+'="'+e[s]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');r=' style="z-index:1000;position:relative" '+r,o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+a+"</object>",B[B.length]=e.id,i=h(e.id)}else{var l=y(M);l.setAttribute("type",A);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));l.style.position="relative",l.style.zIndex=1e3;for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(l,u,t[u]);o.parentNode.replaceChild(l,o),i=l}return i}function p(e,t,n){var i=y("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function m(e){var t=h(e);t&&"OBJECT"==t.nodeName&&(q.ie&&q.win?(t.style.display="none",function(){4==t.readyState?f(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function f(e){var t=h(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function h(e){var t=null;try{t=$.getElementById(e)}catch(n){}return t}function y(e){return $.createElement(e)}function g(e,t,n){e.attachEvent(t,n),H[H.length]=[e,t,n]}function v(e){var t=q.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function b(e,t,n,i){if(!q.ie||!q.mac){var o=$.getElementsByTagName("head")[0];if(o){var r=n&&"string"==typeof n?n:"screen";if(i&&(x=null,k=null),!x||k!=r){var s=y("style");s.setAttribute("type","text/css"),s.setAttribute("media",r),x=o.appendChild(s),q.ie&&q.win&&typeof $.styleSheets!=E&&$.styleSheets.length>0&&(x=$.styleSheets[$.styleSheets.length-1]),k=r}q.ie&&q.win?x&&typeof x.addRule==M&&x.addRule(e,t):x&&typeof $.createTextNode!=E&&x.appendChild($.createTextNode(e+" {"+t+"}"))}}}function w(e,t){if(G){var n=t?"visible":"hidden";V&&h(e)?h(e).style.visibility=n:b("#"+e,"visibility:"+n)}}function I(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=E?encodeURIComponent(e):e}var S,C,_,T,x,k,E="undefined",M="object",L="Shockwave Flash",P="ShockwaveFlash.ShockwaveFlash",A="application/x-shockwave-flash",O="SWFObjectExprInst",j="onreadystatechange",F=window,$=document,N=navigator,D=!1,U=[i],R=[],B=[],H=[],V=!1,Q=!1,G=!0,q=function(){var e=typeof $.getElementById!=E&&typeof $.getElementsByTagName!=E&&typeof $.createElement!=E,t=N.userAgent.toLowerCase(),n=N.platform.toLowerCase(),i=n?/win/.test(n):/win/.test(t),o=n?/mac/.test(n):/mac/.test(t),r=n?/iphone/.test(n):/iphone/.test(t),r=r?r:n?/ipad/.test(n):/ipad/.test(t),r=r?r:n?/ipod/.test(n):/ipod/.test(t),s=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a=!1,c=[0,0,0],l=null,d=t.match(/\([^)]*\)/),u=null;if(null!=d&&0!=d.length)for(var p=d[0].split(";"),m=0;m<p.length;m++){var f=p[m].match(/android .*/);null!=f&&(u=f[0].substr(8).split("."))}if(typeof N.plugins!=E&&typeof N.plugins[L]==M)l=N.plugins[L].description,!l||typeof N.mimeTypes!=E&&N.mimeTypes[A]&&!N.mimeTypes[A].enabledPlugin||(D=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),c[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),c[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof F.ActiveXObject!=E)try{var h=new ActiveXObject(P);h&&(l=h.GetVariable("$version"),l&&(a=!0,l=l.split(" ")[1].split(","),c=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(y){}return{w3:e,pv:c,wk:s,ie:a,win:i,mac:o,ios:r,android:u}}();(function(){q.w3&&((typeof $.readyState!=E&&"complete"==$.readyState||typeof $.readyState==E&&($.getElementsByTagName("body")[0]||$.body))&&e(),V||(typeof $.addEventListener!=E&&$.addEventListener("DOMContentLoaded",e,!1),q.ie&&q.win&&($.attachEvent(j,function(){"complete"==$.readyState&&($.detachEvent(j,arguments.callee),e())}),F==top&&!function(){if(!V){try{$.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),q.wk&&!function(){if(!V)return/loaded|complete/.test($.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))})(),function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var e=H.length,t=0;t<e;t++)H[t][0].detachEvent(H[t][1],H[t][2]);for(var n=B.length,i=0;i<n;i++)m(B[i]);for(var o in q)q[o]=null;q=null;for(var r in swfobject)swfobject[r]=null;swfobject=null})}();return{registerObject:function(e,t,n,i){if(q.w3&&e&&t){var o={};o.id=e,o.swfVersion=t,o.expressInstall=n,o.callbackFn=i,R[R.length]=o,w(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){if(q.w3)return s(e)},embedSWF:function(e,n,i,o,r,s,l,d,p,m){var f={success:!1,id:n};q.w3&&!(q.wk&&q.wk<312)&&e&&n&&i&&o&&r?(w(n,!1),t(function(){i+="",o+="";var t={};if(p&&typeof p===M)for(var h in p)t[h]=p[h];t.data=e,t.width=i,t.height=o;var y={};if(d&&typeof d===M)for(var g in d)y[g]=d[g];if(l&&typeof l===M)for(var b in l)typeof y.flashvars!=E?y.flashvars+="&"+b+"="+l[b]:y.flashvars=b+"="+l[b];if(v(r)){var I=u(t,y,n);t.id==n&&w(n,!0),f.success=!0,f.ref=I}else{if(s&&a())return t.data=s,void c(t,y,n,m);w(n,!0)}m&&m(f)})):m&&m(f)},switchOffAutoHideShow:function(){G=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:v,createSWF:function(e,t,n){return q.w3?u(e,t,n):void 0},showExpressInstall:function(e,t,n,i){q.w3&&a()&&c(e,t,n,i)},removeSWF:function(e){q.w3&&m(e)},createCSS:function(e,t,n,i){q.w3&&b(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=$.location.search||$.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return I(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return I(n[i].substring(n[i].indexOf("=")+1))}return""},getElementById:h,expressInstallCallback:function(){if(Q){var e=h(O);e&&S&&(e.parentNode.replaceChild(S,e),C&&(w(C,!0),q.ie&&q.win&&(S.style.display="block")),_&&_(T)),Q=!1}}}}(),p2ps_light_layer=null;define("../core/common/player",function(){}),define("../core/common/player-kernel",["../../common/helper","./player"],function(e){function t(){this.constructor=this,this.swfObject=null,this.__isReadyStreamCompleted=!1,this.__isInitSuccess=!1,this.__isInvokeLoadStream=!1,this.p2pOptions={type:"auto",streamType:"vod",streamUrl:"",swfUrl:"",replaceElemIdStr:"",width:"640",height:"480",autoPlay:!0,sidebarBtn:!1,shareBtn:!1,lightBtn:!1,speedBtn:!1,streamBtn:!0},this.initConfig={startAt:0},this.monitorConfig={stateListener:function(t,n){e.log(t)},startAtListener:function(t){var n=function(t){var n=t.getDuration();if(!e.isUndefined(n)&&n>0){var i=t.initConfig.startAt<=0?0:parseInt(t.initConfig.startAt);t.initConfig.startAt=i>=parseInt(n)?0:i,t.play(t.initConfig.startAt),t.monitorConfig.streamCompleted&&t.monitorConfig.streamCompleted(t),e.clearInterval(t.__startAtInterval),t.__startAtInterval=void 0}};t.__startAtInterval=e.setInterval(function(){n(t)},800),t.__setIntervalProperty("__startAtInterval")},initCompleted:function(e){},streamCompleted:function(e){}},this.intervalProperties=[]}function n(t){var n=t.p2pOptions.replaceElemIdStr;if(!e.isString(n))return void e.error("flash containerId is not string");var i=n+"_insider",o=document.getElementById(i);o&&(o.parentNode.removeChild(o),o=void 0),o=document.createElement("div"),o.id=i;var r=document.createElement("h2");r.innerHTML="我们需要Flash player 10.1或以上版本来播放。",o.appendChild(r);var s=document.createElement("p"),a=document.createElement("a");a.href="http://www.adobe.com/go/getflashplayer";var c=document.createElement("img");c.src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif",c.alt="安装最新的Flash player",a.appendChild(c),s.appendChild(a),o.appendChild(s);var l=document.getElementById(n);l.appendChild(o),t.p2pOptions.replaceElemIdStr=i}function i(e){var t={auto_play:e.p2pOptions.autoPlay?1:0,no_side_bar:e.p2pOptions.sidebarBtn?0:1,no_share:e.p2pOptions.shareBtn?0:1,no_light:e.p2pOptions.lightBtn?0:1,enable_speed_btn:e.p2pOptions.speedBtn?1:0,enable_stream_btn:e.p2pOptions.streamBtn?1:0,seek_mode:"accuracy"},n={allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"},i={};window.p2psr_embed(e.p2pOptions.type,e.p2pOptions.streamType,e.p2pOptions.streamUrl,e.p2pOptions.swfUrl,e.p2pOptions.replaceElemIdStr,e.p2pOptions.width,e.p2pOptions.height,"10.1.0","expressInstall.swf",t,n,i,function(t){o(t,e)})}function o(t,n){var i="播放器初始化失败！";if(t.success===!0){var o=t.ref;o.getDefinitions=function(){return this.p2ps_get("definitions")},o.setDefinition=function(e){this.p2ps_set("definition",e)},i="播放器初始化成功！",n.__isInitSuccess=!0,n.swfObject=document.getElementById(t.id),n.swfObject.setEventListener("__playerEventListener"),n.p2pOptions.autoPlay&&n.swfObject.resume(),s(n.monitorConfig.initCompleted)(n),s(n.monitorConfig.startAtListener)(n)}e.log(i)}function r(e,t){var n;switch(e.type){case"eventPlayerReady":$("body").css({cursor:"wait"});break;case"eventPlayStart":$("body").css({cursor:"default"});break;case"eventPlayOpen":t.__isInvokeLoadStream||(s(t.monitorConfig.stateListener)("start",t),t.__isInvokeLoadStream=!0,t.__isReadyStreamCompleted=!0),n="play";break;case"eventPlaySeek":n="seek";break;case"eventPlayPause":n="pause";break;case"eventStreamEnd":n="end";break;case"eventPlayClose":n="close";break;case"eventPlayResume":n="resume"}s(t.monitorConfig.stateListener)(n,t)}function s(t){return e.isFunction(t)?t:function(){}}var a={type:"auto",streamType:"vod",streamUrl:"",swfUrl:"",replaceElemIdStr:"",width:"640",height:"480",autoPlay:!0,sidebarBtn:!1,shareBtn:!1,lightBtn:!1,speedBtn:!1,streamBtn:!0},c={startAt:0};t.prototype={__setIntervalProperty:function(e){this.intervalProperties.push(e)},init:function(t,o,r,s,a,c,l,d,u,p){var m=this;e.isString(t)&&e.isString(o)&&!e.isEmptyString(o)&&("string"!=typeof r||e.isEmptyString(r)||e.isFunction(p)&&(m.monitorConfig.initCompleted=p,m.p2pOptions.replaceElemIdStr=t,m.p2pOptions.streamUrl=o,m.p2pOptions.swfUrl=r,s&&(m.p2pOptions.type=s),a&&(m.p2pOptions.streamType=a),c&&(m.p2pOptions.width=c),l&&(m.p2pOptions.height=l),u&&(m.initConfig.startAt=u),$.extend(m.p2pOptions,d),n(m),i(m)))},getState:function(){if(this.__isInitSuccess)return this.swfObject.getState()},play:function(t){return this.__isInitSuccess&&(e.isNumber(t)?this.swfObject.seek(t):this.swfObject.resume()),this},pause:function(){return this.__isInitSuccess&&this.swfObject.pause(),this},close:function(){return this.__isInitSuccess&&this.swfObject.close(),this},getTime:function(){if(this.__isInvokeLoadStream)try{return this.swfObject.getTime()}catch(e){return}},getDuration:function(){if(this.__isInvokeLoadStream)try{return this.swfObject.getDuration()}catch(e){return}},getVolume:function(){if(this.__isInitSuccess)return this.swfObject.getVolume()},setVolume:function(t){return this.__isInitSuccess&&t&&e.isNumber(t)&&(t=Math.abs(t%100),this.swfObject.setVolume(t)),this},getMute:function(){if(this.__isInitSuccess)return this.swfObject.getMute()},setMute:function(t){return this.__isInitSuccess&&e.isBoolean(t)&&this.swfObject.setMute(t),this},getDefinitions:function(){return this.swfObject.getDefinitions()},setDefinition:function(e){this.swfObject.setDefinition(e)},getPlayerVersion:function(){return this.__isInitSuccess?this.swfObject.getVersion():"none"},setOption:function(e,t){return this.__isInitSuccess&&this.swfObject.setOption(e,t),this},reset:function(){var t=this.intervalProperties;for(var n in t)e.clearInterval(this[t[n]]);this.intervalProperties=[],this.__isReadyStreamCompleted=!1,this.__isInitSuccess=!1,this.__isInvokeLoadStream=!1,this.swfObject=null,this.p2pOptions=a,this.initConfig=c,this.monitorConfig.stateListener=function(t,n){e.log(t)},this.monitorConfig.initCompleted=function(e){}},destroy:function(){this.reset(),window.swfPlayer=null},setStateListen:function(t){return e.isFunction(t)?void(this.monitorConfig.stateListener=t):void e.error("fn is not a Function!")}},window.__playerEventListener=function(e){r(e,swfPlayer)};var l=new t;return window.swfPlayer=l,window.onunload=function(){swfPlayer.destroy()},l}),define("../core/common/player-frame",["../../common/helper"],function(e){function t(t,n,i){var o=n.getTime();e.log("current time is:"+o),i&&i(o,t,n)}var n=window,i=function(){this.currentState="none",this.currentPlayer=void 0,this.init=function(e,t){return t.frameListen&&t.frameListen.destroy(),this.currentPlayer=t,this.currentModule=e,t.frameListen=this,this},this.delayFunction=function(){},this.__listeningId=void 0,this.isInit=function(){return this.currentPlayer&&"object"==typeof this.currentPlayer},this.listening=function(i){if(void 0!=i&&"function"==typeof i&&(this.delayFunction=i),!this.__listeningId){e.log("Start frame listening...");var o=this;o.delayFunction&&(o.__listeningId=n.setInterval(function(){t(o.currentModule,o.currentPlayer,o.delayFunction)},1e3),this.currentState="listening")}},this.stopListen=function(){this.__listeningId&&(e.log("Stop frame listening..."),n.clearInterval(this.__listeningId),this.__listeningId=void 0,this.currentState="none")},this.destroy=function(){this.stopListen(),this.currentPlayer=void 0,this.currentModule=void 0}};return i}),define("../core/single/player-single",["../common/player-kernel","../../common/helper","../common/player-event","../common/player-timer","../common/player-frame"],function(e,t,n,i,o){function r(e,n,i){var o=n.getCurrentLaunchStudyCore(i),r=o.core.historyMaxScale>=o.core.studyCurrentScale;switch(e){case"play":case"pause":case"close":break;case"seek":i.options.isCanSeek||r||n.playCurrent(o.core.historyMaxScale);break;case"end":i.extend.studyMode==t.playMode.learn&&n.LMSCommit(e),n.pauseCurrent()}}function s(e,n,i){e.player.getTime()>=n&&(e.player.seek(0),e.player.pause(),e.__timerFactory.get(t.Const.Timing["break"]).stop(),t.log("preview end!"),t.isFunction(i)&&i(e.player))}var a={type:t.playType.single,player:e,playerContainerId:"p2ps_video",__stateEvent:void 0,__timerFactory:void 0,setStateListening:function(e,i){return t.isUndefined(this.__stateEvent)&&(this.__stateEvent=new n),this.__stateEvent.add(e,i),this},__init:function(e){var a=this.player,c=this;a.reset(),t.isUndefined(c.__stateEvent)&&(c.__stateEvent=new n);var l=e&&e.event&&e.event.initPlay;if(c.__stateEvent.add("init",function(e,t){l&&l(e,t),c.initCompleted&&c.initCompleted(c)}),e.extend.studyMode==t.playMode.learn&&c.__stateEvent.add(["play","seek","close","pause","end"],function(e,t,n){r(e,t,n)}),a.monitorConfig.streamCompleted=c.streamCompleted,e.interceptConfig.isEnable){var d=new o;d.init(c,a),c.__stateEvent.get("frame")&&d.listening(c.__stateEvent.get("frame"))}a.setStateListen(function(t,n){var i=c.__stateEvent.get(t),o=c.__stateEvent.getStateEvent();i&&i(t,c,e),o&&o(t,n)});var u,p=!1;e.options.containerId&&(c.playerContainerId=e.options.containerId,u=document.getElementById(c.playerContainerId),p=!t.isUndefined(u)),p||(u=document.createElement("div"),u.id=c.playerContainerId,document.body.appendChild(u));var m=e.options.width,f=e.options.height;if(c.__timerFactory=e.__timerFactory||new i,m=m||"100%",f=f||"500px",e.extend.studyMode==t.playMode.learn)2==e.core.studyStatus&&e.core.studyMode!=t.playMode.learn||c.__timerFactory.create(t.Const.Timing.commit,1e3*e.objectives.policy.intervalTime,function(){c.LMSCommit("play")});else if(e.extend.studyMode==t.playMode.preview){var h=e.options.limit;h>0&&c.__timerFactory.create(t.Const.Timing["break"],1e3,function(){s(c,h,e.options.callback)})}a.init(c.playerContainerId,e.interaction.streamHost,e.interaction.streamPath,"auto","vod",m,f,e.interaction.p2p_option,e.options.startAt,function(t){var n=c.__stateEvent.getInitEvent();n&&n(t,e.core)})},initPlayer:function(e){this.__init(e)},pauseCurrent:function(){"playing"===this.player.getState()&&this.player.pause(),this.player.frameListen&&this.player.frameListen.stopListen()},playCurrent:function(e){t.isNumber(e)?this.player.play(e):this.player.play(),this.player.frameListen&&this.player.frameListen.listening()},resetCommitTimer:function(e,n){var i=this;t.isUndefined(n)&&(n=function(){i.LMSCommit("play")}),this.__timerFactory.reset(t.Const.Timing.commit,e,n)},initCompleted:function(e){},streamCompleted:function(e){},getCurrentLaunchStudyCore:function(e){var t={},n=e.core;t.primaryKey=n.primaryKey,t.courseRecordId=n.courseRecordId,t.coursewareRecordId=n.coursewareRecordId,t.studentId=n.studentId,t.studentName=n.studentName,t.lessonId=n.lessonId,t.lessonLocation=n.lessonLocation,t.studyMode=n.studyMode,t.studyLastScale=n.studyLastScale,t.historyMaxScale=n.studyCurrentScale,t.studyCurrentScale=parseInt(this.player.getTime());var i=parseInt(this.player.getDuration(),10);switch(t.studyCurrentScale==-1&&(t.studyCurrentScale=e.core.studyCurrentScale),t.studySchedule=100*parseFloat(t.studyCurrentScale/i),t.timingMode="schedule",t.studyStatus=n.studyStatus,this.player.getState()){case"not_ready":case"not_open":case"pause":default:t.lessonStatus="passed";break;case"playing":t.lessonStatus="browsed";break;case"end":t.lessonStatus="completed"}return{core:t,extend:e.context}},commitAfter:function(e){var n=e.core,i=e.objectives,o=this;if(i.modifyPolicy&&(o.__timerFactory.reset(t.Const.Timing.commit,1e3*i.policy.intervalTime,function(){o.LMSCommit()}).start(),this.player.play(n.studyCurrentScale)),t.isFunction(e.event.commitAfter)){({multimediaRecordId:n.primaryKey,coursewareRecordId:n.coursewareRecordId,courseRecordId:n.courseRecordId,mediaSchedule:n.studySchedule,coursewareSchedule:n.coursewareSchedule,courseSchedule:n.courseSchedule,courseId:n.courseId,courseWareId:n.courseWareId,multimediaId:n.multimediaId});e.event.commitAfter(n,o.player)}},destroy:function(){this.__timerFactory&&this.__timerFactory.destroy(),this.__stateEvent&&(this.__stateEvent=void 0),this.player&&this.player.frameListen&&this.player.frameListen.destroy()},LMSInitialize:function(){},LMSCommit:function(){},LMSFinish:function(){},LMSSetValue:function(e,t){},LMSGetValue:function(e){},LMSGetLastError:function(){},LMSGetErrorString:function(e){},LMSGetDiagnostic:function(e){}};return{init:function(e){return $.extend({},a,e)}}}),define("../core/three/player-three",["../single/player-single","../../common/helper","../pdf/operation","../pdf/operationIE8","../common/player-timer"],function(e,t,n,i,o){function r(e){this.player=e,this.moveMediaTime=function(e){this.player.play(e)}}function s(e){w={},g={},b={},I=0,S=0,C=$.grep(e.extend.lessonCatalog,function(e,t){return"0"==e.parentId}),g=$.grep(e.extend.lessonCatalog,function(e,t){return"-1"!=e.timePoint}),g=g.sort(function(e,t){return e.timePoint>t.timePoint?1:e.timePoint<t.timePoint?-1:0}),v=e.extend.lessonDocument.sort(function(e,t){return e.timePoint>t.timePoint?1:e.timePoint<t.timePoint?-1:0});for(var t=0;t<v.length;t++)b[Number(v[t].timePoint)]=v[t].path,w[Number(v[t].timePoint)]=v[t].expand}function a(){_=[];var e=document.getElementById("media-catalog"),t=document.createElement("div"),n=document.createElement("div");n.setAttribute("class","signer-content posrel");var i=document.createElement("ul");i.setAttribute("class","ul-name"),i.style.width=152*C.length+"px",i.style.left=0;for(var o=0;o<C.length;o++)if(p(g,C[o].id)){var r=$.grep(g,function(e,t){return e.parentId==C[t].id});$(i).appendChild("<li class='passage-tree-li'><a class='tree-first-a' href='javascript:void(0)' >"+C[o].name+"</a></li>");for(var s=0;s<r.length;s++){var a=document.createElement("ul");if(a.setAttribute("class","passage-tree-first"),p(g,r[s].id)){var c=$.grep(g,function(e,t){return e.ParentId==r[t].id});$(a).append("<li class='tree-first-li'><em class='chlid-ico ico child-se-ico hide'></em><a href='javascript:void(0)' class='tree-second-a'>"+r[s].name+"</a>NaN");for(var l=document.createElement("ul"),d=0;d<c.length;d++)$(l).append("<li><button  id='"+c[d].id+"' name='catalogGroup' onclick='API.moveMediaTime("+c[d].timePoint+")>"+c[d].name+"</button></li>"),_.push(c[d])}else $(a).append("<li class='tree-first-li'><em class='chlid-ico ico child-se-ico hide'></em><button name='catalogGroup' id='"+r[s].id+"'  onclick='API.moveMediaTime("+r[s].timePoint+")' class='tree-second-a'>"+r[s].name+"</button>NaN"),_.push(r[s])}}else $(i).append("<li id='"+C[o].id+"'  onclick='API.moveMediaTime("+C[o].timePoint+")' ><div class='txt'><p>"+C[o].name+"</p></div></li>"),_.push(C[o]);e&&e.appendChild(t),n.appendChild(i),e&&e.appendChild(n)}function c(e,t,n){if(0==e)return 0;for(var i=-1,o=0;o<t.length;o++){if(!(Number(t[o][n])<=e))return Number(i);i++}return i}function l(e){var n=$("#media-document");if(void 0!=e&&void 0!=e.swfObject){var i=Math.round(e.getTime());if(i>0){var o=c(i,v,"timePoint"),r=c(i,_,"timePoint");if(I!=o){I=o;var s=v[I].path,a=n.attr("src");s!==a&&n.attr("src",s)}S!=r&&(S=r,$("button[name=catalogGroup]").attr("class",""),$("#"+_[S].id).addClass("current").siblings().removeClass("current")),t.log("Document other invoke!")}}}function d(e){if(void 0!=e&&void 0!=e.swfObject){var n=Math.round(e.getTime());if(n>0){var i=c(n,v,"timePoint"),o=c(n,_,"timePoint");I!=i&&(I=i,void 0!=window.frames[0].PDFViewerApplication&&window.frames[0].PDFViewerApplication.pdfViewer.scrollPageIntoView(v[I].expand)),S!=o&&(S=o,$("button[name=catalogGroup]").attr("class",""),$("#"+_[S].id).addClass("current").siblings().removeClass("current")),t.log("Document pdf invoke!")}}}function u(e){var n=0;if(void 0!=e&&void 0!=e.swfObject){var i=Math.round(e.getTime());if(i>0){var o=c(i,_,"timePoint");n!=o&&(n=o,$("button[name=catalogGroup]").attr("class",""),$("#"+_[n].id).addClass("current").siblings().removeClass("current")),t.log("Document pdfIE8 invoke!")}}}function p(e,t){for(var n=e.length;n--;)if(e[n].ParentId===t)return!0;return!1}function m(){$("#media-catalog").html("")}function f(e,n){m(),s(e),a();var i,r=$("#media-document");if(n.__timerFactory||(n.__timerFactory=new o),n.__timerFactory.create(t.Const.Document.exchange,1e3,function(){l(n.player)}),1==e.extend.studyMode){var d=Number(e.core.studyLastScale);i=c(d,_,"timePoint"),$("button[name=catalogGroup]").attr("class",""),_.length>0&&i>=0&&$("#"+_[i].id).addClass("current").siblings().removeClass("current"),S=i,d>0?(i=c(d,v,"timePoint"),r.attr("src",v[i].path)):r.attr("src",v[0].path),I=i}else _.length>0&&$("#"+_[0].id).addClass("current").siblings().removeClass("current"),r.attr("src",v[0].path),n.__timerFactory.get(t.Const.Document.exchange).start();if(r&&r[0]){var u=r[0];u.attachEvent?u.attachEvent("onload",function(){e.styleOptions&&$(u.contentWindow.document).find("body").css(e.styleOptions.mediaDocument)}):u.onload=function(){e.styleOptions&&$(u.contentWindow.document).find("body").css(e.styleOptions.mediaDocument)}}}function h(e,i,r){m(),s(e);var c=encodeURIComponent(v[0].path),l={pdfHtmlAddress:e.pdfHtmlAddress,options:{startAt:e.options.startAt,containerId:"media-document",width:t.getStyleByOptions(e.style,e.type,"width")||"823px",height:t.getStyleByOptions(e.style,e.type,"height")||"576px"}};i.Document=n.init(r).createPDF(l,c),i.__timerFactory||(i.__timerFactory=new o),i.__timerFactory.create(t.Const.Document.exchange,1e3,function(){d(i.player)}),a(),1==e.extend.studyMode?(void 0!=window.frames[0].PDFViewerApplication&&window.frames[0].PDFViewerApplication.pdfViewer.scrollPageIntoView(1),_.length>0&&$("#"+_[0].id).addClass("current").siblings().removeClass("current")):(_.length>0&&$("#"+_[0].id).addClass("current").siblings().removeClass("current"),void 0!=window.frames[0].PDFViewerApplication&&window.frames[0].PDFViewerApplication.pdfViewer.scrollPageIntoView(1))}function y(e,n,r){m(),s(e),e.options.containerId="media-document",n.Document=i.init(r).initPlayer(e),n.__timerFactory||(n.__timerFactory=new o),n.__timerFactory.create(t.Const.Document.exchange,1e3,function(){u(n.player)}),a(),1!=e.extend.studyMode?_.length>0&&$("#"+_[0].id).addClass("current").siblings().removeClass("current"):_.length>0&&$("#"+_[0].id).addClass("current").siblings().removeClass("current")}var g={},v={},b={},w={},I=0,S=0,C={},_=[],T={init:function(n){var i=e.init(n);return i.type="three",i.initPlayer=function(e){e.options.width=e.options.width||"100%",e.options.height=e.options.height||"100%",this.__init(e),$.extend(window.API,new r(i.player)),e.extend.lessonDocument.length>0&&4==e.extend.lessonDocument[0].type?t.isIE8()?y(e,i,n):h(e,i,n):e.extend.lessonDocument.length>0&&4!=e.extend.lessonDocument[0].type&&f(e,i)},i}};return T}),define("../web/web-player",["../common/helper","../core/common/player-timer"],function(e,t){var n={type:"web",player:"",__timerFactory:void 0,initPlayer:function(n){var i=this,o=void 0,r=n.objectives,s=n.core,a=n.interaction.streamHost+n.interaction.streamPath;o=""!=n.options.containerId&&void 0!=n.options.containerId?document.getElementById(n.options.containerId):document.getElementById("web_container"),e.isEmptyString(o)?e.log("web_container id is null"):(o.src=a,o.style.height=void 0==n.options.height||""==n.options.height?"685px":n.options.height,o.style.width=void 0==n.options.width||""==n.options.width?"100%":n.options.width,o.frameBorder=0),i.__timerFactory&&i.__timerFactory.destroy(),n.extend.studyMode==e.playMode.learn&&(s.mediaTotalTimeLength<10&&window.setTimeout(function(){i.LMSCommit("play")},1e4),e.isUndefined(i.__timerFactory)&&(i.__timerFactory=new t),i.__timerFactory.create(e.Const.Timing.commit,1e3*r.policy.intervalTime,function(){i.LMSCommit("play")}),this.initCompleted(this))},getCurrentLaunchStudyCore:function(e){var t={},n=e.core,i=e.objectives.policy.intervalTime;return t.primaryKey=n.primaryKey,t.courseRecordId=n.courseRecordId,t.coursewareRecordId=n.coursewareRecordId,t.lessonId=n.lessonId,t.lessonLocation=n.lessonLocation,t.studyMode=n.studyMode,t.studyLastScale=n.studyLastScale+i,t.studyCurrentScale=n.studyCurrentScale+i,t.studySchedule=n.studySchedule,t.timingMode="scale",t.studyStatus=n.studyStatus,t.lessonStatus=1,{core:t,extend:e.context}},commitAfter:function(t){var n=t.core,i=t.objectives,o=this;if(i.modifyPolicy&&o.__timerFactory.reset(e.Const.Timing.commit,1e3*i.policy.intervalTime,function(){o.LMSCommit()}).start(),e.isFunction(t.event.commitAfter)){({multimediaRecordId:n.primaryKey,coursewareRecordId:n.coursewareRecordId,courseRecordId:n.courseRecordId,mediaSchedule:n.studySchedule,coursewareSchedule:n.coursewareSchedule,courseSchedule:n.courseSchedule,courseId:n.courseId,courseWareId:n.courseWareId,multimediaId:n.multimediaId});t.event.commitAfter(n,o.player)}},destroy:function(){this.__timerFactory&&this.__timerFactory.destroy()},LMSInitialize:function(){},LMSCommit:function(){},LMSFinish:function(){},LMSSetValue:function(e,t){},LMSGetValue:function(e){},LMSGetLastError:function(){},LMSGetErrorString:function(e){},LMSGetDiagnostic:function(e){}},i={init:function(e){return $.extend({},n,e)}};return i}),!function(e,t){"function"==typeof define&&define.amd?define("../extend/remodal/dist/remodal",["jquery"],function(n){return t(e,n)}):"object"==typeof exports?t(e,require("jquery")):t(e,e.jQuery||e.Zepto)}(this,function(e,t){function n(e){if(S&&"none"===e.css("animation-name")&&"none"===e.css("-webkit-animation-name")&&"none"===e.css("-moz-animation-name")&&"none"===e.css("-o-animation-name")&&"none"===e.css("-ms-animation-name"))return 0;var t,n,i,o,r=e.css("animation-duration")||e.css("-webkit-animation-duration")||e.css("-moz-animation-duration")||e.css("-o-animation-duration")||e.css("-ms-animation-duration")||"0s",s=e.css("animation-delay")||e.css("-webkit-animation-delay")||e.css("-moz-animation-delay")||e.css("-o-animation-delay")||e.css("-ms-animation-delay")||"0s",a=e.css("animation-iteration-count")||e.css("-webkit-animation-iteration-count")||e.css("-moz-animation-iteration-count")||e.css("-o-animation-iteration-count")||e.css("-ms-animation-iteration-count")||"1";for(r=r.split(", "),s=s.split(", "),a=a.split(", "),o=0,n=r.length,t=Number.NEGATIVE_INFINITY;o<n;o++)i=parseFloat(r[o])*parseInt(a[o],10)+parseFloat(s[o]),i>t&&(t=i);return t}function i(){if(t(document.body).height()<=t(window).height())return 0;var e,n,i=document.createElement("div"),o=document.createElement("div");return i.style.visibility="hidden",i.style.width="100px",document.body.appendChild(i),e=i.offsetWidth,i.style.overflow="scroll",o.style.width="100%",i.appendChild(o),n=o.offsetWidth,i.parentNode.removeChild(i),e-n}function o(){if(!C){var e,n,o=t("html"),r=d("is-locked");o.hasClass(r)||(n=t(document.body),e=parseInt(n.css("padding-right"),10)+i(),n.css("padding-right",e+"px"),o.addClass(r))}}function r(){if(!C){var e,n,o=t("html"),r=d("is-locked");o.hasClass(r)&&(n=t(document.body),e=parseInt(n.css("padding-right"),10)-i(),n.css("padding-right",e+"px"),o.removeClass(r))}}function s(e,t,n,i){var o=d("is",t),r=[d("is",w.CLOSING),d("is",w.OPENING),d("is",w.CLOSED),d("is",w.OPENED)].join(" ");e.$bg.removeClass(r).addClass(o),e.$overlay.removeClass(r).addClass(o),e.$wrapper.removeClass(r).addClass(o),e.$modal.removeClass(r).addClass(o),e.state=t,!n&&e.$modal.trigger({type:t,reason:i},[{reason:i}])}function a(e,i,o){var r=0,s=function(e){e.target===this&&r++},a=function(e){e.target===this&&0===--r&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){o[t].off(g+" "+v)}),i())};t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){o[t].on(g,s).on(v,a)}),e(),0===n(o.$bg)&&0===n(o.$overlay)&&0===n(o.$wrapper)&&0===n(o.$modal)&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){o[t].off(g+" "+v)}),i())}function c(e){e.state!==w.CLOSED&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(t,n){e[n].off(g+" "+v)}),e.$bg.removeClass(e.settings.modifier),e.$overlay.removeClass(e.settings.modifier).hide(),e.$wrapper.hide(),r(),s(e,w.CLOSED,!0))}function l(e){var t,n,i,o,r={};for(e=e.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,","),t=e.split(","),o=0,n=t.length;o<n;o++)t[o]=t[o].split(":"),i=t[o][1],("string"==typeof i||i instanceof String)&&(i="true"===i||"false"!==i&&i),("string"==typeof i||i instanceof String)&&(i=isNaN(i)?i:+i),r[t[o][0]]=i;return r}function d(){for(var e=y,t=0;t<arguments.length;++t)e+="-"+arguments[t];return e}function u(){var e,n,i=location.hash.replace("#","");if(i){try{n=t('[data-remodal-id="'+i+'"]')}catch(o){}n&&n.length&&(e=t[h].lookup[n.data(h)],e&&e.settings.hashTracking&&e.open())}else m&&m.state===w.OPENED&&m.settings.hashTracking&&m.close()}function p(e,n){var i=t(document.body),o=i,r=this;r.settings=t.extend({},b,n),r.index=t[h].lookup.push(r)-1,r.state=w.CLOSED,r.$overlay=t("."+d("overlay")),null!==r.settings.appendTo&&r.settings.appendTo.length&&(o=t(r.settings.appendTo)),r.$overlay.length||(r.$overlay=t("<div>").addClass(d("overlay")+" "+d("is",w.CLOSED)).hide(),o.append(r.$overlay)),r.$bg=t("."+d("bg")).addClass(d("is",w.CLOSED)),r.$modal=e.addClass(y+" "+d("is-initialized")+" "+r.settings.modifier+" "+d("is",w.CLOSED)).attr("tabindex","-1"),r.$wrapper=t("<div>").addClass(d("wrapper")+" "+r.settings.modifier+" "+d("is",w.CLOSED)).hide().append(r.$modal),
o.append(r.$wrapper),r.$wrapper.on("click."+y,'[data-remodal-action="close"]',function(e){e.preventDefault(),r.close()}),r.$wrapper.on("click."+y,'[data-remodal-action="cancel"]',function(e){e.preventDefault(),r.$modal.trigger(I.CANCELLATION),r.settings.closeOnCancel&&r.close(I.CANCELLATION)}),r.$wrapper.on("click."+y,'[data-remodal-action="confirm"]',function(e){e.preventDefault(),r.$modal.trigger(I.CONFIRMATION),r.settings.closeOnConfirm&&r.close(I.CONFIRMATION)}),r.$wrapper.on("click."+y,function(e){var n=t(e.target);n.hasClass(d("wrapper"))&&r.settings.closeOnOutsideClick&&r.close()})}var m,f,h="remodal",y=e.REMODAL_GLOBALS&&e.REMODAL_GLOBALS.NAMESPACE||h,g=t.map(["animationstart","webkitAnimationStart","MSAnimationStart","oAnimationStart"],function(e){return e+"."+y}).join(" "),v=t.map(["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"],function(e){return e+"."+y}).join(" "),b=t.extend({hashTracking:!0,closeOnConfirm:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:"",appendTo:null},e.REMODAL_GLOBALS&&e.REMODAL_GLOBALS.DEFAULTS),w={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened"},I={CONFIRMATION:"confirmation",CANCELLATION:"cancellation"},S=function(){var e=document.createElement("div").style;return void 0!==e.animationName||void 0!==e.WebkitAnimationName||void 0!==e.MozAnimationName||void 0!==e.msAnimationName||void 0!==e.OAnimationName}(),C=/iPad|iPhone|iPod/.test(navigator.platform);p.prototype.open=function(){var e,n=this;n.state!==w.OPENING&&n.state!==w.CLOSING&&(e=n.$modal.attr("data-remodal-id"),e&&n.settings.hashTracking&&(f=t(window).scrollTop(),location.hash=e),m&&m!==n&&c(m),m=n,o(),n.$bg.addClass(n.settings.modifier),n.$overlay.addClass(n.settings.modifier).show(),n.$wrapper.show().scrollTop(0),n.$modal.focus(),a(function(){s(n,w.OPENING)},function(){s(n,w.OPENED)},n))},p.prototype.close=function(e){var n=this;n.state!==w.OPENING&&n.state!==w.CLOSING&&(n.settings.hashTracking&&n.$modal.attr("data-remodal-id")===location.hash.substr(1)&&(location.hash="",t(window).scrollTop(f)),a(function(){s(n,w.CLOSING,!1,e)},function(){n.$bg.removeClass(n.settings.modifier),n.$overlay.removeClass(n.settings.modifier).hide(),n.$wrapper.hide(),r(),s(n,w.CLOSED,!1,e)},n))},p.prototype.getState=function(){return this.state},p.prototype.destroy=function(){var e,n=t[h].lookup;c(this),this.$wrapper.remove(),delete n[this.index],e=t.grep(n,function(e){return!!e}).length,0===e&&(this.$overlay.remove(),this.$bg.removeClass(d("is",w.CLOSING)+" "+d("is",w.OPENING)+" "+d("is",w.CLOSED)+" "+d("is",w.OPENED)))},t[h]={lookup:[]},t.fn[h]=function(e){var n,i;return this.each(function(o,r){i=t(r),null==i.data(h)?(n=new p(i,e),i.data(h,n.index),n.settings.hashTracking&&i.attr("data-remodal-id")===location.hash.substr(1)&&n.open()):n=t[h].lookup[i.data(h)]}),n},t(document).ready(function(){t(document).on("click","[data-remodal-target]",function(e){e.preventDefault();var n=e.currentTarget,i=n.getAttribute("data-remodal-target"),o=t('[data-remodal-id="'+i+'"]');t[h].lookup[o.data(h)].open()}),t(document).find("."+y).each(function(e,n){var i=t(n),o=i.data("remodal-options");o?("string"==typeof o||o instanceof String)&&(o=l(o)):o={},i[h](o)}),t(document).on("keydown."+y,function(e){m&&m.settings.closeOnEscape&&m.state===w.OPENED&&27===e.keyCode&&m.close()}),t(window).on("hashchange."+y,u)})}),function(){function e(e){function t(t,i){var r,h,y=t==window,g=i&&void 0!==i.message?i.message:void 0;if(i=e.extend({},e.blockUI.defaults,i||{}),!i.ignoreIfBlocked||!e(t).data("blockUI.isBlocked")){if(i.overlayCSS=e.extend({},e.blockUI.defaults.overlayCSS,i.overlayCSS||{}),r=e.extend({},e.blockUI.defaults.css,i.css||{}),i.onOverlayClick&&(i.overlayCSS.cursor="pointer"),h=e.extend({},e.blockUI.defaults.themedCSS,i.themedCSS||{}),g=void 0===g?i.message:g,y&&m&&n(window,{fadeOut:0}),g&&"string"!=typeof g&&(g.parentNode||g.jquery)){var v=g.jquery?g[0]:g,b={};e(t).data("blockUI.history",b),b.el=v,b.parent=v.parentNode,b.display=v.style.display,b.position=v.style.position,b.parent&&b.parent.removeChild(v)}e(t).data("blockUI.onUnblock",i.onUnblock);var w,I,S,C,_=i.baseZ;w=e(d||i.forceIframe?'<iframe class="blockUI" style="z-index:'+_++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+i.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),I=e(i.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+_++ +';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+_++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),i.theme&&y?(C='<div class="blockUI '+i.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(_+10)+';display:none;position:fixed">',i.title&&(C+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),C+='<div class="ui-widget-content ui-dialog-content"></div>',C+="</div>"):i.theme?(C='<div class="blockUI '+i.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(_+10)+';display:none;position:absolute">',i.title&&(C+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),C+='<div class="ui-widget-content ui-dialog-content"></div>',C+="</div>"):C=y?'<div class="blockUI '+i.blockMsgClass+' blockPage" style="z-index:'+(_+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+i.blockMsgClass+' blockElement" style="z-index:'+(_+10)+';display:none;position:absolute"></div>',S=e(C),g&&(i.theme?(S.css(h),S.addClass("ui-widget-content")):S.css(r)),i.theme||I.css(i.overlayCSS),I.css("position",y?"fixed":"absolute"),(d||i.forceIframe)&&w.css("opacity",0);var T=[w,I,S],x=e(y?"body":t);e.each(T,function(){this.appendTo(x)}),i.theme&&i.draggable&&e.fn.draggable&&S.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var k=p&&(!e.support.boxModel||e("object,embed",y?null:t).length>0);if(u||k){if(y&&i.allowBodyStretch&&e.support.boxModel&&e("html,body").css("height","100%"),(u||!e.support.boxModel)&&!y)var E=c(t,"borderTopWidth"),M=c(t,"borderLeftWidth"),L=E?"(0 - "+E+")":0,P=M?"(0 - "+M+")":0;e.each(T,function(e,t){var n=t[0].style;if(n.position="absolute",e<2)y?n.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+i.quirksmodeOffsetHack+') + "px"'):n.setExpression("height",'this.parentNode.offsetHeight + "px"'),y?n.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):n.setExpression("width",'this.parentNode.offsetWidth + "px"'),P&&n.setExpression("left",P),L&&n.setExpression("top",L);else if(i.centerY)y&&n.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),n.marginTop=0;else if(!i.centerY&&y){var o=i.css&&i.css.top?parseInt(i.css.top,10):0,r="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+o+') + "px"';n.setExpression("top",r)}})}if(g&&(i.theme?S.find(".ui-widget-content").append(g):S.append(g),(g.jquery||g.nodeType)&&e(g).show()),(d||i.forceIframe)&&i.showOverlay&&w.show(),i.fadeIn){var A=i.onBlock?i.onBlock:l,O=i.showOverlay&&!g?A:l,j=g?A:l;i.showOverlay&&I._fadeIn(i.fadeIn,O),g&&S._fadeIn(i.fadeIn,j)}else i.showOverlay&&I.show(),g&&S.show(),i.onBlock&&i.onBlock.bind(S)();if(o(1,t,i),y?(m=S[0],f=e(i.focusableElements,m),i.focusInput&&setTimeout(s,20)):a(S[0],i.centerX,i.centerY),i.timeout){var F=setTimeout(function(){y?e.unblockUI(i):e(t).unblock(i)},i.timeout);e(t).data("blockUI.timeout",F)}}}function n(t,n){var r,s=t==window,a=e(t),c=a.data("blockUI.history"),l=a.data("blockUI.timeout");l&&(clearTimeout(l),a.removeData("blockUI.timeout")),n=e.extend({},e.blockUI.defaults,n||{}),o(0,t,n),null===n.onUnblock&&(n.onUnblock=a.data("blockUI.onUnblock"),a.removeData("blockUI.onUnblock"));var d;d=s?e("body").children().filter(".blockUI").add("body > .blockUI"):a.find(">.blockUI"),n.cursorReset&&(d.length>1&&(d[1].style.cursor=n.cursorReset),d.length>2&&(d[2].style.cursor=n.cursorReset)),s&&(m=f=null),n.fadeOut?(r=d.length,d.stop().fadeOut(n.fadeOut,function(){0===--r&&i(d,c,n,t)})):i(d,c,n,t)}function i(t,n,i,o){var r=e(o);if(!r.data("blockUI.isBlocked")){t.each(function(e,t){this.parentNode&&this.parentNode.removeChild(this)}),n&&n.el&&(n.el.style.display=n.display,n.el.style.position=n.position,n.el.style.cursor="default",n.parent&&n.parent.appendChild(n.el),r.removeData("blockUI.history")),r.data("blockUI.static")&&r.css("position","static"),"function"==typeof i.onUnblock&&i.onUnblock(o,i);var s=e(document.body),a=s.width(),c=s[0].style.width;s.width(a-1).width(a),s[0].style.width=c}}function o(t,n,i){var o=n==window,s=e(n);if((t||(!o||m)&&(o||s.data("blockUI.isBlocked")))&&(s.data("blockUI.isBlocked",t),o&&i.bindEvents&&(!t||i.showOverlay))){var a="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";t?e(document).bind(a,i,r):e(document).unbind(a,r)}}function r(t){if("keydown"===t.type&&t.keyCode&&9==t.keyCode&&m&&t.data.constrainTabKey){var n=f,i=!t.shiftKey&&t.target===n[n.length-1],o=t.shiftKey&&t.target===n[0];if(i||o)return setTimeout(function(){s(o)},10),!1}var r=t.data,a=e(t.target);return a.hasClass("blockOverlay")&&r.onOverlayClick&&r.onOverlayClick(t),a.parents("div."+r.blockMsgClass).length>0||0===a.parents().children().filter("div.blockUI").length}function s(e){if(f){var t=f[e===!0?f.length-1:0];t&&t.focus()}}function a(e,t,n){var i=e.parentNode,o=e.style,r=(i.offsetWidth-e.offsetWidth)/2-c(i,"borderLeftWidth"),s=(i.offsetHeight-e.offsetHeight)/2-c(i,"borderTopWidth");t&&(o.left=r>0?r+"px":"0"),n&&(o.top=s>0?s+"px":"0")}function c(t,n){return parseInt(e.css(t,n),10)||0}e.fn._fadeIn=e.fn.fadeIn;var l=e.noop||function(){},d=/MSIE/.test(navigator.userAgent),u=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),p=(document.documentMode||0,e.isFunction(document.createElement("div").style.setExpression));e.blockUI=function(e){t(window,e)},e.unblockUI=function(e){n(window,e)},e.growlUI=function(t,n,i,o){var r=e('<div class="growlUI"></div>');t&&r.append("<h1>"+t+"</h1>"),n&&r.append("<h2>"+n+"</h2>"),void 0===i&&(i=3e3);var s=function(t){t=t||{},e.blockUI({message:r,fadeIn:"undefined"!=typeof t.fadeIn?t.fadeIn:700,fadeOut:"undefined"!=typeof t.fadeOut?t.fadeOut:1e3,timeout:"undefined"!=typeof t.timeout?t.timeout:i,centerY:!1,showOverlay:!1,onUnblock:o,css:e.blockUI.defaults.growlCSS})};s();r.css("opacity");r.mouseover(function(){s({fadeIn:0,timeout:3e4});var t=e(".blockMsg");t.stop(),t.fadeTo(300,1)}).mouseout(function(){e(".blockMsg").fadeOut(1e3)})},e.fn.block=function(n){if(this[0]===window)return e.blockUI(n),this;var i=e.extend({},e.blockUI.defaults,n||{});return this.each(function(){var t=e(this);i.ignoreIfBlocked&&t.data("blockUI.isBlocked")||t.unblock({fadeOut:0})}),this.each(function(){"static"==e.css(this,"position")&&(this.style.position="relative",e(this).data("blockUI.static",!0)),this.style.zoom=1,t(this,n)})},e.fn.unblock=function(t){return this[0]===window?(e.unblockUI(t),this):this.each(function(){n(this,t)})},e.blockUI.version=2.7,e.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var m=null,f=[]}"function"==typeof define&&define.amd&&define.amd.jQuery?define("../extend/blockUI/jquery.blockUI",["jquery"],e):e(jQuery)}(),define("../plugins/panel/panel-question",["../../common/helper","../../extend/remodal/dist/remodal","../../extend/blockUI/jquery.blockUI"],function(e){function t(t,a){this.options=$.extend({},l,t),this.options.config=$.extend({},l.config,t.config),this.options.message=$.extend({},l.message,t.message),this.popQuestionState={show:!1,popTime:0};var d,u=[],p=1;if(void 0==this.options.examServiceUrl||""==this.options.examServiceUrl)return void e.error("examServiceUrl配置为空！");if("undefined"!=typeof this.options.message.noAnswerMessage&&!this.options.message.noAnswerMessage instanceof Array)return void e.error("noAnswerMessage must be Array!");var m=this;this.options.message.noAnswerCallback=this.options.message.noAnswerCallback||("undefined"==typeof this.options.message.noAnswerMessage?void 0:function(t){if("undefined"==typeof t)return void e.error("noAnswerCallback[Function]'s parameter 'event' is undefined!");var n=$.grep(m.options.message.noAnswerMessage,function(e,n){return e.code==t.code});if(n.length>0){var o=n[0];i(o.message)}});var f=this.options.config;if(e.log("弹窗模式："+(f.mode==e.Const.popQuestionType.normal?"知识点":"随机题")),f.mode==e.Const.popQuestionType.random){if(void 0==f.triggerValue||0==f.triggerValue)return void e.error("触发形式值必须设置，且不能为0");switch(f.triggerForm){case 1:if(e.log("触发形式：固定百分比间隔"),f.triggerValue>100||f.triggerValue<0)return void e.error("触发形式值必须是1-100之间");for(;;){if(d=parseInt(a*p*(f.triggerValue/100)),d>a)break;u.push({time:d,id:"-1",times:f.times}),p++}f.questions=u;break;case 2:for(e.log("触发形式：固定时间间隔");;){if(d=parseInt(p*f.triggerValue),d>a)break;u.push({time:d,id:"-1",times:f.times}),p++}f.questions=u;break;default:e.log("未知的触发形式："+f.triggerForm)}}this.notPoppedQuestions=[],this.logPop=function(t,n,i,o){var r=[],s={userId:this.options.context.userId,courseId:this.options.context.courseId,courseWareId:this.options.context.courseWareId,mediaId:this.options.context.mediaId,type:t};if(e.checkApiType(this.options.context.apiType)){for(var a=0;a<this.options.context.markers.length;a++){var c=this.options.context.markers[a];r.push({objectId:c.value,type:c.key})}s.objectList=r}else s.object={objectId:this.options.context.objectId,objectType:this.options.context.objectType};t===e.Const.popQuestionLogType.init?(this.options.config.useful=o,s.initMessage=this.options.config):("notPoppedQuestion"===n.popQuestionType&&(s.initMessage={popQuestionType:"recycleType",popTime:i}),s.questionId=n.id||"The random question type has no id!"),e.ajax(this.options.examServiceUrl+"/web/popQuiz/popQuestionLog",s)},this.options.logEnable&&this.logPop(e.Const.popQuestionLogType.init);var h=this;this.toggle=function(e,t){this.answerCount=this.options.config.verificationValue;var n,i=this;return(n=this.askForPop(e))?(i.ladyFirst=!0,i.options.beforePop&&i.options.beforePop.call(t,i.lastToggleTs=e,n),t.pauseCurrent(),i.fadeIn(n,t)):i.ladyFirst=!1,this};var y=this.options.config.questions;this.securityTiming={},this.recyclePop=function(t){return this.options.config.mode===e.Const.popQuestionType.random?void e.log("随机题不回收弹窗题..."):(e.log("开始回收弹窗题目..."),h.securityTiming.timing&&window.clearInterval(h.securityTiming.timing),void(h.securityTiming.timing=window.setInterval(function(){var n=Math.floor(t.player.getTime()||0);e.forEach(y,function(t){var i=Math.floor(t.time);if(i<n&&!t.popped){var o=!1;e.forEach(m.notPoppedQuestions,function(e){t.id===e.id&&(o=!0)}),o||(t.$index=h.notPoppedQuestions.length,t.popQuestionType="notPoppedQuestion",h.notPoppedQuestions.push(t))}}),e.log("回收中.... 有: "+h.notPoppedQuestions.length+"  题")},5e3)))},this.askForPop=function(t){for(var n=[],t=Math.floor(t),i=y.length,o=this,r=0;r<i;r++){var s=y[r],a=Math.floor(s.time);a===t&&n.push(s)}if(n.length<=0)return o.notPoppedQuestions[0];var c;return n.length>=1&&(c=n[0]),function(){if(o.options.config.mode===e.Const.popQuestionType.random&&c)return c;var t;return c.answerResult||c.answerTimes>=c.times?(c.answerTimes>=c.times?e.log("次数用完不弹窗"):e.log("答对不弹窗"),t=!1):t=c,t}()},this.lastToggleTs=0,this.isToggle=function(e,t){return Math.abs(e-this.lastToggleTs)>t},this.hbNb=void 0,this.validateCallback=function(t,n,o){if($.unblockUI(),t)return this.fadeOut(this.options.message.correctAnswer,n,o),!0;if(0==o.times)e.log("当前回答次数<<<<<     "+o.answerTimes+"     >>>>>"),i(this.options.message.wrongAnswerRetry);else{if(o.answerTimes>=o.times)return o.rules&&o.rules.wrongTimes2_show_answer&&this.hbNb.showResult(),this.fadeOut(this.options.message.wrongAnswer,n,o),!0;i(this.options.message.wrongAnswerCount.replace(/#count#/gi,o.times-o.answerTimes))}return!1},this.fadeIn=function(t,r,s){var a=r.player.getTime();this.popQuestionState.show=!0,this.popQuestionState.popTime=a,this.options.logEnable&&this.options.config.mode===e.Const.popQuestionType.normal&&this.logPop(e.Const.popQuestionLogType.timing,t,a);var l=this,d=function(t){return function(){$.blockUI(),l.hbNb.saveAnswer().then(function(n){if(!n)return void e.error("exam Service result is undefined!");var i=n.info.correct;l.hbNb.markResult(),t.answerTimes=t.answerTimes||0,t.answerTimes++,t.answerResult=i,s&&s(),l.validateCallback(i,r,t)})}}(t);if(this.popQuestionState.show&&(this.modal=null),!this.modal){var u={closeOnConfirm:!1,closeOnCancel:!1,closeOnEscape:!1,closeOnOutsideClick:!1};this.modal=n("question_remodal").remodal(u)}return $(document).off("confirmation",".remodal"),$(document).off("cancellation",".remodal"),l.bindConfirm(function(){d()}),l.hideCancel(),i(""),l.bindCancel(function(){l.popQuestionState.show=!1,t.popped=!0,"notPoppedQuestion"===t.popQuestionType&&l.notPoppedQuestions.splice(e.findIndex(l.notPoppedQuestions,t),1),l.modal.close(),o(),r.playCurrent(),s&&s()}),l.open(),c(l,t.id,l.options.examServiceUrl),this},this.open=function(){this.showConfirm(),this.modal.open()},this.fadeOut=function(t,n,r){var s=this.modal,a=this.options.config.timeClose;if(r.popped=!0,"notPoppedQuestion"===r.popQuestionType?m.notPoppedQuestions.splice(e.findIndex(m.notPoppedQuestions,r),1):this.ladyFirst=!1,h.notPoppedQuestions.length>0){var c=h.notPoppedQuestions[0];m.fadeIn(c,n)}else if(a>0){i((t||"")+a+"秒后关闭。"),a--,this.hideConfirm();var l=setInterval(function(){a<=0?(m.popQuestionState.show=!1,r.popped=!0,s.close(),n.playCurrent(),i(""),window.clearInterval(l)):i((t||"")+a+"秒后关闭。"),a--},1e3)}else i(t),"userClick"!==a?setTimeout(function(){m.popQuestionState.show=!1,r.popped=!0,i(""),o(),s.close(),n.playCurrent()},800):(this.hideConfirm(),this.showCancel());return this},this.resetToggle=function(){this.lastToggleTs=-3},this.showConfirm=function(){r().show()},this.hideConfirm=function(){r().hide()},this.showCancel=function(){s().show()},this.hideCancel=function(){s().hide()},this.bindConfirm=function(e){"function"!=typeof e&&window.console.log("fn is must function"),$(document).on("confirmation",".remodal",e)},this.bindCancel=function(e){"function"!=typeof e&&window.console.log("fn is must function"),$(document).on("cancellation",".remodal",e)},this.destroy=function(){$(document).off("confirmation",".remodal"),$(document).off("cancellation",".remodal")}}function n(e){var t='<div class="remodal" id="'+e+"\"><p id='modal-content'></p><p id='modal-answer' style='color:blue; text-align: left;'></p><br><p data-remodal-message-id='modal-message' style='color:red;margin-top: 5px'></p><button data-remodal-action=\"confirm\" class=\"remodal-confirm\">确定</button><button data-remodal-action=\"cancel\" class=\"remodal-cancel\">关闭窗口</button></div>",n=$("#"+e);return n.length<=0&&($(t).appendTo(document.body),n=$("#"+e)),n}function i(e){$("[data-remodal-message-id=modal-message]").each(function(t,n){$(n).html(e)})}function o(){return $("#modal-answer").html("").hide()}function r(){return $("[data-remodal-action=confirm]")}function s(){return $("[data-remodal-action=cancel]")}function a(t){return e.getPath(t)+e.Const.File.exam}function c(t,n,i){var o=[];if(t.options.context.markers&&e.isArray(t.options.context.markers))for(var r=0;r<t.options.context.markers.length;r++){var s=t.options.context.markers[r];o.push({type:s.key,objectId:s.value})}var c=a(i);require([c],function(){t.hbNb=new HB_NB_exam({target:"modal-content",server:t.options.examServiceUrl,params:{quizSourceType:1==t.options.config.mode?2:1,questionId:n,userId:t.options.context.userId,platformId:t.options.context.platformId,platformVersionId:t.options.context.platformVersionId,projectId:t.options.context.projectId,subProjectId:t.options.context.subProjectId,unitId:t.options.context.unitId,organizationId:t.options.context.organizationId,courseId:t.options.context.courseId,courseWareId:t.options.context.courseWareId,mediaId:t.options.context.mediaId,objectList:"Marker"===t.options.apiType?o:[{objectId:t.options.context.objectId,type:t.options.context.objectType}],sourceId:t.options.context.sourceId},events:t.options.message.noAnswerCallback})})}var l={examServiceUrl:"",config:{mode:0,triggerForm:0,triggerValue:0,isStoreRecord:!0,questions:[]},message:{wrongAnswer:"回答错误!",wrongAnswerRetry:"回答错误，请重新作答！",correctAnswer:"回答正确！",wrongAnswerCount:"回答错误，请重新作答！您还可以作答#count#次。",noAnswerCallback:void 0,noAnswerMessage:void 0},context:{userId:"",platformId:"",platformVersionId:"",projectId:"",subProjectId:"",unitId:"",organizationId:"",courseId:"",courseWareId:"",mediaId:"",sourceId:""}};return t.prototype.mistakeOnPopQuestionClose=function(t,n){if(this.popQuestionState.show&&"playing"===t.getState()){if(this.popQuestionState.popTime===t.getTime()&&"seek"===n)return;e.log("系统显示有一个弹窗未正常关闭，  不能正常播放下去"),t.play(this.popQuestionState.popTime),t.pause()}},t}),define("../plugins/ashe/ashe",["cameras","../../common/helper"],function(e,t,n){function i(e){this.options=e,this.init(e)}function o(e){var n=this.AsheTimePoints,i=this;e.__timerFactory.create("Ashe",1e3,function(){var o=Math.floor(e.player.getTime());if(n&&n.length>0){var s=t.findIndex(n,{time:o},"time")||i.protectPopCameras[0];s&&!s.popped&&(i.popCamerasState.pop=s,i.cameras||(i.openCamera(),e.player.pause(),r.call(i,4,s)))}}),e.__timerFactory.create("AsheProtect",5e3,function(){var o=Math.floor(e.player.getTime());t.log("camera pro : "+i.protectPopCameras.length+"...."),t.forEach(n,function(e){e.time<o&&!e.popped&&!t.findIndex(i.protectPopCameras,{time:e.time},"time")&&(e.popType="miss",e.$index=i.protectPopCameras.length,i.protectPopCameras.push(e))})})}function r(e,n){var i=this.options.sdkConfig,o=[],r={userId:i.context.usrId,courseId:i.core.courseId,courseWareId:i.core.courseWareId,mediaId:i.core.multimediaId,type:e};if(t.checkApiType(i.apiType)){for(var s=0;s<i.context.markers.length;s++){var a=i.context.markers[s];o.push({objectId:a.value,type:a.key})}r.objectList=o}else r.object={objectId:i.context.objectId,objectType:i.context.objectType};3===e?r.initMessage=JSON.stringify(this.cameraConfig):4===e&&(r.initMessage=JSON.stringify(n)),t.ajax(this.cameraConfig.examServiceUrl+"/web/popQuiz/popQuestionLog",r)}function s(e,n){var i=Math.floor(Math.random()*n+1)+(this.mix?this.mix*e.length:0);t.findIndex(e,{time:i},"time")?s.call(this,e,n):e.push({time:i})}window.Webcam=n;var a={random:0,fixed:1,average:2,takeover:3};return i.prototype={constructor:i,init:function(e){return this.options=e,this.options=$.extend({},e),this.popCamerasState={},this.protectPopCameras=[],this.cameraConfig=e.cameraConfig,this.mix=this.cameraConfig.mix||10,this.AsheTimePoints=this.genAsheData(),o.call(this,this.options.player),r.call(this,3),this},genAsheData:function(){var e,n=[],i=1,o=this.options.player.player.getDuration();if(this.cameraConfig.captureMode===a.random){for(this.cameraConfig.duration=this.cameraConfig.duration||o/Math.floor(.25*o),i;i<=this.cameraConfig.duration;i++)s.call(this,n,o);n=n.sort(function(e,t){var n=parseInt(e.time,10),i=parseInt(t.time,10);return n<i?-1:n>i?1:0})}else if(this.cameraConfig.captureMode===a.fixed)for(e=Math.floor(o/this.cameraConfig.duration),i;i<=e;i++)n.push({time:this.cameraConfig.duration*i});else if(this.cameraConfig.captureMode===a.average){var r=Math.floor(o*(this.cameraConfig.duration/100)),e=Math.floor(o/r);for(i;i<=e;i++)n.push({time:r*i})}else this.cameraConfig.captureMode===a.takeover&&("percent"===this.cameraConfig.takeover.type?t.forEach(this.cameraConfig.takeover.asheTimePoints,function(e){n.push({sourceTime:e.time,time:Math.floor(e.time/100*o)})}):n=this.cameraConfig.takeover.asheTimePoints,t.isFunction(this.cameraConfig.takeover.generator)&&(n=this.cameraConfig.takeover.generator()));return this.cameraConfig.begin&&n.length>0&&0!==n[0].time&&n.unshift({time:0}),n},openCamera:function(){var n=this;return this.cameraConfig.context={platformId:this.options.context.plmId,platformVersionId:this.options.context.pvmId,projectId:this.options.context.prmId,subProjectId:this.options.context.subPrmId,unitId:this.options.context.unitId,organizationId:this.options.context.orgId},this.cameraConfig.compareData=this.cameraConfig.compareData||{},this.cameraConfig.compareData.popInfo={popCaptureTime:"percent"===this.cameraConfig.takeover.type?n.popCamerasState.pop.sourceTime:n.popCamerasState.pop.time,playTime:Math.floor(this.options.player.player.getTime()),captureMode:this.cameraConfig.captureMode},this.cameras?this.cameras:(this.cameras=new e(this.cameraConfig),this.cameras.on("upload",function(e){t.isFunction(n.options.uploadSuccess)&&n.options.uploadSuccess()}).on("compare",function(e,i){e&&e.isSimilar&&(i.close(),n.popCamerasState.pop.popped=!0,"miss"===n.popCamerasState.pop.popType&&n.protectPopCameras.splice(n.popCamerasState.pop.$index,1),n.cameras=null,n.popCamerasState.pop=null,t.isFunction(n.options.compareSuccess)&&n.options.compareSuccess())}),this.cameras)}},i}),define("utility/security",["require"],function(e){function t(){this.disableF12(),this.disableContextMenu()}return window.console&&console.log("安全模式启动.."),t.prototype={constructor:t,disableContextMenu:function(){document.oncontextmenu=function(e){e.returnValue=!1}},enableContextMenu:function(){document.oncontextmenu=!0},disableF12:function(){document.onkeydown=function(e){var t=t||window.event||e;123===t.keyCode&&(t.returnValue=!1)}}},new t}),define("bond",["./helper","../core/common/player-event","../core/pdf/player-pdf","../core/single/player-single","../core/three/player-three","../web/web-player","../plugins/panel/panel-question","../plugins/ashe/ashe","jquery","jqueryJson","./ie-extension","./utility/security"],function(e,t,n,i,o,r,s,a,c){function l(t,n,i){return e.getPath(t)+e.Const.getService(i||"")[n]}function d(e,t){if(e._launchStudy=b,c.extend(e._launchStudy.extend,{studyMode:t.studyMode,lessonName:t.lessonName,lessonCatalog:t.lessonCatalog,lessonDocument:t.lessonDocument,type:t.type}),e._launchStudy.camera=t.camera,e._launchStudy.style=t.style,e._launchStudy.styleOptions=t.styleOptions,e._launchStudy.type=t.type,e._launchStudy.apiType=t.apiType,c.extend(e._launchStudy.context,{test:t.test,plmId:t.plmId,pvmId:t.pvmId,prmId:t.prmId,subPrmId:t.subPrmId,unitId:t.unitId,orgId:t.orgId,usrId:t.usrId,objectId:t.objectId,objectType:t.objectType,markers:t.objectList,guid:t.guid,originalAbilityId:t.originalAbilityId}),e._launchStudy.pdfHtmlAddress=t.pdfHtmlAddress,e._launchStudy.interaction.streamHost=t.streamHost,e._launchStudy.interaction.streamPath=t.streamPath,e._launchStudy.interaction.p2p_option=c.extend({},t.p2pOption),e._launchStudy.options={containerId:t.container.id,width:t.container.width,height:t.container.height,docTime:t.container.docTime,limit:void 0==t.container.limit?0:t.container.limit,callback:t.container.callback,isCanSeek:void 0!=t.container.isCanSeek&&t.container.isCanSeek,startAt:void 0==t.container.startAt?-1:t.container.startAt},e._launchStudy.downFile={fileUrl:t.downFile.fileUrl,fileDownloadUrl:t.downFile.fileDownloadUrl},e._launchStudy.event=t.event,e._launchStudy.interceptConfig={isEnable:!1},t.intercept){var n=c.extend({},t.intercept);n.context={userId:t.usrId,platformId:t.plmId,platformVersionId:t.pvmId,projectId:t.prmId,subProjectId:t.subPrmId,unitId:t.unitId,organizationId:t.orgId,courseId:t.courseId,courseWareId:t.courseWareId,mediaId:t.multimediaId,objectId:t.objectId,objectType:t.objectType,markers:t.objectList,sourceId:t.originalAbilityId},e._launchStudy.interceptConfig=n}}function u(t,s,a){if(d(t,s),t._launchStudy.interceptConfig.isEnable&&(t._launchStudy.event.frameListen=function(e,n,i){t.questionModule&&t.questionModule.toggle(e,n)}),t.playerCore&&t.playerCore.__timerFactory&&t.playerCore.__timerFactory.destroy(),s.type==e.playType.pdf)t.playerCore=n.init(t),h(t,t._launchStudy.event),a&&a();else if(s.type==e.playType.single){var c=i.init(t.api);t.playerCore=c,h(t,t._launchStudy.event),a&&a()}else if(s.type==e.playType.three){var c=o.init(t.api);t.playerCore=c,h(t,t._launchStudy.event),a&&a()}else if(s.type==e.playType.web){var c=r.init(t.api);t.playerCore=c,h(t,t._launchStudy.event),a&&a()}else e.log("加载未知模块:"+s.type)}function p(t,n){u(t,n,function(){t.playerCore.initPlayer(t._launchStudy),e.log("当前播放模式：预览模式")})}function m(t,n){u(t,n,function(){g=l(n.initURL,"init",n.apiType),v=l(n.initURL,"pdfIE8"===n.type?"pdf":n.type,n.apiType),t.timingCore.init(g,v,n,!0),e.log("当前播放模式：学习模式")})}function f(t,n){u(t,n,function(){t.playerCore.initPlayer(t._launchStudy),e.log("当前播放模式：浏览模式")})}function h(e,t){e.setStateEvent&&(e.setStateEvent("init",t.initPlay),e.setStateEvent("start",t.startPlay),e.setStateEvent("end",t.endPlay),e.setStateEvent("state",t.statePlay),e.setStateEvent("frame",t.frameListen));var n=e.playerCore;n.setStateListening&&(n.setStateListening("state",function(n,i){t.statePlay&&t.statePlay(n,i),e.__events.get(n)&&e.__events.get(n)(n,i)}),e.__events.get("frame")&&n.setStateListening("frame",e.__events.get("frame")))}function y(){var e=new w;return window.__bond&&window.__bond.destroy(),window.__bond=e,window.API=e.api,window.__bond}var g="",v="",b={pattern:"",core:{primaryKey:"",studySchedule:0,studyCurrentScale:0,studyStatus:0,lessonStatus:"not attempted",token:"",isRepeatPlay:0,coursewareSchedule:0,courseSchedule:0,mediaTotalTimeLength:0},objectives:{mode:"active",modifyPolicy:!1,policy:{intervalTime:-1,initServer:"",commitServer:""}},interaction:{p2p_option:{},streamHost:"",streamPath:""},extend:{},context:{},event:{initPlay:function(e,t){},startPlay:function(e,t){},endPlay:function(e,t){},statePlay:function(e,t){},repeatPlay:function(e){},commitAfter:function(e,t){},frameListen:void 0}},w=function(){function n(e){return!(!e.camera||!e.camera.uploadUrl)&&(e.camera.compareData=e.core,e.camera.compareData.userId=e.context.usrId,e.camera.compareData.objectId=e.context.objectId,e.camera.compareData.objectType=e.context.objectType||"-1",e.camera.compareData.markers=e.context.markers,e.camera.extraData=e.extraData,i.cameraAshe=new a({sdkConfig:e,context:e.context,cameraConfig:e.camera,player:i.playerCore,panelQuestion:i,compareSuccess:function(){i.questionModule&&i.questionModule.popQuestionState&&i.questionModule.popQuestionState.show||i.playerCore.player.play()},uploadSuccess:function(){}}))}this.constructor=this;var i=this;this._launchStudy=b,i.resumeConditionQueue=[],this.api={LMSInitialize:function(){return e.log("bond.api.LMSInitialize, mode of launchStudy"+i._launchStudy.pattern),i.playerCore.LMSInitialize(i._launchStudy),"true"},LMSCommit:function(t){return(e.isUndefined(t)||e.isEmptyString(t))&&(t="play"),i.timingCore.commit(t),"true"},LMSFinish:function(){return e.log("bond.api.LMSFinish"),playerCore.LMSFinish(i._launchStudy),"true"},
LMSSetValue:function(t,n){e.log("bond.api.LMSSetValue, key:"+t+"; value:"+n),i.playerCore.LMSSetValue(t,n)},LMSGetValue:function(t){return e.log("bond.api.LMSGetValue, key:"+t),i.playerCore.LMSGetValue(t)},LMSGetLastError:function(){var t=i.playerCore.LMSGetLastError();return e.log("bond.api.LMSGetLastError"+t),t},LMSGetErrorString:function(t){var n=i.playerCore.LMSGetLastError(t);return e.log("bond.api.LMSGetErrorString, errorCode:"+t+"; errorString:"+n),n},LMSGetDiagnostic:function(t){var n=i.playerCore.LMSGetDiagnostic(t);return e.log("bond.api.LMSGetDiagnostic, errorCode:"+t+"; diagnostic:"+n),n}},this.playerCore={},this.timingCore={isJsonp:!1,init:function(t,o,r,a){a&&(this.isJsonp=a);var l={context:{test:r.test,guid:r.guid,plmId:r.plmId,pvmId:r.pvmId,prmId:r.prmId,subPrmId:r.subPrmId,unitId:r.unitId,orgId:r.orgId},isWriteHistory:r.isWriteHistory,usrId:r.usrId,courseId:r.courseId,courseWareId:r.courseWareId,multimediaId:r.multimediaId,type:"pdfIE8"===r.type?"pdf":r.type,originalAbilityId:r.originalAbilityId,filterList:r.filterList,token:window.___token||""};"Marker"!==r.apiType?(l.context.objectId=r.objectId,l.context.objectType="-1"):l.context.markers=r.objectList;var d={courseId:r.courseId,courseWareId:r.courseWareId,multimediaId:r.multimediaId};this.ajax(t,l,function(t){if("object"!=typeof t&&e.error(t),"200"===t.head.code){var o=t.data;switch(i._launchStudy.pattern=o.pattern,o.core&&(c.extend(i._launchStudy.core,d,o.core),window.___token=i._launchStudy.core.token),i._launchStudy.core.type=l.type,i._launchStudy.pattern){case"custom":i._launchStudy.objectives.mode="active",i._launchStudy.objectives.modifyPolicy=!1,o.objectives.policy.intervalTime?i._launchStudy.objectives.policy.intervalTime=o.objectives.policy.intervalTime:2!==i._launchStudy.core.studyStatus&&(i._launchStudy.objectives.policy.intervalTime=30);break;case"scorm":i._launchStudy.objectives.mode="unactive",c.extend(i.playerCore,{__supportVersion:"1.2",__errorException:{GeneralException:{code:"101",string:"General Exception",diagnostic:"General Exception"},InvalidArgumentException:{code:"201",string:"Invalid argument error",diagnostic:"Invalid argument error"},ElementCannotHaveChildrenException:{code:"202",string:"Element can't have children error",diagnostic:"Invalid argument error"},ElementNotArrayException:{code:"203",string:"Element not an array.Can't have count",diagnostic:"Element not an array.Can't have count"},NoInitException:{code:"301",string:"Not initialized",diagnostic:"Not initialized"},NoImplementException:{code:"401",string:"Not implemented error",diagnostic:"Not implemented error"},InvalidSetValueException:{code:"402",string:"Invalid set value",diagnostic:"Invalid set value,element is a keyword"},ElementReadonlyException:{code:"403",string:"Element is read only",diagnostic:"Element is read only"},ElementWriteonlyException:{code:"404",string:"Element is write only",diagnostic:"Element is write only"},IncorrectDataTypeException:{code:"405",string:"Incorrect data type",diagnostic:"Incorrect data type"},get:function(e){var t=this;for(var n in t)if(t[n].code==e.toString())return t[n];return null}},__errorRegExption:{objectivesScoreChild:new RegExp("cms.objectives.\\d+.score._children"),interactionsId:new RegExp("cms.interactions.\\d+.id"),interactionsObjectivesCount:new RegExp("cms.interactions.\\d+.objectives._count"),interactionsObjectivesId:new RegExp("cms.interactions.\\d+.objectives.\\d+.id"),interactionsTime:new RegExp("cms.interactions.\\d+.time"),interactionsType:new RegExp("cms.interactions.\\d+.type"),interactionsCorrectResponsesCount:new RegExp("cms.interactions.\\d+.correct_responses_count"),interactionsCorrectResponsesPattern:new RegExp("cms.interactions.\\d+.correct_responses\\d+.pattern"),interactionsWeighting:new RegExp("cms.interactions.\\d+.weighting"),interactionsStudentResponse:new RegExp("cms.interactions.\\d+.student_response"),interactionsResult:new RegExp("cms.interactions.\\d+.result"),interactionsLatency:new RegExp("cms.interactions.\\d+.latency")},__errorCode:"0",__dataModel:{}});break;default:e.error("timing.init:launchStudy.pattern is unknown.")}(e.isUndefined(i._launchStudy.options.startAt)||i._launchStudy.options.startAt==-1)&&(i._launchStudy.options.startAt=i._launchStudy.core.studyLastScale);var a,u,p=i._launchStudy.type,m=i._launchStudy;i.playerCore.initCompleted=function(t){p===e.playType.pdf&&(n(m),t.__timerFactory.allStart())},p!==e.playType.pdf&&(a=function(){n(m)}),i._launchStudy.interceptConfig.isEnable&&(u=function(t){return i._launchStudy.core.studySchedule>=100&&i._launchStudy.interceptConfig.config.mode===e.Const.popQuestionType.random?void e.log("随机题目，并且学习进度已经到达百分百..不创建弹窗题实例"+i._launchStudy.core.studySchedule+"-"+e.Const.popQuestionType.random):(i._launchStudy.interceptConfig.apiType=i._launchStudy.apiType,i.questionModule=new s(i._launchStudy.interceptConfig,t.getDuration()),void i.questionModule.recyclePop(i.playerCore))});var f=i.playerCore.streamCompleted;i.playerCore.streamCompleted=function(t){e.isFunction(a)&&a(t),e.isFunction(u)&&u(t),i.setStateEvent("seek",function(e){i.questionModule&&(i.questionModule.resetToggle(),i.questionModule.mistakeOnPopQuestionClose(t,e))}),i.setStateEvent("resume",function(e){i.questionModule&&(i.questionModule.mistakeOnPopQuestionClose(t,e),t.frameListen&&t.frameListen.listening())}),f&&f(t),i.playerCore.__timerFactory.allStart()},i.playerCore.initPlayer(i._launchStudy)}else{var h=r.event&&r.event.errorInit;h?h(t.head.message):alert("播放器初始化失败！"+t.head.message)}},function(e){alert(e)})},commit:function(t){if(i._launchStudy.core.studyMode!=e.playMode.listen){var n=i.playerCore.getCurrentLaunchStudyCore(i._launchStudy);n.core.token=window.___token,n.core.intervalTime=i._launchStudy.objectives.policy.intervalTime,this.ajax(v,n,function(t){if("object"!=typeof t&&e.error(t),"200"===t.head.code){var n=t.data,o=n.core;n.objectives;c.extend(i._launchStudy.core,{studyCurrentScale:o.studyCurrentScale,studyLastScale:o.studyLastScale,studySchedule:o.studySchedule,studyStatus:o.studyStatus,token:o.token,isRepeatPlay:o.isRepeatPlay,courseRecordId:o.courseRecordId,coursewareRecordId:o.coursewareRecordId,coursewareSchedule:o.coursewareSchedule,courseSchedule:o.courseSchedule}),e.log("study commit, mode of launchStudy:'"+i._launchStudy.pattern+"';studyScale:"+e.toTime(i._launchStudy.core.studyLastScale)+";studySchedule:"+i._launchStudy.core.studySchedule),"object"!=typeof n&&e.error(n),window.___token=o.token,n.objectives&&n.objectives.modifyPolicy&&(1!=n.objectives.modifyPolicy||e.isUndefined(i._launchStudy.objectives.policy)||i.playerCore.resetCommitTimer&&i.playerCore.resetCommitTimer(n.objectives.policy.intervalTime)),1==i._launchStudy.core.isRepeatPlay&&i._launchStudy.event.repeatPlay(i.playerCore),i.playerCore.commitAfter(i._launchStudy)}else e.log("计时保存失败！"+t.head.message)},function(e){alert(e)})}},ajax:function(t,n,i,o){e.isUndefined(c)&&e.error("jQuery is undefined!");var r=c.toJSON({head:e.Const.RequestHead,data:n});if(1==this.isJsonp)if("undefined"!=typeof XDomainRequest){var s=new XDomainRequest;s.onload=function(){i(c.parseJSON(s.responseText))},s.onerror=function(){o("xdr error 请求响应错误")},s.onprogress=function(){},s.open("post",t),s.send(r)}else c.ajax({type:"post",url:t,contentType:"text/plain",data:r,success:i,error:function(t){e.error(t)}});else c.ajax({url:t,data:r,type:"POST",dataType:"json"}).success(i).error(o)},show:function(){}},this.destroy=function(){this.playerCore&&this.playerCore.destroy(),this.questionModule&&(this.questionModule.destroy(),this.questionModule=void 0)},this.__events=void 0,this.setStateEvent=function(e,n){void 0===this.__events&&(this.__events=new t),this.__events.add(e,n)}};return{initBond:function(t){var n=y();switch(t.studyMode){case e.playMode.listen:p(n,t);break;case e.playMode.learn:m(n,t);break;case e.playMode.preview:f(n,t)}}}}),define("player",["./bond","./helper"],function(e,t){function n(e,t){for(var n in e)if(e[n]===t)return!0;return!1}function i(e){return void 0!==e&&null!==e&&("string"!=typeof e||!(!e||""==e||null==e))}function o(e,o){o instanceof Array||(o=[o]);for(var r in e)n(o,r)||i(e[r])||t.error(r+" isn't must null or empty.")}function r(e,n){var i="undefined";if(e===t.playMode.listen)switch(n){case t.playType.single:i=["plmId","pvmId","prmId","subPrmId","unitId","orgId","usrId","usrName","courseId","courseWareId","multimediaId","originalAbilityId","lessonName","pdfHtmlAddress"];break;case t.playType.pdf:i=["plmId","pvmId","prmId","subPrmId","unitId","orgId","usrId","usrName","courseId","courseWareId","multimediaId","originalAbilityId","lessonName"];break;case t.playType.scorm:i=["plmId","pvmId","prmId","subPrmId","unitId","orgId","usrId","usrName","courseId","courseWareId","multimediaId","originalAbilityId","lessonName","pdfHtmlAddress"];break;case t.playType.three:i=["plmId","pvmId","prmId","subPrmId","unitId","orgId","usrId","usrName","courseId","courseWareId","multimediaId","originalAbilityId","lessonName","pdfHtmlAddress"];break;case t.playType.web:i=["plmId","pvmId","prmId","subPrmId","unitId","orgId","usrId","usrName","courseId","courseWareId","multimediaId","originalAbilityId","lessonName","pdfHtmlAddress","streamPath"]}else if(e===t.playMode.learn)switch(n){case t.playType.single:i=["pdfHtmlAddress"];break;case t.playType.pdf:i=["lessonName"];break;case t.playType.scorm:i=["pdfHtmlAddress"];break;case t.playType.three:i=["lessonName","pdfHtmlAddress"];break;case t.playType.web:i=["pdfHtmlAddress","streamPath"]}return i}function s(n){n.studyMode===t.playMode.learn&&(void 0!=n.initURL&&""!=n.initURL&&0==n.initURL.indexOf("http")||t.error("服务器地址参数错误！")),e.initBond(n)}function a(){this.initData={isWriteHistory:!1,test:!1,pdfHtmlAddress:t.Const.rootPath,plmId:"",pvmId:"",prmId:"",subPrmId:"",unitId:"",orgId:"",guid:"",usrId:"",usrName:"",courseId:"",courseWareId:"",multimediaId:"",type:t.playType.single,originalAbilityId:"",studyMode:"1",streamHost:"",streamPath:"",initURL:"",container:{id:"",width:0,height:0,limit:0},downFile:{fielUrl:void 0,fileDownloadUrl:void 0},lessonName:"",lessonCatalog:[],lessonDocument:[],filterList:[]},this.loaderInit=function(e,t,n){var i={initPlay:function(e,t){},startPlay:function(e,t){},endPlay:function(e,t){},statePlay:function(e,t){},repeatPlay:function(e){}},a=$.extend({},i,t),c=r(e.studyMode,e.type);o(e,c),$.extend(this.initData,e),this.initData.event=a,this.initData.intercept=n,s(this.initData)}}return a});